<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Exercise Solutions | Data Analysis and Visualization using R (2)</title>
  <meta name="description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Exercise Solutions | Data Analysis and Visualization using R (2)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Exercise Solutions | Data Analysis and Visualization using R (2)" />
  
  <meta name="twitter:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  

<meta name="author" content="Michiel Noback" />


<meta name="date" content="2021-07-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercises.html"/>
<link rel="next" href="parsing-complex-data.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DAVuR2 gitbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>1</b> The <code>ggplot2</code> package</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#keep-the-goal-in-mind"><i class="fa fa-check"></i>Keep the goal in mind</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ggplot2.html"><a href="ggplot2.html#getting-started"><i class="fa fa-check"></i><b>1.2</b> Getting started</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#a-first-plot"><i class="fa fa-check"></i>A first plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#adding-a-dimension-using-color"><i class="fa fa-check"></i>Adding a dimension using color</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#inspecting-and-tuning-the-figure"><i class="fa fa-check"></i>Inspecting and tuning the figure</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-and-the-theory-of-graphics"><i class="fa fa-check"></i><b>1.3</b> ggplot2 and the theory of graphics</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#philosophy-of-ggplot2"><i class="fa fa-check"></i>Philosophy of ggplot2</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-grammar-of-graphics"><i class="fa fa-check"></i>The grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ggplot2.html"><a href="ggplot2.html#building-plots-with-ggplot2"><i class="fa fa-check"></i><b>1.4</b> Building plots with ggplot2</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-layered-plot-architecture"><i class="fa fa-check"></i>The layered plot architecture</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#tidy-the-data"><i class="fa fa-check"></i>“Tidy” the data</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="ggplot2.html"><a href="ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>1.5</b> Aesthetics</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#colors"><i class="fa fa-check"></i>Colors</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#shapes"><i class="fa fa-check"></i>Shapes</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#lines"><i class="fa fa-check"></i>Lines</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#size"><i class="fa fa-check"></i>Size</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="ggplot2.html"><a href="ggplot2.html#geometries"><i class="fa fa-check"></i><b>1.6</b> Geometries</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#what-are-geometries"><i class="fa fa-check"></i>What are geometries</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#jitter"><i class="fa fa-check"></i>Jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#plot-overlays-boxplot-jitter"><i class="fa fa-check"></i>Plot overlays: boxplot + jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#plot-overlays-smooth-ribbon"><i class="fa fa-check"></i>Plot overlays: smooth + ribbon</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scatterplot-points"><i class="fa fa-check"></i>Scatterplot: Points</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#line-plots"><i class="fa fa-check"></i>Line plots</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#histograms"><i class="fa fa-check"></i>Histograms</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#violin-plot"><i class="fa fa-check"></i>Violin plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#barplot"><i class="fa fa-check"></i>Barplot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#overview-of-the-main-geoms"><i class="fa fa-check"></i>Overview of the main geoms</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="ggplot2.html"><a href="ggplot2.html#inheritance-of-aesthetics"><i class="fa fa-check"></i><b>1.7</b> Inheritance of aesthetics</a></li>
<li class="chapter" data-level="1.8" data-path="ggplot2.html"><a href="ggplot2.html#faceting"><i class="fa fa-check"></i><b>1.8</b> Faceting</a></li>
<li class="chapter" data-level="1.9" data-path="ggplot2.html"><a href="ggplot2.html#experimenting-with-geoms-and-aesthetics"><i class="fa fa-check"></i><b>1.9</b> Experimenting with geoms and aesthetics</a></li>
<li class="chapter" data-level="1.10" data-path="ggplot2.html"><a href="ggplot2.html#multivariate-categorical-data"><i class="fa fa-check"></i><b>1.10</b> Multivariate Categorical Data</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="ggplot2.html"><a href="ggplot2.html#bar-plots-of-contingency-tables"><i class="fa fa-check"></i><b>1.10.1</b> Bar plots of contingency tables</a></li>
<li class="chapter" data-level="1.10.2" data-path="ggplot2.html"><a href="ggplot2.html#balloon-plot"><i class="fa fa-check"></i><b>1.10.2</b> Balloon plot</a></li>
<li class="chapter" data-level="1.10.3" data-path="ggplot2.html"><a href="ggplot2.html#mosaic-plot"><i class="fa fa-check"></i><b>1.10.3</b> Mosaic plot</a></li>
<li class="chapter" data-level="1.10.4" data-path="ggplot2.html"><a href="ggplot2.html#correspondence-analysis"><i class="fa fa-check"></i><b>1.10.4</b> Correspondence analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="ggplot2.html"><a href="ggplot2.html#advanced-plotting-aspects"><i class="fa fa-check"></i><b>1.11</b> Advanced plotting aspects</a>
<ul>
<li class="chapter" data-level="1.11.1" data-path="ggplot2.html"><a href="ggplot2.html#plot-panels-from-for-loops-using-gridextragrid.arrange"><i class="fa fa-check"></i><b>1.11.1</b> Plot panels from <code>for</code> loops using <code>gridExtra::grid.arrange()</code></a></li>
<li class="chapter" data-level="1.11.2" data-path="ggplot2.html"><a href="ggplot2.html#the-ggallyggpairs-function"><i class="fa fa-check"></i><b>1.11.2</b> The <code>GGally::ggPairs()</code> function</a></li>
<li class="chapter" data-level="1.11.3" data-path="ggplot2.html"><a href="ggplot2.html#marginal-plots-using-ggextraggmarginal"><i class="fa fa-check"></i><b>1.11.3</b> Marginal plots using <code>ggExtra::ggMarginal()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="ggplot2.html"><a href="ggplot2.html#final-tweaks"><i class="fa fa-check"></i><b>1.12</b> Final tweaks</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scales-coordinates-and-annotations"><i class="fa fa-check"></i>Scales, Coordinates and Annotations</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#annotation"><i class="fa fa-check"></i>Annotation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html"><i class="fa fa-check"></i><b>2</b> Developing a custom visualization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#an-experimental-ptsd-treatment"><i class="fa fa-check"></i><b>2.1</b> An experimental PTSD treatment</a>
<ul>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-data"><i class="fa fa-check"></i>The data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#choose-a-visualization"><i class="fa fa-check"></i>Choose a visualization</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#tidy-the-data-1"><i class="fa fa-check"></i>Tidy the data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#a-first-version"><i class="fa fa-check"></i>A first version</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#add-mean-and-sd"><i class="fa fa-check"></i>Add mean and SD</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#emphasize-worst-cases"><i class="fa fa-check"></i>Emphasize worst cases</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#last-tweaks-fonts-and-legend"><i class="fa fa-check"></i><b>2.2</b> Last tweaks: fonts and legend</a></li>
<li class="chapter" data-level="2.3" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-code"><i class="fa fa-check"></i><b>2.3</b> The code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>3</b> Package tidyr</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tidyr.html"><a href="tidyr.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="tidyr.html"><a href="tidyr.html#the-pivot_longer-function"><i class="fa fa-check"></i><b>3.2</b> The <code>pivot_longer()</code> function</a></li>
<li class="chapter" data-level="3.3" data-path="tidyr.html"><a href="tidyr.html#a-more-complex-problem-two-sets-of-columns"><i class="fa fa-check"></i><b>3.3</b> A more complex problem: two sets of columns</a></li>
<li class="chapter" data-level="3.4" data-path="tidyr.html"><a href="tidyr.html#widening-with-pivot_wider"><i class="fa fa-check"></i><b>3.4</b> Widening with <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="3.5" data-path="tidyr.html"><a href="tidyr.html#split-columns-with-separate"><i class="fa fa-check"></i><b>3.5</b> Split columns with <code>separate()</code></a></li>
<li class="chapter" data-level="3.6" data-path="tidyr.html"><a href="tidyr.html#combine-columns"><i class="fa fa-check"></i><b>3.6</b> Combine columns</a></li>
<li class="chapter" data-level="3.7" data-path="tidyr.html"><a href="tidyr.html#drop-rows-with-missing-values-drop_na"><i class="fa fa-check"></i><b>3.7</b> Drop rows with missing values: <code>drop_na()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Data mangling with package <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>4.1</b> Tibbles</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dplyr.html"><a href="dplyr.html#by-row-constructor"><i class="fa fa-check"></i><b>4.1.1</b> By-row constructor</a></li>
<li class="chapter" data-level="4.1.2" data-path="dplyr.html"><a href="dplyr.html#tibbles-vs-data-frames"><i class="fa fa-check"></i><b>4.1.2</b> Tibbles vs data frames</a></li>
<li class="chapter" data-level="4.1.3" data-path="dplyr.html"><a href="dplyr.html#the-str-equivalent-glimpse"><i class="fa fa-check"></i><b>4.1.3</b> The <code>str()</code> equivalent: <code>glimpse()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#the-chaining-operator"><i class="fa fa-check"></i><b>4.2</b> The chaining operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#selecting"><i class="fa fa-check"></i><b>4.3</b> Selecting</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#selecting-rows-by-index-slice"><i class="fa fa-check"></i><b>4.3.1</b> Selecting rows by index: <code>slice()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#get-unique-cases-with-distinct"><i class="fa fa-check"></i><b>4.3.2</b> Get unique cases with <code>distinct()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="dplyr.html"><a href="dplyr.html#filter-cases"><i class="fa fa-check"></i><b>4.3.3</b> <code>filter()</code> cases</a></li>
<li class="chapter" data-level="4.3.4" data-path="dplyr.html"><a href="dplyr.html#selecting-variables-select"><i class="fa fa-check"></i><b>4.3.4</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="dplyr.html"><a href="dplyr.html#renaming-variables-rename"><i class="fa fa-check"></i><b>4.3.5</b> Renaming variables: <code>rename()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="dplyr.html"><a href="dplyr.html#selecting-from-ranked-data"><i class="fa fa-check"></i><b>4.3.6</b> Selecting from ranked data</a></li>
<li class="chapter" data-level="4.3.7" data-path="dplyr.html"><a href="dplyr.html#extract-a-column-as-vector"><i class="fa fa-check"></i><b>4.3.7</b> Extract a column as vector</a></li>
<li class="chapter" data-level="4.3.8" data-path="dplyr.html"><a href="dplyr.html#sorting-with-arrange"><i class="fa fa-check"></i><b>4.3.8</b> Sorting with <code>arrange()</code></a></li>
<li class="chapter" data-level="4.3.9" data-path="dplyr.html"><a href="dplyr.html#random-sampling"><i class="fa fa-check"></i><b>4.3.9</b> Random sampling</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#adding-and-changing-variables"><i class="fa fa-check"></i><b>4.4</b> Adding and changing variables</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="dplyr.html"><a href="dplyr.html#window-functions"><i class="fa fa-check"></i><b>4.4.1</b> Window functions</a></li>
<li class="chapter" data-level="4.4.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>4.4.2</b> Add one or more variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="dplyr.html"><a href="dplyr.html#multi-column-mutate-or-summary"><i class="fa fa-check"></i><b>4.4.3</b> Multi-column mutate or summary</a></li>
<li class="chapter" data-level="4.4.4" data-path="dplyr.html"><a href="dplyr.html#change-a-variable-recode-and-recode_factor"><i class="fa fa-check"></i><b>4.4.4</b> Change a variable: <code>recode()</code> and <code>recode_factor()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#operations-on-groups"><i class="fa fa-check"></i><b>4.5</b> Operations on groups</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#group_by-and-ungroup"><i class="fa fa-check"></i><b>4.5.1</b> <code>group_by()</code> and <code>ungroup()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#group_split-and-group_keys"><i class="fa fa-check"></i><b>4.5.2</b> <code>group_split()</code> and <code>group_keys()</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#apply-a-function-to-each-group"><i class="fa fa-check"></i><b>4.5.3</b> Apply a function to each group</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#summarizing-and-counting"><i class="fa fa-check"></i><b>4.6</b> Summarizing and counting</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#combining-data"><i class="fa fa-check"></i><b>4.7</b> Combining data</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dplyr.html"><a href="dplyr.html#merging"><i class="fa fa-check"></i><b>4.7.1</b> Merging</a></li>
<li class="chapter" data-level="4.7.2" data-path="dplyr.html"><a href="dplyr.html#adding-rows-and-columns"><i class="fa fa-check"></i><b>4.7.2</b> Adding rows and columns</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="date-time.html"><a href="date-time.html"><i class="fa fa-check"></i><b>5</b> Working with date-time data: <code>lubridate</code></a>
<ul>
<li class="chapter" data-level="5.1" data-path="date-time.html"><a href="date-time.html#current-time"><i class="fa fa-check"></i><b>5.1</b> Current time</a></li>
<li class="chapter" data-level="5.2" data-path="date-time.html"><a href="date-time.html#getting-elements-from-date-time-objects"><i class="fa fa-check"></i><b>5.2</b> Getting elements from date-time objects</a></li>
<li class="chapter" data-level="5.3" data-path="date-time.html"><a href="date-time.html#calculations-with-date-time"><i class="fa fa-check"></i><b>5.3</b> Calculations with date-time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stringr.html"><a href="stringr.html"><i class="fa fa-check"></i><b>6</b> Processing text with: <code>stringr</code> and regex</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stringr.html"><a href="stringr.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="stringr.html"><a href="stringr.html#a-few-remarks-on-locale"><i class="fa fa-check"></i><b>6.1.1</b> A few remarks on “locale”</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stringr.html"><a href="stringr.html#review-of-regular-expressions"><i class="fa fa-check"></i><b>6.2</b> Review of regular expressions</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stringr.html"><a href="stringr.html#regex-syntax-elements"><i class="fa fa-check"></i><b>6.2.1</b> Regex syntax elements</a></li>
<li class="chapter" data-level="6.2.2" data-path="stringr.html"><a href="stringr.html#character-classes-and-negation"><i class="fa fa-check"></i><b>6.2.2</b> Character classes and negation</a></li>
<li class="chapter" data-level="6.2.3" data-path="stringr.html"><a href="stringr.html#quantifiers"><i class="fa fa-check"></i><b>6.2.3</b> Quantifiers</a></li>
<li class="chapter" data-level="6.2.4" data-path="stringr.html"><a href="stringr.html#anchoring"><i class="fa fa-check"></i><b>6.2.4</b> Anchoring</a></li>
<li class="chapter" data-level="6.2.5" data-path="stringr.html"><a href="stringr.html#alternatives"><i class="fa fa-check"></i><b>6.2.5</b> Alternatives</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stringr.html"><a href="stringr.html#the-stringr-essentials"><i class="fa fa-check"></i><b>6.3</b> The <code>stringr</code> essentials</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="stringr.html"><a href="stringr.html#case-conversion"><i class="fa fa-check"></i><b>6.3.1</b> Case conversion</a></li>
<li class="chapter" data-level="6.3.2" data-path="stringr.html"><a href="stringr.html#split-join-and-substring"><i class="fa fa-check"></i><b>6.3.2</b> Split, join and substring</a></li>
<li class="chapter" data-level="6.3.3" data-path="stringr.html"><a href="stringr.html#matching"><i class="fa fa-check"></i><b>6.3.3</b> Matching</a></li>
<li class="chapter" data-level="6.3.4" data-path="stringr.html"><a href="stringr.html#extracting-and-replacing"><i class="fa fa-check"></i><b>6.3.4</b> Extracting and replacing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="eda.html"><a href="eda.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="eda.html"><a href="eda.html#getting-to-know-the-dataset"><i class="fa fa-check"></i><b>7.2</b> Getting to know the dataset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="eda.html"><a href="eda.html#the-codebook"><i class="fa fa-check"></i><b>7.2.1</b> The codebook</a></li>
<li class="chapter" data-level="7.2.2" data-path="eda.html"><a href="eda.html#load-and-inspect-the-data"><i class="fa fa-check"></i><b>7.2.2</b> Load and inspect the data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="eda.html"><a href="eda.html#exploring-variables"><i class="fa fa-check"></i><b>7.3</b> Exploring variables</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="eda.html"><a href="eda.html#first-steps"><i class="fa fa-check"></i><b>7.3.1</b> First steps</a></li>
<li class="chapter" data-level="7.3.2" data-path="eda.html"><a href="eda.html#smoking-data-corrupted"><i class="fa fa-check"></i><b>7.3.2</b> Smoking data corrupted?</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="eda.html"><a href="eda.html#variable-engineering"><i class="fa fa-check"></i><b>7.4</b> Variable engineering</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="eda.html"><a href="eda.html#recoding-strategies"><i class="fa fa-check"></i><b>7.4.1</b> Recoding strategies</a></li>
<li class="chapter" data-level="7.4.2" data-path="eda.html"><a href="eda.html#factorization"><i class="fa fa-check"></i><b>7.4.2</b> “factorization”</a></li>
<li class="chapter" data-level="7.4.3" data-path="eda.html"><a href="eda.html#data-redundancy-in-std-variables"><i class="fa fa-check"></i><b>7.4.3</b> Data redundancy in STD variables</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="eda.html"><a href="eda.html#the-dependent-variable"><i class="fa fa-check"></i><b>7.5</b> The dependent variable</a></li>
<li class="chapter" data-level="7.6" data-path="eda.html"><a href="eda.html#exploring-relationships-between-variables"><i class="fa fa-check"></i><b>7.6</b> Exploring relationships between variables</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="eda.html"><a href="eda.html#the-scatterplot"><i class="fa fa-check"></i><b>7.6.1</b> The scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="eda.html"><a href="eda.html#look-for-patterns-with-the-dependent-variable"><i class="fa fa-check"></i><b>7.7</b> Look for patterns with the dependent variable</a></li>
<li class="chapter" data-level="7.8" data-path="eda.html"><a href="eda.html#density-plots-show-class-distinction"><i class="fa fa-check"></i><b>7.8</b> Density plots show class distinction</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="eda.html"><a href="eda.html#the-xor-problem"><i class="fa fa-check"></i><b>7.8.1</b> The ‘xor’ problem</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="eda.html"><a href="eda.html#advanced-explorations"><i class="fa fa-check"></i><b>7.9</b> Advanced Explorations</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>7.9.1</b> PCA</a></li>
<li class="chapter" data-level="7.9.2" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>7.9.2</b> Clustering</a></li>
<li class="chapter" data-level="7.9.3" data-path="eda.html"><a href="eda.html#k-means-clustering"><i class="fa fa-check"></i><b>7.9.3</b> k-Means clustering</a></li>
<li class="chapter" data-level="7.9.4" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>7.9.4</b> hierarchical clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="publish.html"><a href="publish.html"><i class="fa fa-check"></i><b>8</b> Publishing, Presenting and Reporting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="publish.html"><a href="publish.html#introduction-4"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="publish.html"><a href="publish.html#rmarkdown"><i class="fa fa-check"></i><b>8.2</b> RMarkdown</a></li>
<li class="chapter" data-level="8.3" data-path="publish.html"><a href="publish.html#shiny"><i class="fa fa-check"></i><b>8.3</b> Shiny</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>9</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.1" data-path="exercises.html"><a href="exercises.html#introduction-5"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="exercises.html"><a href="exercises.html#the-ggplot2-and-tidyr-packages"><i class="fa fa-check"></i><b>9.2</b> The <code>ggplot2</code> and <code>tidyr</code> packages</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="exercises.html"><a href="exercises.html#trees"><i class="fa fa-check"></i><b>9.2.1</b> Trees</a></li>
<li class="chapter" data-level="9.2.2" data-path="exercises.html"><a href="exercises.html#insect-sprays"><i class="fa fa-check"></i><b>9.2.2</b> Insect Sprays</a></li>
<li class="chapter" data-level="9.2.3" data-path="exercises.html"><a href="exercises.html#diauxic-growth"><i class="fa fa-check"></i><b>9.2.3</b> Diauxic growth</a></li>
<li class="chapter" data-level="9.2.4" data-path="exercises.html"><a href="exercises.html#virginia-death-rates"><i class="fa fa-check"></i><b>9.2.4</b> Virginia Death Rates</a></li>
<li class="chapter" data-level="9.2.5" data-path="exercises.html"><a href="exercises.html#investigate-new-visualization"><i class="fa fa-check"></i><b>9.2.5</b> Investigate new visualization <sup><font size="3em">[❋❋❋]</font></sup></a></li>
<li class="chapter" data-level="9.2.6" data-path="exercises.html"><a href="exercises.html#toothgrowth"><i class="fa fa-check"></i><b>9.2.6</b> ToothGrowth</a></li>
<li class="chapter" data-level="9.2.7" data-path="exercises.html"><a href="exercises.html#puromycin"><i class="fa fa-check"></i><b>9.2.7</b> Puromycin</a></li>
<li class="chapter" data-level="9.2.8" data-path="exercises.html"><a href="exercises.html#global-temperature"><i class="fa fa-check"></i><b>9.2.8</b> Global temperature</a></li>
<li class="chapter" data-level="9.2.9" data-path="exercises.html"><a href="exercises.html#epilepsy-drug-trial"><i class="fa fa-check"></i><b>9.2.9</b> Epilepsy drug trial</a></li>
<li class="chapter" data-level="9.2.10" data-path="exercises.html"><a href="exercises.html#bacterial-growth-curves-with-varioscan"><i class="fa fa-check"></i><b>9.2.10</b> Bacterial growth curves with Varioscan</a></li>
<li class="chapter" data-level="9.2.11" data-path="exercises.html"><a href="exercises.html#the-dinos"><i class="fa fa-check"></i><b>9.2.11</b> The dinos</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="exercises.html"><a href="exercises.html#the-tidyr-and-dplyr-packages"><i class="fa fa-check"></i><b>9.3</b> The <code>tidyr</code> and <code>dplyr</code> packages</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="exercises.html"><a href="exercises.html#global-temperature-revisited"><i class="fa fa-check"></i><b>9.3.1</b> Global temperature revisited</a></li>
<li class="chapter" data-level="9.3.2" data-path="exercises.html"><a href="exercises.html#chickweight"><i class="fa fa-check"></i><b>9.3.2</b> ChickWeight</a></li>
<li class="chapter" data-level="9.3.3" data-path="exercises.html"><a href="exercises.html#population-numbers"><i class="fa fa-check"></i><b>9.3.3</b> Population numbers</a></li>
<li class="chapter" data-level="9.3.4" data-path="exercises.html"><a href="exercises.html#rubella-and-measles"><i class="fa fa-check"></i><b>9.3.4</b> Rubella and Measles</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="exercises.html"><a href="exercises.html#the-lubridate-package"><i class="fa fa-check"></i><b>9.4</b> The <code>lubridate</code> package</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="exercises.html"><a href="exercises.html#female-births"><i class="fa fa-check"></i><b>9.4.1</b> Female births</a></li>
<li class="chapter" data-level="9.4.2" data-path="exercises.html"><a href="exercises.html#diabetes"><i class="fa fa-check"></i><b>9.4.2</b> Diabetes</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="exercises.html"><a href="exercises.html#the-stringr-package"><i class="fa fa-check"></i><b>9.5</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="exercise-solutions.html"><a href="exercise-solutions.html"><i class="fa fa-check"></i><b>10</b> Exercise Solutions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#introduction-6"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#the-ggplot2-and-tidyr-packages-1"><i class="fa fa-check"></i><b>10.2</b> The <code>ggplot2</code> and <code>tidyr</code> packages</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#trees-1"><i class="fa fa-check"></i><b>10.2.1</b> Trees</a></li>
<li class="chapter" data-level="10.2.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#insect-sprays-1"><i class="fa fa-check"></i><b>10.2.2</b> Insect Sprays</a></li>
<li class="chapter" data-level="10.2.3" data-path="exercise-solutions.html"><a href="exercise-solutions.html#diauxic-growth-1"><i class="fa fa-check"></i><b>10.2.3</b> Diauxic growth</a></li>
<li class="chapter" data-level="10.2.4" data-path="exercise-solutions.html"><a href="exercise-solutions.html#virginia-death-rates-1"><i class="fa fa-check"></i><b>10.2.4</b> Virginia Death Rates</a></li>
<li class="chapter" data-level="10.2.5" data-path="exercise-solutions.html"><a href="exercise-solutions.html#investigate-new-visualization-1"><i class="fa fa-check"></i><b>10.2.5</b> Investigate new visualization <sup><font size="3em">[❋❋]</font></sup></a></li>
<li class="chapter" data-level="10.2.6" data-path="exercise-solutions.html"><a href="exercise-solutions.html#toothgrowth-1"><i class="fa fa-check"></i><b>10.2.6</b> ToothGrowth</a></li>
<li class="chapter" data-level="10.2.7" data-path="exercise-solutions.html"><a href="exercise-solutions.html#puromycin-1"><i class="fa fa-check"></i><b>10.2.7</b> Puromycin</a></li>
<li class="chapter" data-level="10.2.8" data-path="exercise-solutions.html"><a href="exercise-solutions.html#global-temperature-1"><i class="fa fa-check"></i><b>10.2.8</b> Global temperature</a></li>
<li class="chapter" data-level="10.2.9" data-path="exercise-solutions.html"><a href="exercise-solutions.html#epilepsy-drug-trial-1"><i class="fa fa-check"></i><b>10.2.9</b> Epilepsy drug trial</a></li>
<li class="chapter" data-level="10.2.10" data-path="exercise-solutions.html"><a href="exercise-solutions.html#bacterial-growth-curves-with-varioscan-1"><i class="fa fa-check"></i><b>10.2.10</b> Bacterial growth curves with Varioscan</a></li>
<li class="chapter" data-level="10.2.11" data-path="exercise-solutions.html"><a href="exercise-solutions.html#the-dinos-1"><i class="fa fa-check"></i><b>10.2.11</b> The dinos</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="exercise-solutions.html"><a href="exercise-solutions.html#the-tidyr-and-dplyr-packages-1"><i class="fa fa-check"></i><b>10.3</b> The <code>tidyr</code> and <code>dplyr</code> packages</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#global-temperature-revisited-1"><i class="fa fa-check"></i><b>10.3.1</b> Global temperature revisited</a></li>
<li class="chapter" data-level="10.3.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#chickweight-1"><i class="fa fa-check"></i><b>10.3.2</b> ChickWeight</a></li>
<li class="chapter" data-level="10.3.3" data-path="exercise-solutions.html"><a href="exercise-solutions.html#population-numbers-1"><i class="fa fa-check"></i><b>10.3.3</b> Population numbers</a></li>
<li class="chapter" data-level="10.3.4" data-path="exercise-solutions.html"><a href="exercise-solutions.html#rubella-and-measles-1"><i class="fa fa-check"></i><b>10.3.4</b> Rubella and Measles</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exercise-solutions.html"><a href="exercise-solutions.html#the-lubridate-package-1"><i class="fa fa-check"></i><b>10.4</b> The <code>lubridate</code> package</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#female-births-1"><i class="fa fa-check"></i><b>10.4.1</b> Female births</a></li>
<li class="chapter" data-level="10.4.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#diabetes-1"><i class="fa fa-check"></i><b>10.4.2</b> Diabetes</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="exercise-solutions.html"><a href="exercise-solutions.html#the-stringr-package-1"><i class="fa fa-check"></i><b>10.5</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="parsing-complex-data.html"><a href="parsing-complex-data.html"><i class="fa fa-check"></i><b>11</b> Parsing complex data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis and Visualization using R (2)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-solutions" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Exercise Solutions</h1>
<div id="introduction-6" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<p>Only solutions chunks are displayed here, not the output - except for the plots.</p>
</div>
<div id="the-ggplot2-and-tidyr-packages-1" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> The <code>ggplot2</code> and <code>tidyr</code> packages</h2>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="exercise-solutions.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb474-2"><a href="exercise-solutions.html#cb474-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb474-3"><a href="exercise-solutions.html#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb474-4"><a href="exercise-solutions.html#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<div id="trees-1" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Trees</h3>
<p><strong>A [❋]</strong></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="exercise-solutions.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> trees, </span>
<span id="cb475-2"><a href="exercise-solutions.html#cb475-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Girth, <span class="at">y =</span> Height)) <span class="sc">+</span></span>
<span id="cb475-3"><a href="exercise-solutions.html#cb475-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-4"><a href="exercise-solutions.html#cb475-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;Girth (in)&#39;</span>) <span class="sc">+</span></span>
<span id="cb475-5"><a href="exercise-solutions.html#cb475-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Height (ft)&#39;</span>)</span></code></pre></div>
<p><strong>B [❋❋]</strong></p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="exercise-solutions.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> trees, </span>
<span id="cb476-2"><a href="exercise-solutions.html#cb476-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Girth, <span class="at">y =</span> Height)) <span class="sc">+</span></span>
<span id="cb476-3"><a href="exercise-solutions.html#cb476-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb476-4"><a href="exercise-solutions.html#cb476-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb476-5"><a href="exercise-solutions.html#cb476-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;Girth (in)&#39;</span>) <span class="sc">+</span></span>
<span id="cb476-6"><a href="exercise-solutions.html#cb476-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Height (ft)&#39;</span>)</span></code></pre></div>
<p><strong>C [❋❋]</strong></p>
<p>Final figure.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="exercise-solutions.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> trees, </span>
<span id="cb477-2"><a href="exercise-solutions.html#cb477-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Girth, <span class="at">y =</span> Height)) <span class="sc">+</span></span>
<span id="cb477-3"><a href="exercise-solutions.html#cb477-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> Volume), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb477-4"><a href="exercise-solutions.html#cb477-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb477-5"><a href="exercise-solutions.html#cb477-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;Girth (in)&#39;</span>) <span class="sc">+</span></span>
<span id="cb477-6"><a href="exercise-solutions.html#cb477-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Height (ft)&#39;</span>) <span class="sc">+</span></span>
<span id="cb477-7"><a href="exercise-solutions.html#cb477-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">size =</span> <span class="st">&#39;Volume (ft^3)&#39;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:trees-C"></span>
<img src="bookdown-demo_files/figure-html/trees-C-1.png" alt="Tree girth, height and volume relationship" width="80%" />
<p class="caption">
Figure 10.1: Tree girth, height and volume relationship
</p>
</div>
</div>
<div id="insect-sprays-1" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Insect Sprays</h3>
<p>The <code>datasets</code> package that is shipped with R has a dataset called <code>?</code>. Type <code>?InsectSprays</code> to get information on it.</p>
<p><strong>A [❋]</strong></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="exercise-solutions.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> InsectSprays, </span>
<span id="cb479-2"><a href="exercise-solutions.html#cb479-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> spray, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb479-3"><a href="exercise-solutions.html#cb479-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb479-4"><a href="exercise-solutions.html#cb479-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Insect count&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-5"><a href="exercise-solutions.html#cb479-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Insect spray&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:insect-sprays-A"></span>
<img src="bookdown-demo_files/figure-html/insect-sprays-A-1.png" alt="The counts of insects in agricultural experimental units treated with different insecticides" width="80%" />
<p class="caption">
Figure 10.2: The counts of insects in agricultural experimental units treated with different insecticides
</p>
</div>
<p><strong>B [❋❋]</strong><br />
Create a jitter plot, splitting on the spray type and jittering minimally on the y-axis. Make sure that overlapping plot symbols do not hide each other and try to find a nice color.
[Extra: Give each spray a different plot symbol.]</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="exercise-solutions.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> InsectSprays, </span>
<span id="cb480-2"><a href="exercise-solutions.html#cb480-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> spray, <span class="at">y =</span> count, <span class="at">color =</span> spray)) <span class="sc">+</span></span>
<span id="cb480-3"><a href="exercise-solutions.html#cb480-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">shape =</span> <span class="dv">18</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb480-4"><a href="exercise-solutions.html#cb480-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Insect count&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-5"><a href="exercise-solutions.html#cb480-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Insect spray&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:insect-sprays-B"></span>
<img src="bookdown-demo_files/figure-html/insect-sprays-B-1.png" alt="The counts of insects in agricultural experimental units treated with different insecticides" width="80%" />
<p class="caption">
Figure 10.3: The counts of insects in agricultural experimental units treated with different insecticides
</p>
</div>
</div>
<div id="diauxic-growth-1" class="section level3" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Diauxic growth</h3>
<p><strong>A [❋❋]</strong></p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="exercise-solutions.html#cb481-1" aria-hidden="true" tabindex="-1"></a>remote <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/diauxic_growth/monod_diauxic_growth.csv&quot;</span></span>
<span id="cb481-2"><a href="exercise-solutions.html#cb481-2" aria-hidden="true" tabindex="-1"></a>local <span class="ot">&lt;-</span> <span class="st">&quot;../diauxic.csv&quot;</span></span>
<span id="cb481-3"><a href="exercise-solutions.html#cb481-3" aria-hidden="true" tabindex="-1"></a><span class="co">#download.file(url = remote, destfile = local)</span></span>
<span id="cb481-4"><a href="exercise-solutions.html#cb481-4" aria-hidden="true" tabindex="-1"></a>diauxic <span class="ot">&lt;-</span> <span class="fu">read.table</span>(local, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb481-5"><a href="exercise-solutions.html#cb481-5" aria-hidden="true" tabindex="-1"></a>diauxic <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> diauxic,</span>
<span id="cb481-6"><a href="exercise-solutions.html#cb481-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb481-7"><a href="exercise-solutions.html#cb481-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">&quot;Substrate&quot;</span>,</span>
<span id="cb481-8"><a href="exercise-solutions.html#cb481-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">&quot;OD&quot;</span>)</span></code></pre></div>
<p><strong>B [❋]</strong></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="exercise-solutions.html#cb482-1" aria-hidden="true" tabindex="-1"></a>diauxic<span class="sc">$</span>Substrate <span class="ot">&lt;-</span> <span class="fu">factor</span>(diauxic<span class="sc">$</span>Substrate, </span>
<span id="cb482-2"><a href="exercise-solutions.html#cb482-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;GlucMann&quot;</span>, <span class="st">&quot;GlucXyl&quot;</span>, <span class="st">&quot;GlucArab&quot;</span>, <span class="st">&quot;GlucRham&quot;</span>), </span>
<span id="cb482-3"><a href="exercise-solutions.html#cb482-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Glucose Mannose&quot;</span>, <span class="st">&quot;Glucose Xylose&quot;</span>, <span class="st">&quot;Glucose Arabinose&quot;</span>, <span class="st">&quot;Glucose Rhamnose&quot;</span>))</span></code></pre></div>
<p><strong>C [❋❋]</strong></p>
<p>Create a line plot with all four growth curves within a single graph.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="exercise-solutions.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diauxic,</span>
<span id="cb483-2"><a href="exercise-solutions.html#cb483-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> OD, <span class="at">color =</span> Substrate)) <span class="sc">+</span></span>
<span id="cb483-3"><a href="exercise-solutions.html#cb483-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb483-4"><a href="exercise-solutions.html#cb483-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb483-5"><a href="exercise-solutions.html#cb483-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diauxic-growth-C"></span>
<img src="bookdown-demo_files/figure-html/diauxic-growth-C-1.png" alt="Monod's Diauxic shift experiment." width="80%" />
<p class="caption">
Figure 10.4: Monod’s Diauxic shift experiment.
</p>
</div>
<p><strong>D [❋❋❋]</strong></p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="exercise-solutions.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diauxic,</span>
<span id="cb485-2"><a href="exercise-solutions.html#cb485-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> OD)) <span class="sc">+</span></span>
<span id="cb485-3"><a href="exercise-solutions.html#cb485-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb485-4"><a href="exercise-solutions.html#cb485-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb485-5"><a href="exercise-solutions.html#cb485-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(. <span class="sc">~</span> Substrate, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb485-6"><a href="exercise-solutions.html#cb485-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diauxic-growth-D"></span>
<img src="bookdown-demo_files/figure-html/diauxic-growth-D-1.png" alt="Monod's Diauxic shift experiment." width="80%" />
<p class="caption">
Figure 10.5: Monod’s Diauxic shift experiment.
</p>
</div>
</div>
<div id="virginia-death-rates-1" class="section level3" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> Virginia Death Rates</h3>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="exercise-solutions.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb487-2"><a href="exercise-solutions.html#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="do">## %&gt;% is used to pipe results from one operation to the other, just like &#39;|&#39; in Linux.</span></span>
<span id="cb487-3"><a href="exercise-solutions.html#cb487-3" aria-hidden="true" tabindex="-1"></a>virginia_death_rates <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(VADeaths)</span>
<span id="cb487-4"><a href="exercise-solutions.html#cb487-4" aria-hidden="true" tabindex="-1"></a>virginia_death_rates <span class="ot">&lt;-</span> virginia_death_rates <span class="sc">%&gt;%</span> </span>
<span id="cb487-5"><a href="exercise-solutions.html#cb487-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">&quot;Age Group&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">rownames</span>(virginia_death_rates), <span class="at">ordered =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb487-6"><a href="exercise-solutions.html#cb487-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">Age Group</span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="co">#reorder the columns</span></span></code></pre></div>
<p><strong>A (❋❋;❋)</strong></p>
<p>Pivot this table to long (tidy) format. This should generate a dataframe with four columns: <code>Age Group</code>, <code>Habitat</code>, <code>Gender</code> and <code>DeathRate</code>.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="exercise-solutions.html#cb488-1" aria-hidden="true" tabindex="-1"></a>virginia_death_rates <span class="ot">&lt;-</span> virginia_death_rates <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb488-2"><a href="exercise-solutions.html#cb488-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;Habitat&quot;</span>, <span class="st">&quot;Gender&quot;</span>), </span>
<span id="cb488-3"><a href="exercise-solutions.html#cb488-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_sep =</span> <span class="st">&quot; &quot;</span>, </span>
<span id="cb488-4"><a href="exercise-solutions.html#cb488-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;DeathRate&quot;</span>)</span></code></pre></div>
<p><strong>B (❋❋)</strong></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="exercise-solutions.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> virginia_death_rates, <span class="fu">aes</span>(Gender)) <span class="sc">+</span></span>
<span id="cb489-2"><a href="exercise-solutions.html#cb489-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">weight =</span> DeathRate, <span class="at">fill =</span> Habitat), <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:VADeaths-B"></span>
<img src="bookdown-demo_files/figure-html/VADeaths-B-1.png" alt="Virginia Death rates" width="70%" />
<p class="caption">
Figure 10.6: Virginia Death rates
</p>
</div>
</div>
<div id="investigate-new-visualization-1" class="section level3" number="10.2.5">
<h3><span class="header-section-number">10.2.5</span> Investigate new visualization <sup><font size="3em">[❋❋]</font></sup></h3>
<p>This assignment has no solution of course. It is included here solely to keep the numbering consistent for both assignment chapters.</p>
</div>
<div id="toothgrowth-1" class="section level3" number="10.2.6">
<h3><span class="header-section-number">10.2.6</span> ToothGrowth</h3>
<p><strong>[❋❋]</strong></p>
<p>In my opinion, the boxplot is an excellent choice for this visualization. However, <code>geom_jitter()</code> could also work but is more of a hassle to split out on Dose.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="exercise-solutions.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ToothGrowth, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> supp, <span class="at">y =</span> len)) <span class="sc">+</span></span>
<span id="cb490-2"><a href="exercise-solutions.html#cb490-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">as.factor</span>(dose))) <span class="sc">+</span></span>
<span id="cb490-3"><a href="exercise-solutions.html#cb490-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Supplement&quot;</span>) <span class="sc">+</span></span>
<span id="cb490-4"><a href="exercise-solutions.html#cb490-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Tooth length (mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb490-5"><a href="exercise-solutions.html#cb490-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Dose (mg/day)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:toothgrowth"></span>
<img src="bookdown-demo_files/figure-html/toothgrowth-1.png" alt=" length of odontoblasts with vitamin C" width="80%" />
<p class="caption">
Figure 10.7:  length of odontoblasts with vitamin C
</p>
</div>
</div>
<div id="puromycin-1" class="section level3" number="10.2.7">
<h3><span class="header-section-number">10.2.7</span> Puromycin</h3>
<p><strong>[❋❋❋]</strong></p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="exercise-solutions.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Puromycin,</span>
<span id="cb491-2"><a href="exercise-solutions.html#cb491-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> rate, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb491-3"><a href="exercise-solutions.html#cb491-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb491-4"><a href="exercise-solutions.html#cb491-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">log</span>(x), <span class="at">se =</span> F)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:puromycin2"></span>
<img src="bookdown-demo_files/figure-html/puromycin2-1.png" alt="reaction velocity versus substrate concentration" width="80%" />
<p class="caption">
Figure 10.8: reaction velocity versus substrate concentration
</p>
</div>
</div>
<div id="global-temperature-1" class="section level3" number="10.2.8">
<h3><span class="header-section-number">10.2.8</span> Global temperature</h3>
<p>Load the data.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="exercise-solutions.html#cb492-1" aria-hidden="true" tabindex="-1"></a>remote_file <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/global_temperature/annual.csv&quot;</span></span>
<span id="cb492-2"><a href="exercise-solutions.html#cb492-2" aria-hidden="true" tabindex="-1"></a>local_file <span class="ot">&lt;-</span> <span class="st">&quot;../annual.csv&quot;</span></span>
<span id="cb492-3"><a href="exercise-solutions.html#cb492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-4"><a href="exercise-solutions.html#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span> <span class="fu">file.exists</span>(local_file)) {</span>
<span id="cb492-5"><a href="exercise-solutions.html#cb492-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(remote_file, <span class="at">destfile =</span> local_file)</span>
<span id="cb492-6"><a href="exercise-solutions.html#cb492-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb492-7"><a href="exercise-solutions.html#cb492-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-8"><a href="exercise-solutions.html#cb492-8" aria-hidden="true" tabindex="-1"></a>global_temp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;annual.csv&quot;</span>,</span>
<span id="cb492-9"><a href="exercise-solutions.html#cb492-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb492-10"><a href="exercise-solutions.html#cb492-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<div id="create-a-scatter-and-line-plot-1" class="section level4" number="10.2.8.1">
<h4><span class="header-section-number">10.2.8.1</span> Create a scatter-and-line-plot [❋❋]</h4>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="exercise-solutions.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> global_temp,</span>
<span id="cb493-2"><a href="exercise-solutions.html#cb493-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Mean, <span class="at">color =</span> Source)) <span class="sc">+</span></span>
<span id="cb493-3"><a href="exercise-solutions.html#cb493-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb493-4"><a href="exercise-solutions.html#cb493-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb493-5"><a href="exercise-solutions.html#cb493-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span></span>
<span id="cb493-6"><a href="exercise-solutions.html#cb493-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-global-temp"></span>
<img src="bookdown-demo_files/figure-html/scatter-global-temp-1.png" alt="Global temperature anomalies" width="80%" />
<p class="caption">
Figure 10.9: Global temperature anomalies
</p>
</div>
</div>
<div id="re-create-the-heatmap-1" class="section level4" number="10.2.8.2">
<h4><span class="header-section-number">10.2.8.2</span> Re-create the heatmap [❋❋❋]</h4>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="exercise-solutions.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> global_temp[global_temp<span class="sc">$</span>Source <span class="sc">==</span> <span class="st">&quot;GCAG&quot;</span>, ],</span>
<span id="cb495-2"><a href="exercise-solutions.html#cb495-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb495-3"><a href="exercise-solutions.html#cb495-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Mean), <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb495-4"><a href="exercise-solutions.html#cb495-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;white&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb495-5"><a href="exercise-solutions.html#cb495-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb495-6"><a href="exercise-solutions.html#cb495-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:heatmap-global-temp"></span>
<img src="bookdown-demo_files/figure-html/heatmap-global-temp-1.png" alt="Global temperature anomalies" width="80%" />
<p class="caption">
Figure 10.10: Global temperature anomalies
</p>
</div>
<p>Note: rescaling the temperature from 0 to 1 may yield even better results.</p>
</div>
</div>
<div id="epilepsy-drug-trial-1" class="section level3" number="10.2.9">
<h3><span class="header-section-number">10.2.9</span> Epilepsy drug trial</h3>
<div id="load-data" class="section level4" number="10.2.9.1">
<h4><span class="header-section-number">10.2.9.1</span> Load data <sup><font size="3em">[❋]</font></sup></h4>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="exercise-solutions.html#cb496-1" aria-hidden="true" tabindex="-1"></a>epilepsy_file <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/epilepsy/epilepsy.csv&quot;</span></span>
<span id="cb496-2"><a href="exercise-solutions.html#cb496-2" aria-hidden="true" tabindex="-1"></a>epilepsy <span class="ot">&lt;-</span> <span class="fu">read.table</span>(epilepsy_file,</span>
<span id="cb496-3"><a href="exercise-solutions.html#cb496-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb496-4"><a href="exercise-solutions.html#cb496-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb496-5"><a href="exercise-solutions.html#cb496-5" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span>period <span class="ot">&lt;-</span> <span class="fu">factor</span>(epilepsy<span class="sc">$</span>period, <span class="at">ordered=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="reorganize-the-data-1" class="section level4" number="10.2.9.2">
<h4><span class="header-section-number">10.2.9.2</span> Reorganize the data <sup><font size="3em">[❋❋]</font></sup></h4>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="exercise-solutions.html#cb497-1" aria-hidden="true" tabindex="-1"></a>epilepsy <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(</span>
<span id="cb497-2"><a href="exercise-solutions.html#cb497-2" aria-hidden="true" tabindex="-1"></a>    epilepsy[, <span class="fu">c</span>(<span class="st">&quot;subject&quot;</span>,<span class="st">&quot;age&quot;</span>,<span class="st">&quot;base&quot;</span>,<span class="st">&quot;treatment&quot;</span>,<span class="st">&quot;period&quot;</span>,<span class="st">&quot;seizure.rate&quot;</span>)])</span></code></pre></div>
</div>
<div id="create-plots-of-seizure-rates-1" class="section level4" number="10.2.9.3">
<h4><span class="header-section-number">10.2.9.3</span> Create plots of seizure rates</h4>
<p><strong>A [❋❋]</strong></p>
<p>I used the <code>color</code> aesthetic here:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="exercise-solutions.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epilepsy,</span>
<span id="cb498-2"><a href="exercise-solutions.html#cb498-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure.rate, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb498-3"><a href="exercise-solutions.html#cb498-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-seizure-rates"></span>
<img src="bookdown-demo_files/figure-html/boxplot-seizure-rates-1.png" alt="Seizure rates with color" width="80%" />
<p class="caption">
Figure 10.11: Seizure rates with color
</p>
</div>
<p>This is the alternative with <code>facet_wrap()</code></p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="exercise-solutions.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epilepsy,</span>
<span id="cb499-2"><a href="exercise-solutions.html#cb499-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure.rate)) <span class="sc">+</span></span>
<span id="cb499-3"><a href="exercise-solutions.html#cb499-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb499-4"><a href="exercise-solutions.html#cb499-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(. <span class="sc">~</span> treatment)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-seizure-rates2"></span>
<img src="bookdown-demo_files/figure-html/boxplot-seizure-rates2-1.png" alt="Seizure rates with facet wrap" width="80%" />
<p class="caption">
Figure 10.12: Seizure rates with facet wrap
</p>
</div>
<p><strong>B [❋❋❋]</strong></p>
<p>Again, this could be done with color or facetting, but in this case <code>shape</code> is also an option (not shown). I used a little trick to separate the <code>period</code> for treated/untreated.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="exercise-solutions.html#cb500-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> epilepsy</span>
<span id="cb500-2"><a href="exercise-solutions.html#cb500-2" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>period <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(tmp<span class="sc">$</span>period)</span>
<span id="cb500-3"><a href="exercise-solutions.html#cb500-3" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>period_offset <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(epilepsy<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;placebo&quot;</span>, tmp<span class="sc">$</span>period <span class="sc">-</span> <span class="fl">0.10</span>, tmp<span class="sc">$</span>period <span class="sc">+</span> <span class="fl">0.10</span>)</span>
<span id="cb500-4"><a href="exercise-solutions.html#cb500-4" aria-hidden="true" tabindex="-1"></a><span class="co">#tmp</span></span>
<span id="cb500-5"><a href="exercise-solutions.html#cb500-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> tmp,</span>
<span id="cb500-6"><a href="exercise-solutions.html#cb500-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period_offset, <span class="at">y =</span> seizure.rate, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb500-7"><a href="exercise-solutions.html#cb500-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-seizure-rates3"></span>
<img src="bookdown-demo_files/figure-html/boxplot-seizure-rates3-1.png" alt="Seizure rates" width="80%" />
<p class="caption">
Figure 10.13: Seizure rates
</p>
</div>
<p><strong>C [❋❋❋]</strong></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="exercise-solutions.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epilepsy,</span>
<span id="cb501-2"><a href="exercise-solutions.html#cb501-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure.rate, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb501-3"><a href="exercise-solutions.html#cb501-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> treatment), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb501-4"><a href="exercise-solutions.html#cb501-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">data =</span> tmp, <span class="fu">aes</span>(<span class="at">x =</span> period_offset), <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">shape =</span> <span class="dv">18</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb501-5"><a href="exercise-solutions.html#cb501-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-seizure-rates4"></span>
<img src="bookdown-demo_files/figure-html/boxplot-seizure-rates4-1.png" alt="Seizure rates" width="90%" />
<p class="caption">
Figure 10.14: Seizure rates
</p>
</div>
<p>Note that it would have been nicer to omit the outliers from the boxplot. This is your challenge.</p>
<p>There are many more variations possible! You should really explore some of these as practice.</p>
</div>
<div id="a-boxplot-after-correction-1" class="section level4" number="10.2.9.4">
<h4><span class="header-section-number">10.2.9.4</span> A boxplot after correction <sup><font size="3em">[❋❋❋]</font></sup></h4>
<p>Correction:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="exercise-solutions.html#cb502-1" aria-hidden="true" tabindex="-1"></a>epilepsy_corrected <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb502-2"><a href="exercise-solutions.html#cb502-2" aria-hidden="true" tabindex="-1"></a>    seizure.rate <span class="sc">~</span> subject <span class="sc">+</span> age <span class="sc">+</span> base <span class="sc">+</span> treatment, </span>
<span id="cb502-3"><a href="exercise-solutions.html#cb502-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> epilepsy, </span>
<span id="cb502-4"><a href="exercise-solutions.html#cb502-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> sum)</span>
<span id="cb502-5"><a href="exercise-solutions.html#cb502-5" aria-hidden="true" tabindex="-1"></a>epilepsy_corrected<span class="sc">$</span>seizure_rate_corrected <span class="ot">&lt;-</span> epilepsy_corrected<span class="sc">$</span>seizure.rate <span class="sc">-</span> epilepsy_corrected<span class="sc">$</span>base</span></code></pre></div>
<p>The plot:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="exercise-solutions.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epilepsy_corrected,</span>
<span id="cb503-2"><a href="exercise-solutions.html#cb503-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> seizure_rate_corrected)) <span class="sc">+</span></span>
<span id="cb503-3"><a href="exercise-solutions.html#cb503-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxplot-seizure-rates5"></span>
<img src="bookdown-demo_files/figure-html/boxplot-seizure-rates5-1.png" alt="Seizure rates after correction" width="80%" />
<p class="caption">
Figure 10.15: Seizure rates after correction
</p>
</div>
</div>
<div id="test-for-statistical-significance-1" class="section level4" number="10.2.9.5">
<h4><span class="header-section-number">10.2.9.5</span> Test for statistical significance <sup><font size="3em">[❋❋❋]</font></sup></h4>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="exercise-solutions.html#cb504-1" aria-hidden="true" tabindex="-1"></a>placebo <span class="ot">&lt;-</span> epilepsy_corrected<span class="sc">$</span>seizure_rate_corrected[epilepsy_corrected<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;placebo&quot;</span>]</span>
<span id="cb504-2"><a href="exercise-solutions.html#cb504-2" aria-hidden="true" tabindex="-1"></a>treated <span class="ot">&lt;-</span> epilepsy_corrected<span class="sc">$</span>seizure_rate_corrected[epilepsy_corrected<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;Progabide&quot;</span>]</span>
<span id="cb504-3"><a href="exercise-solutions.html#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="at">x =</span> placebo, <span class="at">y =</span> treated)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  placebo and treated
## t = 0.5, df = 53, p-value = 0.6
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -10.9  17.6
## sample estimates:
## mean of x mean of y 
##     3.607     0.226</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="exercise-solutions.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="do">##better:</span></span>
<span id="cb506-2"><a href="exercise-solutions.html#cb506-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(seizure_rate_corrected <span class="sc">~</span> treatment, <span class="at">data =</span> epilepsy_corrected)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  seizure_rate_corrected by treatment
## t = 0.5, df = 53, p-value = 0.6
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -10.9  17.6
## sample estimates:
##   mean in group placebo mean in group Progabide 
##                   3.607                   0.226</code></pre>
<p>Note: you should actually test for normality sing the <code>shapiro.test()</code> function before embarking on a t-test analysis:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="exercise-solutions.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(treated)</span>
<span id="cb508-2"><a href="exercise-solutions.html#cb508-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(placebo)</span></code></pre></div>
<p>So this is not the correct test; you should use the Mann-Whitney U test.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="exercise-solutions.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(seizure_rate_corrected <span class="sc">~</span> treatment, <span class="at">data =</span> epilepsy_corrected)</span></code></pre></div>
<pre><code>## Warning in wilcox.test.default(x = c(5L, 5L, 5L, -3L, 0L, 23L, 3L, 3L, 2L, :
## cannot compute exact p-value with ties</code></pre>
<pre><code>## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  seizure_rate_corrected by treatment
## W = 559, p-value = 0.06
## alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<div id="bacterial-growth-curves-with-varioscan-1" class="section level3" number="10.2.10">
<h3><span class="header-section-number">10.2.10</span> Bacterial growth curves with Varioscan</h3>
<div id="load-preprocess-and-tidy-1" class="section level4" number="10.2.10.1">
<h4><span class="header-section-number">10.2.10.1</span> Load, preprocess and tidy <sup><font size="3em">[❋❋❋❋]</font></sup></h4>
<p>Load:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="exercise-solutions.html#cb512-1" aria-hidden="true" tabindex="-1"></a>growth_data_file <span class="ot">&lt;-</span> <span class="st">&quot;data/varioscan/2020-01-30_wide.csv&quot;</span></span>
<span id="cb512-2"><a href="exercise-solutions.html#cb512-2" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(growth_data_file)</span></code></pre></div>
<p>Preprocess. Applying corrctions to the dataset is not easy as it is; this is much easier when the dataframe is transposed so samples are in columns and timepoints in rows. Also, transposition will force all data into character because the first columns contain character data. To prevent this, they are removed (and stored), leaving only the numerical OD measurements.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="exercise-solutions.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add rownames to get a hold of them after transpose</span></span>
<span id="cb513-2"><a href="exercise-solutions.html#cb513-2" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(growth_data<span class="sc">$</span>Content, <span class="st">&#39;.&#39;</span>,</span>
<span id="cb513-3"><a href="exercise-solutions.html#cb513-3" aria-hidden="true" tabindex="-1"></a>                    growth_data<span class="sc">$</span>.copy, <span class="st">&#39;.&#39;</span>,</span>
<span id="cb513-4"><a href="exercise-solutions.html#cb513-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="at">times =</span> <span class="dv">12</span>)) <span class="co">#letters A-H represent the 8 dilutions</span></span>
<span id="cb513-5"><a href="exercise-solutions.html#cb513-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(growth_data) <span class="ot">&lt;-</span> row_names</span>
<span id="cb513-6"><a href="exercise-solutions.html#cb513-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-7"><a href="exercise-solutions.html#cb513-7" aria-hidden="true" tabindex="-1"></a><span class="do">## remove non-numeric cols but store them first</span></span>
<span id="cb513-8"><a href="exercise-solutions.html#cb513-8" aria-hidden="true" tabindex="-1"></a>label_columns <span class="ot">&lt;-</span> growth_data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb513-9"><a href="exercise-solutions.html#cb513-9" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> growth_data[, <span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)]</span>
<span id="cb513-10"><a href="exercise-solutions.html#cb513-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-11"><a href="exercise-solutions.html#cb513-11" aria-hidden="true" tabindex="-1"></a><span class="do">## transpose</span></span>
<span id="cb513-12"><a href="exercise-solutions.html#cb513-12" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">t</span>(tmp)</span>
<span id="cb513-13"><a href="exercise-solutions.html#cb513-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-14"><a href="exercise-solutions.html#cb513-14" aria-hidden="true" tabindex="-1"></a><span class="do">## build a new dataframe/tibble, empty but with predefined number of rows</span></span>
<span id="cb513-15"><a href="exercise-solutions.html#cb513-15" aria-hidden="true" tabindex="-1"></a>growth_data_corr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">.rows =</span> <span class="fu">nrow</span>(tmp))</span></code></pre></div>
<p>Carry out the corrections; can this be done more efficiently? Take the challenge!</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="exercise-solutions.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="do">##1  9 17 25 33 41 49 57 65 73 81 89</span></span>
<span id="cb514-2"><a href="exercise-solutions.html#cb514-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-3"><a href="exercise-solutions.html#cb514-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col_select <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb514-4"><a href="exercise-solutions.html#cb514-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Using correction columns 25-32</span></span>
<span id="cb514-5"><a href="exercise-solutions.html#cb514-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Red.1: columns 1 to 8</span></span>
<span id="cb514-6"><a href="exercise-solutions.html#cb514-6" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select]] <span class="ot">&lt;-</span> tmp[ , col_select] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">24</span>]</span>
<span id="cb514-7"><a href="exercise-solutions.html#cb514-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Red.2: columns 9 to 16</span></span>
<span id="cb514-8"><a href="exercise-solutions.html#cb514-8" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">8</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">8</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">24</span>]</span>
<span id="cb514-9"><a href="exercise-solutions.html#cb514-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Red.3: columns 17 to 24</span></span>
<span id="cb514-10"><a href="exercise-solutions.html#cb514-10" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">16</span>]] <span class="ot">&lt;-</span> tmp[, col_select <span class="sc">+</span> <span class="dv">16</span>] <span class="sc">-</span> tmp[, col_select <span class="sc">+</span> <span class="dv">24</span>]</span>
<span id="cb514-11"><a href="exercise-solutions.html#cb514-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-12"><a href="exercise-solutions.html#cb514-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Using correction columns 57-64</span></span>
<span id="cb514-13"><a href="exercise-solutions.html#cb514-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#White.1: columns 33 to 40</span></span>
<span id="cb514-14"><a href="exercise-solutions.html#cb514-14" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">32</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">32</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">56</span>]</span>
<span id="cb514-15"><a href="exercise-solutions.html#cb514-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#White.2: columns 41 to 48</span></span>
<span id="cb514-16"><a href="exercise-solutions.html#cb514-16" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">40</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">40</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">56</span>]</span>
<span id="cb514-17"><a href="exercise-solutions.html#cb514-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#White.3: columns 49 to 56</span></span>
<span id="cb514-18"><a href="exercise-solutions.html#cb514-18" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">48</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">48</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">56</span>]</span>
<span id="cb514-19"><a href="exercise-solutions.html#cb514-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-20"><a href="exercise-solutions.html#cb514-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Using correction columns 89-96</span></span>
<span id="cb514-21"><a href="exercise-solutions.html#cb514-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Elution.1: columns 65 to 72</span></span>
<span id="cb514-22"><a href="exercise-solutions.html#cb514-22" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">64</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">64</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">88</span>]</span>
<span id="cb514-23"><a href="exercise-solutions.html#cb514-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Elution.2: columns 73 to 80</span></span>
<span id="cb514-24"><a href="exercise-solutions.html#cb514-24" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">72</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">72</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">88</span>]</span>
<span id="cb514-25"><a href="exercise-solutions.html#cb514-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Elution.1: columns 81 to 89</span></span>
<span id="cb514-26"><a href="exercise-solutions.html#cb514-26" aria-hidden="true" tabindex="-1"></a>    growth_data_corr[, row_names[col_select <span class="sc">+</span> <span class="dv">80</span>]] <span class="ot">&lt;-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">80</span>] <span class="sc">-</span> tmp[ , col_select <span class="sc">+</span> <span class="dv">88</span>]</span>
<span id="cb514-27"><a href="exercise-solutions.html#cb514-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb514-28"><a href="exercise-solutions.html#cb514-28" aria-hidden="true" tabindex="-1"></a>growth_data_corr <span class="ot">&lt;-</span> growth_data_corr[, row_names[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span><span class="sc">:</span><span class="dv">32</span>, <span class="dv">57</span><span class="sc">:</span><span class="dv">64</span>, <span class="dv">89</span><span class="sc">:</span><span class="dv">96</span>)]]</span></code></pre></div>
<p>Re-attach the</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="exercise-solutions.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Transpose back and re-attach the first columns and time series labels</span></span>
<span id="cb515-2"><a href="exercise-solutions.html#cb515-2" aria-hidden="true" tabindex="-1"></a>growth_data_corr <span class="ot">&lt;-</span> <span class="fu">t</span>(growth_data_corr)</span>
<span id="cb515-3"><a href="exercise-solutions.html#cb515-3" aria-hidden="true" tabindex="-1"></a>label_columns <span class="ot">&lt;-</span> label_columns[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span><span class="sc">:</span><span class="dv">32</span>, <span class="dv">57</span><span class="sc">:</span><span class="dv">64</span>, <span class="dv">89</span><span class="sc">:</span><span class="dv">96</span>), ]</span>
<span id="cb515-4"><a href="exercise-solutions.html#cb515-4" aria-hidden="true" tabindex="-1"></a>growth_data_corr <span class="ot">&lt;-</span> <span class="fu">cbind</span>(label_columns, growth_data_corr)</span>
<span id="cb515-5"><a href="exercise-solutions.html#cb515-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(growth_data_corr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">colnames</span>(label_columns), <span class="fu">rownames</span>(tmp))</span></code></pre></div>
<p>Tidy:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="exercise-solutions.html#cb516-1" aria-hidden="true" tabindex="-1"></a>growth_data_tidy <span class="ot">&lt;-</span> growth_data_corr <span class="sc">%&gt;%</span></span>
<span id="cb516-2"><a href="exercise-solutions.html#cb516-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;T.&quot;</span>),</span>
<span id="cb516-3"><a href="exercise-solutions.html#cb516-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_prefix =</span> <span class="st">&quot;T.&quot;</span>,</span>
<span id="cb516-4"><a href="exercise-solutions.html#cb516-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_to =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb516-5"><a href="exercise-solutions.html#cb516-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">values_to =</span> <span class="st">&quot;OD&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb516-6"><a href="exercise-solutions.html#cb516-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Time =</span> <span class="fu">as.integer</span>(Time)<span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb516-7"><a href="exercise-solutions.html#cb516-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Dilution =</span> <span class="fu">factor</span>(Dilution, <span class="at">ordered =</span> T),</span>
<span id="cb516-8"><a href="exercise-solutions.html#cb516-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">Copy =</span> <span class="fu">factor</span>(.copy, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb516-9"><a href="exercise-solutions.html#cb516-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Content, Copy, Dilution, Time, OD)</span></code></pre></div>
<p>Note that using the <code>names_prefix = "T."</code> argument makes the <code>T.</code> prefix disappear so converting time to a number is easier. This conversion is done in the last step of this workflow, and it is also converted to hours instead of minutes. <code>Dilution</code> and <code>.copy</code> are converted to factors so they can be used as discrete values in ggplot2.</p>
</div>
<div id="create-a-growth-curve-visualization-1" class="section level4" number="10.2.10.2">
<h4><span class="header-section-number">10.2.10.2</span> Create a growth curve visualization <sup><font size="3em">[❋❋❋❋]</font></sup></h4>
<p>Let’s first look at the three copies of the same sample. Can they maybe be merged?</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="exercise-solutions.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb517-2"><a href="exercise-solutions.html#cb517-2" aria-hidden="true" tabindex="-1"></a>growth_data_tidy <span class="sc">%&gt;%</span></span>
<span id="cb517-3"><a href="exercise-solutions.html#cb517-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Content <span class="sc">==</span> <span class="st">&quot;Red&quot;</span>, ) <span class="sc">%&gt;%</span></span>
<span id="cb517-4"><a href="exercise-solutions.html#cb517-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> OD)) <span class="sc">+</span></span>
<span id="cb517-5"><a href="exercise-solutions.html#cb517-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Dilution, <span class="at">linetype =</span> Copy)) <span class="sc">+</span></span>
<span id="cb517-6"><a href="exercise-solutions.html#cb517-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time (H)&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="exercise-solutions.html#cb518-1" aria-hidden="true" tabindex="-1"></a>growth_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.copy <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Dilution <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb518-2"><a href="exercise-solutions.html#cb518-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> OD)) <span class="sc">+</span></span>
<span id="cb518-3"><a href="exercise-solutions.html#cb518-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> Dilution, <span class="at">color =</span> Content)) <span class="sc">+</span></span>
<span id="cb518-4"><a href="exercise-solutions.html#cb518-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>()</span></code></pre></div>
</div>
</div>
<div id="the-dinos-1" class="section level3" number="10.2.11">
<h3><span class="header-section-number">10.2.11</span> The dinos</h3>
<div id="export-to-csv-1" class="section level4" number="10.2.11.1">
<h4><span class="header-section-number">10.2.11.1</span> export to csv <sup><font size="3em">[❋❋]</font></sup></h4>
<p>This exercise has no code. I exported the data and placed the csv files under <code>data/dinos/</code> of this repo.</p>
</div>
<div id="clean-up-and-load-codebook.csv-1" class="section level4" number="10.2.11.2">
<h4><span class="header-section-number">10.2.11.2</span> clean up and load <code>codebook.csv</code></h4>
<p>Non-data lines were deleted. Lines 1-18 relate to skeleton data and 19-29 to footprint data.</p>
<p><strong>A [❋]</strong></p>
<p>The separator is “:” but it is not possible to define multi-character separators in <code>read.table()</code>. For now, simply use “:”</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="exercise-solutions.html#cb519-1" aria-hidden="true" tabindex="-1"></a>codebook_file <span class="ot">&lt;-</span> <span class="st">&quot;data/dinos/codebook.csv&quot;</span></span>
<span id="cb519-2"><a href="exercise-solutions.html#cb519-2" aria-hidden="true" tabindex="-1"></a>codebook <span class="ot">&lt;-</span> <span class="fu">read.table</span>(codebook_file, </span>
<span id="cb519-3"><a href="exercise-solutions.html#cb519-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>,</span>
<span id="cb519-4"><a href="exercise-solutions.html#cb519-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><strong>B [❋]</strong></p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="exercise-solutions.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(codebook) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;variable&#39;</span>, <span class="st">&#39;description&#39;</span>)</span></code></pre></div>
<p><strong>C [❋❋]</strong></p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="exercise-solutions.html#cb521-1" aria-hidden="true" tabindex="-1"></a>codebook<span class="sc">$</span>description <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&#39;^ &#39;</span>, <span class="st">&#39;&#39;</span>, codebook<span class="sc">$</span>description)</span></code></pre></div>
<p><strong>D [❋❋]</strong></p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="exercise-solutions.html#cb522-1" aria-hidden="true" tabindex="-1"></a>codebook<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&#39;skeleton&#39;</span>, <span class="dv">18</span>), <span class="fu">rep</span>(<span class="st">&#39;footprint&#39;</span>, <span class="dv">11</span>))</span></code></pre></div>
</div>
<div id="write-a-utility-function-1" class="section level4" number="10.2.11.3">
<h4><span class="header-section-number">10.2.11.3</span> Write a utility function <sup><font size="3em">[❋❋❋]</font></sup></h4>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="exercise-solutions.html#cb523-1" aria-hidden="true" tabindex="-1"></a>get_description <span class="ot">&lt;-</span> <span class="cf">function</span>(column_name, <span class="at">dataset =</span> <span class="st">&#39;skeleton&#39;</span>) {</span>
<span id="cb523-2"><a href="exercise-solutions.html#cb523-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> <span class="fu">is.element</span>(dataset, codebook<span class="sc">$</span>dataset)) {</span>
<span id="cb523-3"><a href="exercise-solutions.html#cb523-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&#39;dataset &#39;</span>, dataset, <span class="st">&#39; does not exist&#39;</span>))</span>
<span id="cb523-4"><a href="exercise-solutions.html#cb523-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb523-5"><a href="exercise-solutions.html#cb523-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> <span class="fu">is.element</span>(column_name, codebook<span class="sc">$</span>variable)) {</span>
<span id="cb523-6"><a href="exercise-solutions.html#cb523-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&#39;column &#39;</span>, column_name, <span class="st">&#39; does not exist&#39;</span>))</span>
<span id="cb523-7"><a href="exercise-solutions.html#cb523-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb523-8"><a href="exercise-solutions.html#cb523-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">##return the value</span></span>
<span id="cb523-9"><a href="exercise-solutions.html#cb523-9" aria-hidden="true" tabindex="-1"></a>    codebook[codebook<span class="sc">$</span>dataset <span class="sc">==</span> dataset <span class="sc">&amp;</span> codebook<span class="sc">$</span>variable <span class="sc">==</span> column_name, <span class="st">&quot;description&quot;</span>]</span>
<span id="cb523-10"><a href="exercise-solutions.html#cb523-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb523-11"><a href="exercise-solutions.html#cb523-11" aria-hidden="true" tabindex="-1"></a><span class="fu">get_description</span>(<span class="st">&#39;Dinosaur_gen&#39;</span>, <span class="st">&#39;skeleton&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Number of genera of Dinosauria&quot;</code></pre>
</div>
<div id="load-skeleton-data-1" class="section level4" number="10.2.11.4">
<h4><span class="header-section-number">10.2.11.4</span> Load skeleton data <sup><font size="3em">[❋]</font></sup></h4>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="exercise-solutions.html#cb525-1" aria-hidden="true" tabindex="-1"></a>skeleton_file <span class="ot">&lt;-</span> <span class="st">&quot;data/dinos/skeletons.csv&quot;</span></span>
<span id="cb525-2"><a href="exercise-solutions.html#cb525-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-3"><a href="exercise-solutions.html#cb525-3" aria-hidden="true" tabindex="-1"></a>(skeleton <span class="ot">&lt;-</span> <span class="fu">read.table</span>(skeleton_file, </span>
<span id="cb525-4"><a href="exercise-solutions.html#cb525-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb525-5"><a href="exercise-solutions.html#cb525-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb525-6"><a href="exercise-solutions.html#cb525-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb525-7"><a href="exercise-solutions.html#cb525-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">as.is =</span> <span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="plot-species-versus-time-1" class="section level4" number="10.2.11.5">
<h4><span class="header-section-number">10.2.11.5</span> Plot species versus time <sup><font size="3em">[❋❋❋]</font></sup></h4>
<p>Note the use of the utility function previously created, <code>get_description()</code>.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="exercise-solutions.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> skeleton,</span>
<span id="cb526-2"><a href="exercise-solutions.html#cb526-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> <span class="fu">log2</span>(Total_spec))) <span class="sc">+</span></span>
<span id="cb526-3"><a href="exercise-solutions.html#cb526-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Epoch)) <span class="sc">+</span> </span>
<span id="cb526-4"><a href="exercise-solutions.html#cb526-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span></span>
<span id="cb526-5"><a href="exercise-solutions.html#cb526-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="fu">get_description</span>(<span class="st">&quot;Midpoint&quot;</span>)) <span class="sc">+</span></span>
<span id="cb526-6"><a href="exercise-solutions.html#cb526-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;log2 of &quot;</span>, <span class="fu">get_description</span>(<span class="st">&quot;Total_spec&quot;</span>))) <span class="sc">+</span></span>
<span id="cb526-7"><a href="exercise-solutions.html#cb526-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:species-vs-time"></span>
<img src="bookdown-demo_files/figure-html/species-vs-time-1.png" alt="A first visualization" width="80%" />
<p class="caption">
Figure 10.16: A first visualization
</p>
</div>
</div>
<div id="reproducing-the-publication-figure-1" class="section level4" number="10.2.11.6">
<h4><span class="header-section-number">10.2.11.6</span> Reproducing the publication figure</h4>
<p><strong>A [❋❋]</strong></p>
<p>We have not yet dealt with <code>dplyr</code> so we’ll use base R for this. Note that the column <code>Total_gen</code> already contains the sum of all tetrapods.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="exercise-solutions.html#cb528-1" aria-hidden="true" tabindex="-1"></a>skeleton<span class="sc">$</span>genera_proportion <span class="ot">&lt;-</span> (skeleton<span class="sc">$</span>Dinosaur_gen <span class="sc">/</span> skeleton<span class="sc">$</span>Total_gen) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb528-2"><a href="exercise-solutions.html#cb528-2" aria-hidden="true" tabindex="-1"></a>skeleton<span class="sc">$</span>specimen_proportion <span class="ot">&lt;-</span> (skeleton<span class="sc">$</span>Dinosaur_spec <span class="sc">/</span> skeleton<span class="sc">$</span>Total_spec) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<p><strong>B [❋❋❋]</strong></p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="exercise-solutions.html#cb529-1" aria-hidden="true" tabindex="-1"></a>skeleton_proportions <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb529-2"><a href="exercise-solutions.html#cb529-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(genera_proportion, specimen_proportion) <span class="sc">~</span> Epoch <span class="sc">+</span> Stage <span class="sc">+</span> Midpoint, </span>
<span id="cb529-3"><a href="exercise-solutions.html#cb529-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> skeleton,</span>
<span id="cb529-4"><a href="exercise-solutions.html#cb529-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> mean)</span></code></pre></div>
<p><strong>C [❋❋❋]</strong></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="exercise-solutions.html#cb530-1" aria-hidden="true" tabindex="-1"></a>skeleton_proportions_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> skeleton_proportions, </span>
<span id="cb530-2"><a href="exercise-solutions.html#cb530-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_to =</span> <span class="st">&quot;level&quot;</span>, </span>
<span id="cb530-3"><a href="exercise-solutions.html#cb530-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">values_to =</span> <span class="st">&quot;Proportion&quot;</span>, </span>
<span id="cb530-4"><a href="exercise-solutions.html#cb530-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">&quot;_proportion&quot;</span>))</span></code></pre></div>
<p><strong>D [❋❋❋❋]</strong></p>
<p>First it needs to be flattened for use in ggplot2:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="exercise-solutions.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> skeleton_proportions_long,</span>
<span id="cb531-2"><a href="exercise-solutions.html#cb531-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> Proportion, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb531-3"><a href="exercise-solutions.html#cb531-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb531-4"><a href="exercise-solutions.html#cb531-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb531-5"><a href="exercise-solutions.html#cb531-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb531-6"><a href="exercise-solutions.html#cb531-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Geological age (Myr)&quot;</span>) <span class="sc">+</span></span>
<span id="cb531-7"><a href="exercise-solutions.html#cb531-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">&quot;goldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb531-8"><a href="exercise-solutions.html#cb531-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">label =</span> <span class="st">&quot;CPE&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plot-reprodiction1"></span>
<img src="bookdown-demo_files/figure-html/plot-reprodiction1-1.png" alt="A reproduction" width="80%" />
<p class="caption">
Figure 10.17: A reproduction
</p>
</div>
<p><strong>E [❋❋❋❋❋]</strong></p>
<p>Actually, this is not that simple to do with base R. What you want is a function that calculates the mean over a time period or over a fixed sequence of numbers. We’ll take the mean over a sequence of 3 numbers. This could be a possible solution, using a <code>for</code> loop.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="exercise-solutions.html#cb532-1" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(skeleton_proportions)</span>
<span id="cb532-2"><a href="exercise-solutions.html#cb532-2" aria-hidden="true" tabindex="-1"></a>moving_average_spec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(rows)</span>
<span id="cb532-3"><a href="exercise-solutions.html#cb532-3" aria-hidden="true" tabindex="-1"></a>moving_average_gen <span class="ot">&lt;-</span> <span class="fu">numeric</span>(rows)</span>
<span id="cb532-4"><a href="exercise-solutions.html#cb532-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb532-5"><a href="exercise-solutions.html#cb532-5" aria-hidden="true" tabindex="-1"></a><span class="do">## reversed traversal!</span></span>
<span id="cb532-6"><a href="exercise-solutions.html#cb532-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rows<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb532-7"><a href="exercise-solutions.html#cb532-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;=</span> rows <span class="sc">-</span> n) {</span>
<span id="cb532-8"><a href="exercise-solutions.html#cb532-8" aria-hidden="true" tabindex="-1"></a>        series <span class="ot">&lt;-</span> i<span class="sc">:</span>rows</span>
<span id="cb532-9"><a href="exercise-solutions.html#cb532-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb532-10"><a href="exercise-solutions.html#cb532-10" aria-hidden="true" tabindex="-1"></a>        series <span class="ot">&lt;-</span> i<span class="sc">:</span>(i<span class="sc">+</span>n) <span class="do">## beware of the parentheses!</span></span>
<span id="cb532-11"><a href="exercise-solutions.html#cb532-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb532-12"><a href="exercise-solutions.html#cb532-12" aria-hidden="true" tabindex="-1"></a>    moving_average_gen[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(skeleton_proportions<span class="sc">$</span>genera_prop[series])</span>
<span id="cb532-13"><a href="exercise-solutions.html#cb532-13" aria-hidden="true" tabindex="-1"></a>    moving_average_spec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(skeleton_proportions<span class="sc">$</span>specimen_prop[series])</span>
<span id="cb532-14"><a href="exercise-solutions.html#cb532-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb532-15"><a href="exercise-solutions.html#cb532-15" aria-hidden="true" tabindex="-1"></a><span class="do">##attach to the proportions dataframe</span></span>
<span id="cb532-16"><a href="exercise-solutions.html#cb532-16" aria-hidden="true" tabindex="-1"></a>skeleton_proportions<span class="sc">$</span>specimen_moving_average <span class="ot">&lt;-</span> moving_average_spec</span>
<span id="cb532-17"><a href="exercise-solutions.html#cb532-17" aria-hidden="true" tabindex="-1"></a>skeleton_proportions<span class="sc">$</span>genera_moving_average <span class="ot">&lt;-</span> moving_average_gen</span>
<span id="cb532-18"><a href="exercise-solutions.html#cb532-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-19"><a href="exercise-solutions.html#cb532-19" aria-hidden="true" tabindex="-1"></a><span class="co">#skeleton_proportions &lt;- skeleton_proportions[, c(1:4, 6, 5, 7)] </span></span>
<span id="cb532-20"><a href="exercise-solutions.html#cb532-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-21"><a href="exercise-solutions.html#cb532-21" aria-hidden="true" tabindex="-1"></a><span class="do">## recreate the long form. Note the use of `.value` which is a critical aspect!</span></span>
<span id="cb532-22"><a href="exercise-solutions.html#cb532-22" aria-hidden="true" tabindex="-1"></a>skeleton_prop_avg_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> skeleton_proportions,</span>
<span id="cb532-23"><a href="exercise-solutions.html#cb532-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;_&quot;</span>),</span>
<span id="cb532-24"><a href="exercise-solutions.html#cb532-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_pattern =</span> <span class="st">&quot;(genera|specimen)_(proportion|moving_average)&quot;</span>,</span>
<span id="cb532-25"><a href="exercise-solutions.html#cb532-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;level&quot;</span>,<span class="st">&quot;.value&quot;</span>))</span></code></pre></div>
<p>Finally, plot:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="exercise-solutions.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> skeleton_prop_avg_long) <span class="sc">+</span></span>
<span id="cb533-2"><a href="exercise-solutions.html#cb533-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> proportion, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb533-3"><a href="exercise-solutions.html#cb533-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> moving_average, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb533-4"><a href="exercise-solutions.html#cb533-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb533-5"><a href="exercise-solutions.html#cb533-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb533-6"><a href="exercise-solutions.html#cb533-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Geological age (Myr)&quot;</span>) <span class="sc">+</span></span>
<span id="cb533-7"><a href="exercise-solutions.html#cb533-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">&quot;goldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb533-8"><a href="exercise-solutions.html#cb533-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">label =</span> <span class="st">&quot;CPE&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plot-reprodiction2"></span>
<img src="bookdown-demo_files/figure-html/plot-reprodiction2-1.png" alt="A reproduction" width="80%" />
<p class="caption">
Figure 10.18: A reproduction
</p>
</div>
<p><strong>[THIS IS NOT CORRECT YET!!]</strong></p>
</div>
<div id="make-a-better-figure-1" class="section level4" number="10.2.11.7">
<h4><span class="header-section-number">10.2.11.7</span> Make a better figure <sup><font size="3em">[❋❋❋❋]</font></sup></h4>
<p>The Loess regression curve is a favorite of mine.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="exercise-solutions.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> skeleton_prop_avg_long, </span>
<span id="cb534-2"><a href="exercise-solutions.html#cb534-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> proportion, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb534-3"><a href="exercise-solutions.html#cb534-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb534-4"><a href="exercise-solutions.html#cb534-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb534-5"><a href="exercise-solutions.html#cb534-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb534-6"><a href="exercise-solutions.html#cb534-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb534-7"><a href="exercise-solutions.html#cb534-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Geological age (Myr)&quot;</span>) <span class="sc">+</span></span>
<span id="cb534-8"><a href="exercise-solutions.html#cb534-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">&quot;goldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb534-9"><a href="exercise-solutions.html#cb534-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">label =</span> <span class="st">&quot;CPE&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:plot-reprodiction3"></span>
<img src="bookdown-demo_files/figure-html/plot-reprodiction3-1.png" alt="A reproduction" width="80%" />
<p class="caption">
Figure 10.19: A reproduction
</p>
</div>
</div>
<div id="use-the-size-aesthetic-1" class="section level4" number="10.2.11.8">
<h4><span class="header-section-number">10.2.11.8</span> Use the size aesthetic <sup><font size="3em">[❋❋❋❋❋]</font></sup></h4>
<p>We need more data for this, the totals for each “Stage”:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="exercise-solutions.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="do">## re-create mean proportions</span></span>
<span id="cb536-2"><a href="exercise-solutions.html#cb536-2" aria-hidden="true" tabindex="-1"></a>skeleton_proportions <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb536-3"><a href="exercise-solutions.html#cb536-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(genera_proportion, specimen_proportion) <span class="sc">~</span> Epoch <span class="sc">+</span> Stage <span class="sc">+</span> Midpoint, </span>
<span id="cb536-4"><a href="exercise-solutions.html#cb536-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> skeleton,</span>
<span id="cb536-5"><a href="exercise-solutions.html#cb536-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> mean)</span>
<span id="cb536-6"><a href="exercise-solutions.html#cb536-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-7"><a href="exercise-solutions.html#cb536-7" aria-hidden="true" tabindex="-1"></a><span class="do">## first sum the finds:</span></span>
<span id="cb536-8"><a href="exercise-solutions.html#cb536-8" aria-hidden="true" tabindex="-1"></a>skeleton_totals <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb536-9"><a href="exercise-solutions.html#cb536-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(Total_gen, Total_spec) <span class="sc">~</span> Midpoint,</span>
<span id="cb536-10"><a href="exercise-solutions.html#cb536-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> skeleton,</span>
<span id="cb536-11"><a href="exercise-solutions.html#cb536-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> sum)</span>
<span id="cb536-12"><a href="exercise-solutions.html#cb536-12" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">names</span>(skeleton_totals)</span>
<span id="cb536-13"><a href="exercise-solutions.html#cb536-13" aria-hidden="true" tabindex="-1"></a>tmp[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;genera_totals&quot;</span></span>
<span id="cb536-14"><a href="exercise-solutions.html#cb536-14" aria-hidden="true" tabindex="-1"></a>tmp[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;specimen_totals&quot;</span></span>
<span id="cb536-15"><a href="exercise-solutions.html#cb536-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(skeleton_totals) <span class="ot">&lt;-</span> tmp</span>
<span id="cb536-16"><a href="exercise-solutions.html#cb536-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-17"><a href="exercise-solutions.html#cb536-17" aria-hidden="true" tabindex="-1"></a><span class="do">## combine with proportions</span></span>
<span id="cb536-18"><a href="exercise-solutions.html#cb536-18" aria-hidden="true" tabindex="-1"></a>skeleton_prop_and_totals <span class="ot">&lt;-</span> <span class="fu">merge</span>(skeleton_proportions, skeleton_totals, <span class="at">by =</span> <span class="st">&quot;Midpoint&quot;</span>)</span>
<span id="cb536-19"><a href="exercise-solutions.html#cb536-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-20"><a href="exercise-solutions.html#cb536-20" aria-hidden="true" tabindex="-1"></a><span class="do">## reshuffling is required for pivot_longer to work as expected!!!</span></span>
<span id="cb536-21"><a href="exercise-solutions.html#cb536-21" aria-hidden="true" tabindex="-1"></a>skeleton_prop_and_totals <span class="ot">&lt;-</span> skeleton_prop_and_totals[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">7</span>)]</span>
<span id="cb536-22"><a href="exercise-solutions.html#cb536-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-23"><a href="exercise-solutions.html#cb536-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-24"><a href="exercise-solutions.html#cb536-24" aria-hidden="true" tabindex="-1"></a><span class="do">## again this used to work but not anymore</span></span>
<span id="cb536-25"><a href="exercise-solutions.html#cb536-25" aria-hidden="true" tabindex="-1"></a>(skeleton_prop_totals_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb536-26"><a href="exercise-solutions.html#cb536-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> skeleton_prop_and_totals,</span>
<span id="cb536-27"><a href="exercise-solutions.html#cb536-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;_&quot;</span>),</span>
<span id="cb536-28"><a href="exercise-solutions.html#cb536-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(genera|specimen)_(proportion|totals)&quot;</span>,</span>
<span id="cb536-29"><a href="exercise-solutions.html#cb536-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#values_to = c(&quot;proportion&quot;, &quot;totals&quot;),</span></span>
<span id="cb536-30"><a href="exercise-solutions.html#cb536-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;level&quot;</span>, <span class="st">&quot;.value&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 42 x 6
##    Midpoint Epoch          Stage                       level   proportion totals
##       &lt;dbl&gt; &lt;fct&gt;          &lt;fct&gt;                       &lt;chr&gt;        &lt;dbl&gt;  &lt;int&gt;
##  1     185. Jurassic (Ear… Pliensbachian (u)           genera        44.4      9
##  2     185. Jurassic (Ear… Pliensbachian (u)           specim…       67.9     28
##  3     189. Jurassic (Ear… Sinemurian (u) - Pliensbac… genera        42.1     19
##  4     189. Jurassic (Ear… Sinemurian (u) - Pliensbac… specim…       35.3     85
##  5     191. Jurassic (Ear… Sinemurian (u) - Pliensbac… genera        77.8     30
##  6     191. Jurassic (Ear… Sinemurian (u) - Pliensbac… specim…       72.3    424
##  7     195. Jurassic (Ear… Sinemurian (l,u)            genera        33.3     21
##  8     195. Jurassic (Ear… Sinemurian (l,u)            specim…       21.4     42
##  9     200. Jurassic (Ear… Hettangian                  genera        60.7     13
## 10     200. Jurassic (Ear… Hettangian                  specim…       73.6    152
## # … with 32 more rows</code></pre>
<p>Now for the plot</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="exercise-solutions.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> skeleton_prop_totals_long, </span>
<span id="cb538-2"><a href="exercise-solutions.html#cb538-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Midpoint, <span class="at">y =</span> proportion, <span class="at">color =</span> level, <span class="at">size =</span> totals)) <span class="sc">+</span></span>
<span id="cb538-3"><a href="exercise-solutions.html#cb538-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb538-4"><a href="exercise-solutions.html#cb538-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb538-5"><a href="exercise-solutions.html#cb538-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb538-6"><a href="exercise-solutions.html#cb538-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb538-7"><a href="exercise-solutions.html#cb538-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Geological age (Myr)&quot;</span>) <span class="sc">+</span></span>
<span id="cb538-8"><a href="exercise-solutions.html#cb538-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">&quot;goldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb538-9"><a href="exercise-solutions.html#cb538-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">231</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">label =</span> <span class="st">&quot;CPE&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span id="fig:plot-reprodiction4"></span>
<img src="bookdown-demo_files/figure-html/plot-reprodiction4-1.png" alt="A reproduction" width="80%" />
<p class="caption">
Figure 10.20: A reproduction
</p>
</div>
</div>
</div>
</div>
<div id="the-tidyr-and-dplyr-packages-1" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> The <code>tidyr</code> and <code>dplyr</code> packages</h2>
<div id="global-temperature-revisited-1" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Global temperature revisited</h3>
<p><strong>A [❋❋]</strong></p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="exercise-solutions.html#cb540-1" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Source <span class="sc">==</span> <span class="st">&quot;GCAG&quot;</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;</span> <span class="dv">1970</span> <span class="sc">&amp;</span> Mean <span class="sc">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb540-2"><a href="exercise-solutions.html#cb540-2" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Source <span class="sc">==</span> <span class="st">&quot;GISTEMP&quot;</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;</span> <span class="dv">1970</span> <span class="sc">&amp;</span> Mean <span class="sc">&gt;</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><strong>B [❋❋]</strong></p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="exercise-solutions.html#cb541-1" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Source <span class="sc">==</span> <span class="st">&quot;GCAG&quot;</span> <span class="sc">&amp;</span> Year <span class="sc">&gt;</span> <span class="dv">1945</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-2"><a href="exercise-solutions.html#cb541-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Mean <span class="sc">==</span> <span class="fu">min</span>(Mean))</span>
<span id="cb541-3"><a href="exercise-solutions.html#cb541-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-4"><a href="exercise-solutions.html#cb541-4" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Source <span class="sc">==</span> <span class="st">&quot;GISTEMP&quot;</span> <span class="sc">&amp;</span> Year <span class="sc">&gt;</span> <span class="dv">1945</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-5"><a href="exercise-solutions.html#cb541-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Mean <span class="sc">==</span> <span class="fu">min</span>(Mean))</span></code></pre></div>
<p><strong>C [❋❋❋]</strong></p>
<p>This is a case for <code>filter(row_number() ...)</code> or <code>slice()</code>:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="exercise-solutions.html#cb542-1" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span> </span>
<span id="cb542-2"><a href="exercise-solutions.html#cb542-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Source) <span class="sc">%&gt;%</span> </span>
<span id="cb542-3"><a href="exercise-solutions.html#cb542-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb542-4"><a href="exercise-solutions.html#cb542-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb542-5"><a href="exercise-solutions.html#cb542-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(row_number() %in% 1:5) %&gt;% #works as well</span></span>
<span id="cb542-6"><a href="exercise-solutions.html#cb542-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code></pre></div>
<p><strong>D [❋❋❋]</strong></p>
<p>This is a case for splitting with <code>cut()</code>. Package dplyr has an equivalent named <code>ntile()</code>.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="exercise-solutions.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span>(global_temp<span class="sc">$</span>Year, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(global_temp<span class="sc">$</span>Year), <span class="fu">max</span>(global_temp<span class="sc">$</span>Year), <span class="dv">10</span>))</span>
<span id="cb543-2"><a href="exercise-solutions.html#cb543-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb543-3"><a href="exercise-solutions.html#cb543-3" aria-hidden="true" tabindex="-1"></a>global_temp <span class="sc">%&gt;%</span></span>
<span id="cb543-4"><a href="exercise-solutions.html#cb543-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">1970</span>) <span class="sc">%&gt;%</span></span>
<span id="cb543-5"><a href="exercise-solutions.html#cb543-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Decade =</span> <span class="fu">cut</span>(Year, </span>
<span id="cb543-6"><a href="exercise-solutions.html#cb543-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1970</span>, <span class="dv">2020</span>, <span class="dv">10</span>), </span>
<span id="cb543-7"><a href="exercise-solutions.html#cb543-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1970</span>, <span class="dv">2010</span>, <span class="dv">10</span>),</span>
<span id="cb543-8"><a href="exercise-solutions.html#cb543-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">right =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb543-9"><a href="exercise-solutions.html#cb543-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Decade, Source) <span class="sc">%&gt;%</span></span>
<span id="cb543-10"><a href="exercise-solutions.html#cb543-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Mean))</span></code></pre></div>
</div>
<div id="chickweight-1" class="section level3" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> ChickWeight</h3>
<ol style="list-style-type: decimal">
<li><strong>Starting weight [❋❋]</strong>.</li>
</ol>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="exercise-solutions.html#cb544-1" aria-hidden="true" tabindex="-1"></a>ChickWeight <span class="sc">%&gt;%</span> </span>
<span id="cb544-2"><a href="exercise-solutions.html#cb544-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Time <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb544-3"><a href="exercise-solutions.html#cb544-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb544-4"><a href="exercise-solutions.html#cb544-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Chick, Diet, weight) <span class="sc">%&gt;%</span></span>
<span id="cb544-5"><a href="exercise-solutions.html#cb544-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Total weight gain [❋❋❋]</strong>.</li>
</ol>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="exercise-solutions.html#cb545-1" aria-hidden="true" tabindex="-1"></a>ChickWeight <span class="sc">%&gt;%</span> </span>
<span id="cb545-2"><a href="exercise-solutions.html#cb545-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Chick) <span class="sc">%&gt;%</span></span>
<span id="cb545-3"><a href="exercise-solutions.html#cb545-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">weight_gain =</span> weight <span class="sc">-</span> <span class="fu">lag</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb545-4"><a href="exercise-solutions.html#cb545-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">timepoints =</span> <span class="fu">n</span>(), </span>
<span id="cb545-5"><a href="exercise-solutions.html#cb545-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_weight_gain =</span> <span class="fu">sum</span>(weight_gain, <span class="at">na.rm =</span> T),</span>
<span id="cb545-6"><a href="exercise-solutions.html#cb545-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">Diet =</span> <span class="fu">first</span>(Diet)) <span class="sc">%&gt;%</span></span>
<span id="cb545-7"><a href="exercise-solutions.html#cb545-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">arrange</span>(<span class="fu">desc</span>(total_weight_gain)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">4</span>)</span></code></pre></div>
<p>Note: you could also have selected the first and last measurement for each chic of course, but not simply the last timepoint since several chickens had died by then.</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Average weight gain per diet [❋❋❋❋]</strong>.</li>
</ol>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="exercise-solutions.html#cb546-1" aria-hidden="true" tabindex="-1"></a>ChickWeight <span class="sc">%&gt;%</span> </span>
<span id="cb546-2"><a href="exercise-solutions.html#cb546-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Chick) <span class="sc">%&gt;%</span></span>
<span id="cb546-3"><a href="exercise-solutions.html#cb546-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">weight_gain =</span> weight <span class="sc">-</span> <span class="fu">lag</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb546-4"><a href="exercise-solutions.html#cb546-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">timepoints =</span> <span class="fu">n</span>(), </span>
<span id="cb546-5"><a href="exercise-solutions.html#cb546-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_weight_gain =</span> <span class="fu">sum</span>(weight_gain, <span class="at">na.rm =</span> T),</span>
<span id="cb546-6"><a href="exercise-solutions.html#cb546-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">Diet =</span> <span class="fu">unique</span>(Diet)) <span class="sc">%&gt;%</span></span>
<span id="cb546-7"><a href="exercise-solutions.html#cb546-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb546-8"><a href="exercise-solutions.html#cb546-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Diet) <span class="sc">%&gt;%</span></span>
<span id="cb546-9"><a href="exercise-solutions.html#cb546-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">num_chicks =</span> <span class="fu">n</span>(),</span>
<span id="cb546-10"><a href="exercise-solutions.html#cb546-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">average_weight_gain =</span> <span class="fu">mean</span>(total_weight_gain))</span></code></pre></div>
</div>
<div id="population-numbers-1" class="section level3" number="10.3.3">
<h3><span class="header-section-number">10.3.3</span> Population numbers</h3>
<div id="load-the-data-3" class="section level4" number="10.3.3.1">
<h4><span class="header-section-number">10.3.3.1</span> Load the data <sup><font size="3em">[❋]</font></sup></h4>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="exercise-solutions.html#cb547-1" aria-hidden="true" tabindex="-1"></a>pop_data_file <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/population/EDU_DEM_05022020113225751.csv&quot;</span></span>
<span id="cb547-2"><a href="exercise-solutions.html#cb547-2" aria-hidden="true" tabindex="-1"></a>local_file <span class="ot">&lt;-</span> <span class="st">&quot;population_data.csv&quot;</span></span>
<span id="cb547-3"><a href="exercise-solutions.html#cb547-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span> <span class="fu">file.exists</span>(local_file)) {</span>
<span id="cb547-4"><a href="exercise-solutions.html#cb547-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(pop_data_file, <span class="at">destfile =</span> local_file)</span>
<span id="cb547-5"><a href="exercise-solutions.html#cb547-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="exercise-solutions.html#cb548-1" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">read.table</span>(local_file,</span>
<span id="cb548-2"><a href="exercise-solutions.html#cb548-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb548-3"><a href="exercise-solutions.html#cb548-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span></code></pre></div>
</div>
<div id="clean-up-1" class="section level4" number="10.3.3.2">
<h4><span class="header-section-number">10.3.3.2</span> Clean up <sup><font size="3em">[❋❋</font></sup></h4>
<p><strong>Which?</strong>
<code>str(population)</code> tells me that <code>Unit.Code</code>, <code>Unit</code> and <code>PowerCode</code> are factors with one level. Using <code>table(population$PowerCode.Code, useNA = "always")</code> tells me that there are only zeros there. Same for <code>Reference.Period.Code</code> and <code>Reference.Period</code>. The variables <code>Flags</code> and <code>Flag.Codes</code> refer to the same, so one of them can be removed (I choose to remove <code>Flag.Codes</code>). The same counts for <code>SEX</code>/<code>Sex</code>, <code>AGE</code>/<code>Age</code> and <code>YEAR</code>/<code>Year</code>.</p>
<p><strong>Select</strong>
This is my selection:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="exercise-solutions.html#cb549-1" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(population)[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">16</span>)]</span>
<span id="cb549-2"><a href="exercise-solutions.html#cb549-2" aria-hidden="true" tabindex="-1"></a>keep</span>
<span id="cb549-3"><a href="exercise-solutions.html#cb549-3" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(population[, keep]) <span class="co">#tibble is nicer!</span></span>
<span id="cb549-4"><a href="exercise-solutions.html#cb549-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(population)</span></code></pre></div>
</div>
<div id="create-a-wide-yearly-report-of-totals" class="section level4" number="10.3.3.3">
<h4><span class="header-section-number">10.3.3.3</span> Create a “wide” yearly report of totals <sup><font size="3em">[❋❋❋</font></sup></h4>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="exercise-solutions.html#cb550-1" aria-hidden="true" tabindex="-1"></a>pop_totals <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(population, Sex <span class="sc">==</span> <span class="st">&quot;Total&quot;</span> <span class="sc">&amp;</span> Age <span class="sc">==</span> <span class="st">&quot;Total: All age groups&quot;</span>)</span>
<span id="cb550-2"><a href="exercise-solutions.html#cb550-2" aria-hidden="true" tabindex="-1"></a><span class="do">##or, using base R</span></span>
<span id="cb550-3"><a href="exercise-solutions.html#cb550-3" aria-hidden="true" tabindex="-1"></a><span class="co">#population[population$Sex == &quot;Total&quot; &amp; population$Age == &quot;Total: All age groups&quot;, ]</span></span>
<span id="cb550-4"><a href="exercise-solutions.html#cb550-4" aria-hidden="true" tabindex="-1"></a>pop_totals_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb550-5"><a href="exercise-solutions.html#cb550-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pop_totals[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)],</span>
<span id="cb550-6"><a href="exercise-solutions.html#cb550-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Year,</span>
<span id="cb550-7"><a href="exercise-solutions.html#cb550-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Value)</span>
<span id="cb550-8"><a href="exercise-solutions.html#cb550-8" aria-hidden="true" tabindex="-1"></a>pop_totals_wide</span></code></pre></div>
</div>
<div id="create-a-wide-yearly-report-of-population-change-1" class="section level4" number="10.3.3.4">
<h4><span class="header-section-number">10.3.3.4</span> Create a “wide” yearly report of population change <sup><font size="2em">[❋❋❋❋]</font></sup></h4>
<p>You could do this on the <code>pop_totals</code> dataset using the <code>lag()</code> function, after using <code>group_by()</code>, but since we have the wide format, you could also use a simple <code>for</code> loop, iterating the columns by index and subtracting the first from the second. I will demonstrate the only the first.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="exercise-solutions.html#cb551-1" aria-hidden="true" tabindex="-1"></a>pop_totals <span class="sc">%&gt;%</span> </span>
<span id="cb551-2"><a href="exercise-solutions.html#cb551-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span></span>
<span id="cb551-3"><a href="exercise-solutions.html#cb551-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Pop_change =</span> <span class="fu">as.integer</span>(Value <span class="sc">-</span> <span class="fu">lag</span>(Value))) <span class="sc">%&gt;%</span></span>
<span id="cb551-4"><a href="exercise-solutions.html#cb551-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb551-5"><a href="exercise-solutions.html#cb551-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Value) <span class="sc">%&gt;%</span></span>
<span id="cb551-6"><a href="exercise-solutions.html#cb551-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Year,</span>
<span id="cb551-7"><a href="exercise-solutions.html#cb551-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> Pop_change) <span class="sc">%&gt;%</span></span>
<span id="cb551-8"><a href="exercise-solutions.html#cb551-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">2005</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">2010</span><span class="st">`</span>, <span class="sc">-</span>Flag.Codes) </span>
<span id="cb551-9"><a href="exercise-solutions.html#cb551-9" aria-hidden="true" tabindex="-1"></a><span class="do">## backticks in above selection are required </span></span>
<span id="cb551-10"><a href="exercise-solutions.html#cb551-10" aria-hidden="true" tabindex="-1"></a><span class="do">## because we are selecting names that are numbers!</span></span></code></pre></div>
</div>
<div id="create-a-bar-plot" class="section level4" number="10.3.3.5">
<h4><span class="header-section-number">10.3.3.5</span> Create a bar plot <sup><font size="3em">[❋❋❋</font></sup></h4>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="exercise-solutions.html#cb552-1" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> population <span class="sc">%&gt;%</span></span>
<span id="cb552-2"><a href="exercise-solutions.html#cb552-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">&quot;Women&quot;</span> <span class="sc">|</span> Sex <span class="sc">==</span> <span class="st">&quot;Men&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb552-3"><a href="exercise-solutions.html#cb552-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(COUNTRY <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BEL&quot;</span>, <span class="st">&quot;CHE&quot;</span>, <span class="st">&quot;DNK&quot;</span>, <span class="st">&quot;FRA&quot;</span>, <span class="st">&quot;IRL&quot;</span>, <span class="st">&quot;DEU&quot;</span>, <span class="st">&quot;LUX&quot;</span>, <span class="st">&quot;NLD&quot;</span>, <span class="st">&quot;GBR&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb552-4"><a href="exercise-solutions.html#cb552-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>()</span>
<span id="cb552-5"><a href="exercise-solutions.html#cb552-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-6"><a href="exercise-solutions.html#cb552-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sel, <span class="at">mapping =</span> <span class="fu">aes</span>(Year)) <span class="sc">+</span></span>
<span id="cb552-7"><a href="exercise-solutions.html#cb552-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">weight =</span> Value, <span class="at">fill =</span> Sex))  <span class="sc">+</span> </span>
<span id="cb552-8"><a href="exercise-solutions.html#cb552-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(. <span class="sc">~</span> COUNTRY)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pop-barplot"></span>
<img src="bookdown-demo_files/figure-html/pop-barplot-1.png" alt="Barplot of population numbers in some European countries" width="80%" />
<p class="caption">
Figure 10.21: Barplot of population numbers in some European countries
</p>
</div>
</div>
<div id="highest-growth-rate-1" class="section level4" number="10.3.3.6">
<h4><span class="header-section-number">10.3.3.6</span> Highest growth rate <sup><font size="2em">[❋❋❋❋]</font></sup></h4>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="exercise-solutions.html#cb553-1" aria-hidden="true" tabindex="-1"></a>population <span class="sc">%&gt;%</span></span>
<span id="cb553-2"><a href="exercise-solutions.html#cb553-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">&quot;Total&quot;</span> <span class="sc">&amp;</span> Age <span class="sc">==</span> <span class="st">&quot;Total: All age groups&quot;</span> <span class="sc">&amp;</span> (Year <span class="sc">==</span> <span class="dv">2005</span> <span class="sc">|</span> Year <span class="sc">==</span> <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb553-3"><a href="exercise-solutions.html#cb553-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span></span>
<span id="cb553-4"><a href="exercise-solutions.html#cb553-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Change =</span> Value <span class="sc">-</span> <span class="fu">lag</span>(Value), </span>
<span id="cb553-5"><a href="exercise-solutions.html#cb553-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">Previous =</span> <span class="fu">lag</span>(Value)) <span class="sc">%&gt;%</span></span>
<span id="cb553-6"><a href="exercise-solutions.html#cb553-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">GrowthRate =</span> Change <span class="sc">/</span> Previous <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb553-7"><a href="exercise-solutions.html#cb553-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb553-8"><a href="exercise-solutions.html#cb553-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(COUNTRY, Country, GrowthRate ) <span class="sc">%&gt;%</span></span>
<span id="cb553-9"><a href="exercise-solutions.html#cb553-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(GrowthRate)) <span class="sc">%&gt;%</span></span>
<span id="cb553-10"><a href="exercise-solutions.html#cb553-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="rubella-and-measles-1" class="section level3" number="10.3.4">
<h3><span class="header-section-number">10.3.4</span> Rubella and Measles</h3>
<p>No solutions (yet) for this exercise.</p>
</div>
</div>
<div id="the-lubridate-package-1" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> The <code>lubridate</code> package</h2>
<div id="female-births-1" class="section level3" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Female births</h3>
<div id="load-the-data-4" class="section level4" number="10.4.1.1">
<h4><span class="header-section-number">10.4.1.1</span> Load the data <sup><font size="2em">[❋❋]</font></sup></h4>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="exercise-solutions.html#cb554-1" aria-hidden="true" tabindex="-1"></a>remote_file <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/female_births/daily-total-female-births.csv&quot;</span></span>
<span id="cb554-2"><a href="exercise-solutions.html#cb554-2" aria-hidden="true" tabindex="-1"></a>local_file <span class="ot">&lt;-</span> <span class="st">&quot;../female_births.csv&quot;</span></span>
<span id="cb554-3"><a href="exercise-solutions.html#cb554-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-4"><a href="exercise-solutions.html#cb554-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span> <span class="fu">file.exists</span>(local_file)) {</span>
<span id="cb554-5"><a href="exercise-solutions.html#cb554-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(remote_file, <span class="at">destfile =</span> local_file)</span>
<span id="cb554-6"><a href="exercise-solutions.html#cb554-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb554-7"><a href="exercise-solutions.html#cb554-7" aria-hidden="true" tabindex="-1"></a>female_births <span class="ot">&lt;-</span> <span class="fu">read.table</span>(local_file,</span>
<span id="cb554-8"><a href="exercise-solutions.html#cb554-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb554-9"><a href="exercise-solutions.html#cb554-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb554-10"><a href="exercise-solutions.html#cb554-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb554-11"><a href="exercise-solutions.html#cb554-11" aria-hidden="true" tabindex="-1"></a>female_births <span class="ot">&lt;-</span> female_births <span class="sc">%&gt;%</span> </span>
<span id="cb554-12"><a href="exercise-solutions.html#cb554-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as_date</span>(female_births<span class="sc">$</span>Date))</span>
<span id="cb554-13"><a href="exercise-solutions.html#cb554-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-14"><a href="exercise-solutions.html#cb554-14" aria-hidden="true" tabindex="-1"></a>(female_births <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(female_births))</span></code></pre></div>
<p>Note that in this case <code>as_tibble(female_births)</code> with the original dataframe would have converted the Date column to date objects as well.</p>
</div>
<div id="check-for-missing-rows-1" class="section level4" number="10.4.1.2">
<h4><span class="header-section-number">10.4.1.2</span> Check for missing rows <sup><font size="2em">[❋❋❋]</font></sup></h4>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="exercise-solutions.html#cb555-1" aria-hidden="true" tabindex="-1"></a>female_births <span class="sc">%&gt;%</span></span>
<span id="cb555-2"><a href="exercise-solutions.html#cb555-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lagged =</span> <span class="fu">lag</span>(Date),</span>
<span id="cb555-3"><a href="exercise-solutions.html#cb555-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">diff =</span> <span class="fu">as.integer</span>(Date <span class="sc">-</span> lagged)) <span class="sc">%&gt;%</span></span>
<span id="cb555-4"><a href="exercise-solutions.html#cb555-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(diff) <span class="sc">|</span> diff <span class="sc">!=</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="report-birth-numbers-1" class="section level4" number="10.4.1.3">
<h4><span class="header-section-number">10.4.1.3</span> Report birth numbers <sup><font size="2em">[❋❋❋]</font></sup></h4>
<p>Report the number of births per month (Jan - Dec) and per weekday (Mon - Sun), as barplots.
Is there a month or day that seems to be anomalous, or do you see seasonal trends? Try a statistical test!</p>
<p>First create the required columns:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="exercise-solutions.html#cb556-1" aria-hidden="true" tabindex="-1"></a>female_births <span class="ot">&lt;-</span> female_births <span class="sc">%&gt;%</span></span>
<span id="cb556-2"><a href="exercise-solutions.html#cb556-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Day =</span> <span class="fu">wday</span>(Date, <span class="at">label =</span> T),</span>
<span id="cb556-3"><a href="exercise-solutions.html#cb556-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">Month =</span> <span class="fu">month</span>(Date, <span class="at">label =</span> T))</span></code></pre></div>
<p>Report monthly counts, as barplot.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="exercise-solutions.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggplot2)</span></span>
<span id="cb557-2"><a href="exercise-solutions.html#cb557-2" aria-hidden="true" tabindex="-1"></a>female_births <span class="sc">%&gt;%</span></span>
<span id="cb557-3"><a href="exercise-solutions.html#cb557-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">weight =</span> Births)) <span class="sc">+</span></span>
<span id="cb557-4"><a href="exercise-solutions.html#cb557-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb557-5"><a href="exercise-solutions.html#cb557-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:births-month-barplot"></span>
<img src="bookdown-demo_files/figure-html/births-month-barplot-1.png" alt="Monthly birth counts" width="70%" />
<p class="caption">
Figure 10.22: Monthly birth counts
</p>
</div>
<p>The days</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="exercise-solutions.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb558-2"><a href="exercise-solutions.html#cb558-2" aria-hidden="true" tabindex="-1"></a>female_births <span class="sc">%&gt;%</span></span>
<span id="cb558-3"><a href="exercise-solutions.html#cb558-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Day, <span class="at">weight =</span> Births)) <span class="sc">+</span></span>
<span id="cb558-4"><a href="exercise-solutions.html#cb558-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb558-5"><a href="exercise-solutions.html#cb558-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:births-month-barplot2"></span>
<img src="bookdown-demo_files/figure-html/births-month-barplot2-1.png" alt="Daily birth counts" width="70%" />
<p class="caption">
Figure 10.23: Daily birth counts
</p>
</div>
</div>
</div>
<div id="diabetes-1" class="section level3" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Diabetes</h3>
<p>The <code>datasets</code> repo of this course contains a folder named <code>UCI_diabetes_dataset</code>. The complete dataset contains various types of information for 70 diabetes patients. Study the Readme file of this dataset before proceeding.</p>
<div id="create-a-codebook-1" class="section level4" number="10.4.2.1">
<h4><span class="header-section-number">10.4.2.1</span> Create a codebook <sup><font size="2em">[❋❋]</font></sup></h4>
<p>Copy-and-paste the Code Fields into a file named <code>codebook.txt</code> and load it as a dataframe with name <code>codebook_diab</code>.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="exercise-solutions.html#cb559-1" aria-hidden="true" tabindex="-1"></a>codebook_diab <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/diabetes_codebook.txt&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb559-2"><a href="exercise-solutions.html#cb559-2" aria-hidden="true" tabindex="-1"></a>codebook_diab <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(codebook_diab)</span>
<span id="cb559-3"><a href="exercise-solutions.html#cb559-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(codebook_diab)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##    Code Description                            
##   &lt;int&gt; &lt;chr&gt;                                  
## 1    33 Regular insulin dose                   
## 2    34 NPH insulin dose                       
## 3    35 UltraLente insulin dose                
## 4    48 Unspecified blood glucose measurement  
## 5    57 Unspecified blood glucose measurement  
## 6    58 Pre-breakfast blood glucose measurement</code></pre>
</div>
<div id="create-a-function-to-load-patient-data" class="section level4" number="10.4.2.2">
<h4><span class="header-section-number">10.4.2.2</span> Create a function to load patient data <sup><font size="2em">[❋❋❋]</font></sup></h4>
<p>Create a function -<code>load_patient_data(&lt;patient-number&gt;)</code>- that can be used to load data for specific patients from file and return this as a dataframe. If you access the remote copies of the files you should cache the data locally so a second requests for the same data will return a local copy of the file. The function should give a friendly error message when there is no data for the specific patient (e.g. patient 99 is not present in the dataset).</p>
<p>As extra challenge, you could read the documentation on the <code>tryCatch()</code> function and try to use this for your remote file access.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="exercise-solutions.html#cb561-1" aria-hidden="true" tabindex="-1"></a>load_patient_data <span class="ot">&lt;-</span> <span class="cf">function</span>(patient_number) {</span>
<span id="cb561-2"><a href="exercise-solutions.html#cb561-2" aria-hidden="true" tabindex="-1"></a>    base_url <span class="ot">&lt;-</span><span class="st">&quot;https://raw.githubusercontent.com/MichielNoback/datasets/master/UCI_diabetes_dataset/data-&quot;</span></span>
<span id="cb561-3"><a href="exercise-solutions.html#cb561-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (patient_number <span class="sc">&lt;=</span> <span class="dv">9</span>) patient_number <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, patient_number)</span>
<span id="cb561-4"><a href="exercise-solutions.html#cb561-4" aria-hidden="true" tabindex="-1"></a>    remote_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, patient_number)</span>
<span id="cb561-5"><a href="exercise-solutions.html#cb561-5" aria-hidden="true" tabindex="-1"></a>    local_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../diab-patient-&quot;</span>, patient_number)</span>
<span id="cb561-6"><a href="exercise-solutions.html#cb561-6" aria-hidden="true" tabindex="-1"></a>    column_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Code&quot;</span>, <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb561-7"><a href="exercise-solutions.html#cb561-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#format:</span></span>
<span id="cb561-8"><a href="exercise-solutions.html#cb561-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#04-21-1991 9:09    58  100</span></span>
<span id="cb561-9"><a href="exercise-solutions.html#cb561-9" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb561-10"><a href="exercise-solutions.html#cb561-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> <span class="fu">file.exists</span>(local_file)) {</span>
<span id="cb561-11"><a href="exercise-solutions.html#cb561-11" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>( {<span class="co">#success</span></span>
<span id="cb561-12"><a href="exercise-solutions.html#cb561-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;downloading &quot;</span>, remote_file))</span>
<span id="cb561-13"><a href="exercise-solutions.html#cb561-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">download.file</span>(remote_file, <span class="at">destfile =</span> local_file)</span>
<span id="cb561-14"><a href="exercise-solutions.html#cb561-14" aria-hidden="true" tabindex="-1"></a>                patient_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(local_file, </span>
<span id="cb561-15"><a href="exercise-solutions.html#cb561-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, </span>
<span id="cb561-16"><a href="exercise-solutions.html#cb561-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb561-17"><a href="exercise-solutions.html#cb561-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">names</span>(patient_data) <span class="ot">&lt;-</span> column_names</span>
<span id="cb561-18"><a href="exercise-solutions.html#cb561-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(patient_data)</span>
<span id="cb561-19"><a href="exercise-solutions.html#cb561-19" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb561-20"><a href="exercise-solutions.html#cb561-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">error =</span> <span class="cf">function</span>(cond) {</span>
<span id="cb561-21"><a href="exercise-solutions.html#cb561-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;Remote file does not seem to exist:&quot;</span>, remote_file))</span>
<span id="cb561-22"><a href="exercise-solutions.html#cb561-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="st">&quot;Here&#39;s the original error message:&quot;</span>)</span>
<span id="cb561-23"><a href="exercise-solutions.html#cb561-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(cond)</span>
<span id="cb561-24"><a href="exercise-solutions.html#cb561-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb561-25"><a href="exercise-solutions.html#cb561-25" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb561-26"><a href="exercise-solutions.html#cb561-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">warning =</span> <span class="cf">function</span>(cond) {</span>
<span id="cb561-27"><a href="exercise-solutions.html#cb561-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;URL caused a warning:&quot;</span>, remote_file))</span>
<span id="cb561-28"><a href="exercise-solutions.html#cb561-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="st">&quot;Here&#39;s the original warning message:&quot;</span>)</span>
<span id="cb561-29"><a href="exercise-solutions.html#cb561-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(cond)</span>
<span id="cb561-30"><a href="exercise-solutions.html#cb561-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb561-31"><a href="exercise-solutions.html#cb561-31" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb561-32"><a href="exercise-solutions.html#cb561-32" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb561-33"><a href="exercise-solutions.html#cb561-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;reading local cache of&quot;</span>, local_file))</span>
<span id="cb561-34"><a href="exercise-solutions.html#cb561-34" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">read.table</span>(local_file, </span>
<span id="cb561-35"><a href="exercise-solutions.html#cb561-35" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb561-36"><a href="exercise-solutions.html#cb561-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb561-37"><a href="exercise-solutions.html#cb561-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(result) <span class="ot">&lt;-</span> column_names</span>
<span id="cb561-38"><a href="exercise-solutions.html#cb561-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb561-39"><a href="exercise-solutions.html#cb561-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result)</span>
<span id="cb561-40"><a href="exercise-solutions.html#cb561-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb561-41"><a href="exercise-solutions.html#cb561-41" aria-hidden="true" tabindex="-1"></a>patient8 <span class="ot">&lt;-</span> <span class="fu">load_patient_data</span>(<span class="dv">8</span>)</span></code></pre></div>
<pre><code>## reading local cache of../diab-patient-08</code></pre>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="exercise-solutions.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(patient8)</span></code></pre></div>
<pre><code>##         Date  Time Code Value
## 1 07-31-1990 12:09   60   100
## 2 07-31-1990 17:28   62   190
## 3 07-31-1990 18:41   62   124
## 4 08-01-1990 05:58   58   222
## 5 08-01-1990 12:57   60   339
## 6 08-01-1990 13:00   68     0</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="exercise-solutions.html#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(patient8)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    177 obs. of  4 variables:
##  $ Date : chr  &quot;07-31-1990&quot; &quot;07-31-1990&quot; &quot;07-31-1990&quot; &quot;08-01-1990&quot; ...
##  $ Time : chr  &quot;12:09&quot; &quot;17:28&quot; &quot;18:41&quot; &quot;05:58&quot; ...
##  $ Code : int  60 62 62 58 60 68 60 61 62 65 ...
##  $ Value: int  100 190 124 222 339 0 71 72 193 0 ...</code></pre>
<p>B$</p>
</div>
</div>
</div>
<div id="the-stringr-package-1" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> The <code>stringr</code> package</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercises.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parsing-complex-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/10-exercise_solutions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
