<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Working with date-time data: lubridate | Data Analysis and Visualization using R (2)</title>
  <meta name="description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Working with date-time data: lubridate | Data Analysis and Visualization using R (2)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Working with date-time data: lubridate | Data Analysis and Visualization using R (2)" />
  
  <meta name="twitter:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  

<meta name="author" content="Michiel Noback" />


<meta name="date" content="2020-01-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html">
<link rel="next" href="stringr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DAVuR2 gitbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>1</b> The <code>ggplot2</code> package</a><ul>
<li class="chapter" data-level="1.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#keep-the-goal-in-mind"><i class="fa fa-check"></i>Keep the goal in mind</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ggplot2.html"><a href="ggplot2.html#getting-started"><i class="fa fa-check"></i><b>1.2</b> Getting started</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#a-first-plot"><i class="fa fa-check"></i>A first plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#adding-a-dimension-using-color"><i class="fa fa-check"></i>Adding a dimension using color</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#inspecting-and-tuning-the-figure"><i class="fa fa-check"></i>Inspecting and tuning the figure</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-and-the-theory-of-graphics"><i class="fa fa-check"></i><b>1.3</b> ggplot2 and the theory of graphics</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#phylosophy-of-ggplot2"><i class="fa fa-check"></i>Phylosophy of ggplot2</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-grammar-of-graphics"><i class="fa fa-check"></i>The grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ggplot2.html"><a href="ggplot2.html#building-plots-with-ggplot2"><i class="fa fa-check"></i><b>1.4</b> Building plots with ggplot2</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-layered-plot-architecture"><i class="fa fa-check"></i>The layered plot architecture</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#tidy-the-data"><i class="fa fa-check"></i>“Tidy” the data</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="ggplot2.html"><a href="ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>1.5</b> Aesthetics</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#colors"><i class="fa fa-check"></i>Colors</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#shapes"><i class="fa fa-check"></i>Shapes</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#lines"><i class="fa fa-check"></i>Lines</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#size"><i class="fa fa-check"></i>Size</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="ggplot2.html"><a href="ggplot2.html#geometries"><i class="fa fa-check"></i><b>1.6</b> Geometries</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#what-are-geometries"><i class="fa fa-check"></i>What are geometries</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#jitter"><i class="fa fa-check"></i>Jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#plot-overlays-boxplot-jitter"><i class="fa fa-check"></i>Plot overlays: boxplot + jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scatterplot-points"><i class="fa fa-check"></i>Scatterplot: Points</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#line-plots"><i class="fa fa-check"></i>Line plots</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#histograms"><i class="fa fa-check"></i>Histograms</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#violin-plot"><i class="fa fa-check"></i>Violin plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#overview-of-the-main-geoms"><i class="fa fa-check"></i>Overview of the main geoms</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="ggplot2.html"><a href="ggplot2.html#inheritance-of-aesthetics"><i class="fa fa-check"></i><b>1.7</b> Inheritance of aesthetics</a></li>
<li class="chapter" data-level="1.8" data-path="ggplot2.html"><a href="ggplot2.html#facetting"><i class="fa fa-check"></i><b>1.8</b> Facetting</a></li>
<li class="chapter" data-level="1.9" data-path="ggplot2.html"><a href="ggplot2.html#experimenting-with-geoms-and-aesthetics"><i class="fa fa-check"></i><b>1.9</b> Experimenting with geoms and aesthetics</a></li>
<li class="chapter" data-level="1.10" data-path="ggplot2.html"><a href="ggplot2.html#final-tweeks"><i class="fa fa-check"></i><b>1.10</b> Final tweeks</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scales-and-coordinates"><i class="fa fa-check"></i>Scales and Coordinates</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#themes"><i class="fa fa-check"></i>Themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html"><i class="fa fa-check"></i><b>2</b> Developing a custom visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#an-experimental-ptsd-treatment"><i class="fa fa-check"></i><b>2.1</b> An experimental PTSD treatment</a><ul>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-data"><i class="fa fa-check"></i>The data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#choose-a-visualization"><i class="fa fa-check"></i>Choose a visualization</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#tidy-the-data-1"><i class="fa fa-check"></i>Tidy the data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#a-first-version"><i class="fa fa-check"></i>A first version</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#add-mean-and-sd"><i class="fa fa-check"></i>Add mean and SD</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#emphasise-worst-cases"><i class="fa fa-check"></i>Emphasise worst cases</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#last-tweaks-fonts-and-legend"><i class="fa fa-check"></i><b>2.2</b> Last tweaks: fonts and legend</a></li>
<li class="chapter" data-level="2.3" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-code"><i class="fa fa-check"></i><b>2.3</b> The code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>3</b> Package tidyr</a><ul>
<li class="chapter" data-level="3.1" data-path="tidyr.html"><a href="tidyr.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="tidyr.html"><a href="tidyr.html#the-gather-function"><i class="fa fa-check"></i><b>3.2</b> The <code>gather()</code> function</a></li>
<li class="chapter" data-level="3.3" data-path="tidyr.html"><a href="tidyr.html#a-more-complex-problem-two-sets-of-columns"><i class="fa fa-check"></i><b>3.3</b> A more complex problem: two sets of columns</a></li>
<li class="chapter" data-level="3.4" data-path="tidyr.html"><a href="tidyr.html#widening-with-spread-and-pivot_wider"><i class="fa fa-check"></i><b>3.4</b> Widening with <code>spread()</code> and <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="3.5" data-path="tidyr.html"><a href="tidyr.html#separate-columns"><i class="fa fa-check"></i><b>3.5</b> <code>separate()</code> columns</a></li>
<li class="chapter" data-level="3.6" data-path="tidyr.html"><a href="tidyr.html#combine-columns"><i class="fa fa-check"></i><b>3.6</b> combine columns</a></li>
<li class="chapter" data-level="3.7" data-path="tidyr.html"><a href="tidyr.html#drop-rows-with-missing-values-drop_na"><i class="fa fa-check"></i><b>3.7</b> Drop rows with missing values: <code>drop_na()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Data mangling with package <code>dplyr</code></a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>4.1</b> Tibbles</a><ul>
<li class="chapter" data-level="4.1.1" data-path="dplyr.html"><a href="dplyr.html#by-row-constructor"><i class="fa fa-check"></i><b>4.1.1</b> By-row constructor</a></li>
<li class="chapter" data-level="4.1.2" data-path="dplyr.html"><a href="dplyr.html#tibbles-vs-data-frames"><i class="fa fa-check"></i><b>4.1.2</b> Tibbles vs data frames</a></li>
<li class="chapter" data-level="4.1.3" data-path="dplyr.html"><a href="dplyr.html#the-str-equivalent-glimpse"><i class="fa fa-check"></i><b>4.1.3</b> The <code>str()</code> equivalent: <code>glimpse()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#the-chaining-operator"><i class="fa fa-check"></i><b>4.2</b> The chaining operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#selecting"><i class="fa fa-check"></i><b>4.3</b> Selecting</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#selecting-rows-by-index-slice"><i class="fa fa-check"></i><b>4.3.1</b> Selecting rows by index: <code>slice()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#get-unique-cases-with-distinct"><i class="fa fa-check"></i><b>4.3.2</b> Get unique cases with <code>distinct()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="dplyr.html"><a href="dplyr.html#filter-cases"><i class="fa fa-check"></i><b>4.3.3</b> <code>filter()</code> cases</a></li>
<li class="chapter" data-level="4.3.4" data-path="dplyr.html"><a href="dplyr.html#selecting-variables-select"><i class="fa fa-check"></i><b>4.3.4</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="dplyr.html"><a href="dplyr.html#renaming-variables-rename"><i class="fa fa-check"></i><b>4.3.5</b> Renaming variables: <code>rename()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="dplyr.html"><a href="dplyr.html#selecting-from-ranked-data"><i class="fa fa-check"></i><b>4.3.6</b> Selecting from ranked data</a></li>
<li class="chapter" data-level="4.3.7" data-path="dplyr.html"><a href="dplyr.html#extract-a-colum-as-vector"><i class="fa fa-check"></i><b>4.3.7</b> Extract a colum as vector</a></li>
<li class="chapter" data-level="4.3.8" data-path="dplyr.html"><a href="dplyr.html#sorting-with-arrange"><i class="fa fa-check"></i><b>4.3.8</b> Sorting with <code>arrange()</code></a></li>
<li class="chapter" data-level="4.3.9" data-path="dplyr.html"><a href="dplyr.html#random-sampling"><i class="fa fa-check"></i><b>4.3.9</b> Random sampling</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#adding-and-changing-variables"><i class="fa fa-check"></i><b>4.4</b> Adding and changing variables</a><ul>
<li class="chapter" data-level="4.4.1" data-path="dplyr.html"><a href="dplyr.html#window-functions"><i class="fa fa-check"></i><b>4.4.1</b> Window functions</a></li>
<li class="chapter" data-level="4.4.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>4.4.2</b> Add one or more variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="dplyr.html"><a href="dplyr.html#create-new-variables-based-on-more-columns"><i class="fa fa-check"></i><b>4.4.3</b> Create new variables based on more columns</a></li>
<li class="chapter" data-level="4.4.4" data-path="dplyr.html"><a href="dplyr.html#change-a-variable-recode-and-recode_factor"><i class="fa fa-check"></i><b>4.4.4</b> Change a variable: <code>recode()</code> and <code>recode_factor()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#operations-on-groups"><i class="fa fa-check"></i><b>4.5</b> Operations on groups</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#group_by-and-ungroup"><i class="fa fa-check"></i><b>4.5.1</b> <code>group_by()</code> and <code>ungroup()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#group_split-and-group_keys"><i class="fa fa-check"></i><b>4.5.2</b> <code>group_split()</code> and <code>group_keys()</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#apply-a-function-to-each-group"><i class="fa fa-check"></i><b>4.5.3</b> Apply a function to each group</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#summarizing-and-counting"><i class="fa fa-check"></i><b>4.6</b> Summarizing and counting</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#combining-data"><i class="fa fa-check"></i><b>4.7</b> Combining data</a><ul>
<li class="chapter" data-level="4.7.1" data-path="dplyr.html"><a href="dplyr.html#merging"><i class="fa fa-check"></i><b>4.7.1</b> Merging</a></li>
<li class="chapter" data-level="4.7.2" data-path="dplyr.html"><a href="dplyr.html#adding-rows-and-columns"><i class="fa fa-check"></i><b>4.7.2</b> Adding rows and columns</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="date-time.html"><a href="date-time.html"><i class="fa fa-check"></i><b>5</b> Working with date-time data: <code>lubridate</code></a><ul>
<li class="chapter" data-level="5.1" data-path="date-time.html"><a href="date-time.html#current-time"><i class="fa fa-check"></i><b>5.1</b> Current time</a></li>
<li class="chapter" data-level="5.2" data-path="date-time.html"><a href="date-time.html#getting-elements-from-date-time-objects"><i class="fa fa-check"></i><b>5.2</b> Getting elements from date-time objects</a></li>
<li class="chapter" data-level="5.3" data-path="date-time.html"><a href="date-time.html#calculations-with-date-time"><i class="fa fa-check"></i><b>5.3</b> Calculations with date-time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stringr.html"><a href="stringr.html"><i class="fa fa-check"></i><b>6</b> Processing text with: <code>stringr</code> and regex</a><ul>
<li class="chapter" data-level="6.1" data-path="stringr.html"><a href="stringr.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="6.1.1" data-path="stringr.html"><a href="stringr.html#a-few-remarks-on-locale"><i class="fa fa-check"></i><b>6.1.1</b> A few remarks on “locale”</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stringr.html"><a href="stringr.html#review-of-regular-expressions"><i class="fa fa-check"></i><b>6.2</b> Review of regular expressions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="stringr.html"><a href="stringr.html#regex-syntax-elements"><i class="fa fa-check"></i><b>6.2.1</b> Regex syntax elements</a></li>
<li class="chapter" data-level="6.2.2" data-path="stringr.html"><a href="stringr.html#character-classes-and-negation"><i class="fa fa-check"></i><b>6.2.2</b> Character classes and negation</a></li>
<li class="chapter" data-level="6.2.3" data-path="stringr.html"><a href="stringr.html#quantifiers"><i class="fa fa-check"></i><b>6.2.3</b> Quantifiers</a></li>
<li class="chapter" data-level="6.2.4" data-path="stringr.html"><a href="stringr.html#anchoring"><i class="fa fa-check"></i><b>6.2.4</b> Anchoring</a></li>
<li class="chapter" data-level="6.2.5" data-path="stringr.html"><a href="stringr.html#alternatives"><i class="fa fa-check"></i><b>6.2.5</b> Alternatives</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stringr.html"><a href="stringr.html#the-stringr-essentials"><i class="fa fa-check"></i><b>6.3</b> The <code>stringr</code> essentials</a><ul>
<li class="chapter" data-level="6.3.1" data-path="stringr.html"><a href="stringr.html#case-conversion"><i class="fa fa-check"></i><b>6.3.1</b> Case conversion</a></li>
<li class="chapter" data-level="6.3.2" data-path="stringr.html"><a href="stringr.html#split-join-and-substring"><i class="fa fa-check"></i><b>6.3.2</b> Split, join and substring</a></li>
<li class="chapter" data-level="6.3.3" data-path="stringr.html"><a href="stringr.html#matching"><i class="fa fa-check"></i><b>6.3.3</b> Matching</a></li>
<li class="chapter" data-level="6.3.4" data-path="stringr.html"><a href="stringr.html#extracting-and-replacing"><i class="fa fa-check"></i><b>6.3.4</b> Extracting and replacing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="eda.html"><a href="eda.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="eda.html"><a href="eda.html#getting-to-know-the-dataset"><i class="fa fa-check"></i><b>7.2</b> Getting to know the dataset</a><ul>
<li class="chapter" data-level="7.2.1" data-path="eda.html"><a href="eda.html#the-codebook"><i class="fa fa-check"></i><b>7.2.1</b> The codebook</a></li>
<li class="chapter" data-level="7.2.2" data-path="eda.html"><a href="eda.html#load-and-inspect-the-data"><i class="fa fa-check"></i><b>7.2.2</b> Load and inspect the data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="eda.html"><a href="eda.html#exploring-variables"><i class="fa fa-check"></i><b>7.3</b> Exploring variables</a><ul>
<li class="chapter" data-level="7.3.1" data-path="eda.html"><a href="eda.html#first-steps"><i class="fa fa-check"></i><b>7.3.1</b> First steps</a></li>
<li class="chapter" data-level="7.3.2" data-path="eda.html"><a href="eda.html#smoking-data-corrupted"><i class="fa fa-check"></i><b>7.3.2</b> Smoking data corrupted?</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="eda.html"><a href="eda.html#variable-engineering"><i class="fa fa-check"></i><b>7.4</b> Variable engineering</a><ul>
<li class="chapter" data-level="7.4.1" data-path="eda.html"><a href="eda.html#recoding-strategies"><i class="fa fa-check"></i><b>7.4.1</b> Recoding strategies</a></li>
<li class="chapter" data-level="7.4.2" data-path="eda.html"><a href="eda.html#factorization"><i class="fa fa-check"></i><b>7.4.2</b> “factorization”</a></li>
<li class="chapter" data-level="7.4.3" data-path="eda.html"><a href="eda.html#data-redundancy-in-std-variables"><i class="fa fa-check"></i><b>7.4.3</b> Data redundancy in STD variables</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="eda.html"><a href="eda.html#the-dependent-variable"><i class="fa fa-check"></i><b>7.5</b> The dependent variable</a></li>
<li class="chapter" data-level="7.6" data-path="eda.html"><a href="eda.html#exploring-relationships-between-variables"><i class="fa fa-check"></i><b>7.6</b> Exploring relationships between variables</a><ul>
<li class="chapter" data-level="7.6.1" data-path="eda.html"><a href="eda.html#the-scatterplot"><i class="fa fa-check"></i><b>7.6.1</b> The scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="eda.html"><a href="eda.html#look-for-patterns-with-the-dependent-variable"><i class="fa fa-check"></i><b>7.7</b> Look for patterns with the dependent variable</a></li>
<li class="chapter" data-level="7.8" data-path="eda.html"><a href="eda.html#density-plots-show-class-distinction"><i class="fa fa-check"></i><b>7.8</b> Density plots show class distinction</a><ul>
<li class="chapter" data-level="7.8.1" data-path="eda.html"><a href="eda.html#the-xor-problem"><i class="fa fa-check"></i><b>7.8.1</b> The ‘xor’ problem</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="eda.html"><a href="eda.html#advanced-explorations"><i class="fa fa-check"></i><b>7.9</b> Advanced Explorations</a><ul>
<li class="chapter" data-level="7.9.1" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>7.9.1</b> PCA</a></li>
<li class="chapter" data-level="7.9.2" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>7.9.2</b> Clustering</a></li>
<li class="chapter" data-level="7.9.3" data-path="eda.html"><a href="eda.html#k-means-clustering"><i class="fa fa-check"></i><b>7.9.3</b> k-Means clustering</a></li>
<li class="chapter" data-level="7.9.4" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>7.9.4</b> hierarchical clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>8</b> Exercises</a><ul>
<li class="chapter" data-level="8.1" data-path="exercises.html"><a href="exercises.html#introduction-4"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis and Visualization using R (2)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="date-time" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Working with date-time data: <code>lubridate</code></h1>
<p>When working in a lab you will often encounter time-measured data. For instance, growth curves, animal behavior observations etc.</p>
<p>The tidyverse package <code>lubridate</code> can help you with that. It is quite an expensive package; only the bare essentials will be dealt with here. For a bit more complete overview have a look at the <a href="graphics/lubridate.pdf">cheat sheet</a>.</p>
<p>A small fictitious dataset will be used here to explore some of the concepts. It can be found in file <code>data/time_series_drug_test.txt</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/time_series_drug_test.txt&quot;</span>, 
                 <span class="dt">header =</span> T,
                 <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>,
                 <span class="dt">as.is =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)
ts &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(ts)
ts</code></pre>
<pre><code>## # A tibble: 48 x 5
##    subject date       time  control response
##    &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt;      &lt;int&gt;
##  1 S001    29/12/2019 07:44 n              2
##  2 S001    29/12/2019 12:06 n             68
##  3 S001    29/12/2019 17:28 n            112
##  4 S001    29/12/2019 22:01 n             82
##  5 S001    30/12/2019 07:22 n             63
##  6 S001    30/12/2019 12:05 n             57
##  7 S001    30/12/2019 17:55 n             91
##  8 S001    30/12/2019 22:55 n             48
##  9 S002    29/12/2019 07:46 n              5
## 10 S002    29/12/2019 12:09 n             73
## # … with 38 more rows</code></pre>
<p>If you simply want to show the timeseries as a plot, the date and time columns need to be combined first. The tidyr package has <code>unite()</code>, or do it with <code>mutate()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unite</span>(<span class="st">&quot;date_time&quot;</span>, date, time, <span class="dt">sep =</span> <span class="st">&quot;T&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   subject date_time        control response
##   &lt;fct&gt;   &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    29/12/2019T07:44 n              2
## 2 S001    29/12/2019T12:06 n             68
## 3 S001    29/12/2019T17:28 n            112</code></pre>
<p>As you can see, the original data columns are lost in this operation. Using <code>mutate()</code> and <code>paste()</code> does keep them intact however. I will take this approach because I want the old columns for demonstration purposes.</p>
<pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span>ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_time =</span> <span class="kw">paste</span>(date, time, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>))
<span class="kw">head</span>(ts, <span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 6
##   subject date       time  control response date_time       
##   &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt;      &lt;int&gt; &lt;chr&gt;           
## 1 S001    29/12/2019 07:44 n              2 29/12/2019 07:44
## 2 S001    29/12/2019 12:06 n             68 29/12/2019 12:06
## 3 S001    29/12/2019 17:28 n            112 29/12/2019 17:28</code></pre>
<p>Let’s reshuffle. I like it when my dependent variable comes last.</p>
<pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span>ts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(subject, date, time, date_time, control, response)
<span class="kw">head</span>(ts, <span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 6
##   subject date       time  date_time        control response
##   &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    29/12/2019 07:44 29/12/2019 07:44 n              2
## 2 S001    29/12/2019 12:06 29/12/2019 12:06 n             68
## 3 S001    29/12/2019 17:28 29/12/2019 17:28 n            112</code></pre>
<p>If I attempt to plot the response over time for each of the subjects I get into trouble:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> ts, 
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> response, <span class="dt">linetype =</span> subject)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>Also, when I would like to calculate something like the change per hour in response level over the different measurements this would be difficult indeed. Take a minute to think about this. Do you know any technique in base R that you’ve encountered so far that supports this?<br />
Actually there are some functions in baser R that can do this, but we’ll stick to the tidyverse.</p>
<p>So this is the area of the <code>lubridate</code> package. I included a <code>library(lubridate)</code> statement at the top of this document so that’s not needed anymore.</p>
<p>Let’s start with reading in date and time variables. There are many dedicated (wrapper) functions for reading date and time data. The <code>date</code> variable has the format “<strong>D</strong>ay/<strong>M</strong>onth/<strong>Y</strong>ear” so the function <code>dmy()</code> should be fine here:</p>
<pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span>ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">dmy</span>(ts<span class="op">$</span>date))
ts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 6
##   subject date       time  date_time        control response
##   &lt;fct&gt;   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;            &lt;fct&gt;      &lt;int&gt;
## 1 S001    2019-12-29 07:44 29/12/2019 07:44 n              2
## 2 S001    2019-12-29 12:06 29/12/2019 12:06 n             68
## 3 S001    2019-12-29 17:28 29/12/2019 17:28 n            112</code></pre>
<p>As you can see, the type has changed into <code>date</code>. Let’s try the plot again:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> ts, 
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> response, <span class="dt">linetype =</span> subject)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>Now we’re getting somewhere. The times are not taken into account yet, so it is simply mapped to 00:00 hours on that day. Also, we’re not really interested in the specific date, we want to know the change from T = 0. We’ll get to that.</p>
<p>Parsing time is the same as parsing the date, we have an “<strong>H</strong>our:<strong>M</strong>inute” format so the function to take is <code>hm()</code> (there is also an <code>hms()</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hm</span>(ts<span class="op">$</span>time)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre>
<pre><code>## [1] &quot;7H 44M 0S&quot;  &quot;12H 6M 0S&quot;  &quot;17H 28M 0S&quot; &quot;22H 1M 0S&quot;  &quot;7H 22M 0S&quot;</code></pre>
<p>And yes, there is also an <code>dmy_hm()</code> function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dmy_hm</span>(ts<span class="op">$</span>date_time)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre>
<pre><code>## [1] &quot;2019-12-29 07:44:00 UTC&quot; &quot;2019-12-29 12:06:00 UTC&quot;
## [3] &quot;2019-12-29 17:28:00 UTC&quot; &quot;2019-12-29 22:01:00 UTC&quot;
## [5] &quot;2019-12-30 07:22:00 UTC&quot;</code></pre>
<p>As long as the format is not too esoteric, lubridate will figure out the separator quite well.</p>
<p>If you want full control -or simply want to remember only one or two functions- you could take either one of <code>fast_strptime()</code> or <code>parse_date_time()</code>. Both take a <strong><em>format string</em></strong> as argument: a string in which you specify the way your date-time character data are structured The most used symbols are these (although you should really also look at the help page):</p>
<ul>
<li><strong><code>b</code></strong> or <strong><code>B</code></strong> Abbreviated or full month name in the current locale. The C parser currently understands only English month names.</li>
<li><strong><code>d</code></strong> Day of the month as decimal number (01–31 or 0–31)</li>
<li><strong><code>H</code></strong> Hours as decimal number (00–24 or 0–24).</li>
<li><strong><code>I</code></strong> Hours as decimal number (01–12 or 1–12).</li>
<li><strong><code>m</code></strong> Month as decimal number (01–12 or 1–12).</li>
<li><strong><code>M</code></strong> Minute as decimal number (00–59 or 0–59).</li>
<li><strong><code>p</code></strong> AM/PM indicator in the locale. Normally used in conjunction with I and not with H.</li>
<li><strong><code>S</code></strong> Second as decimal number (00–61 or 0–61).</li>
<li><strong><code>y</code></strong> Year without century (00–99 or 0–99). In parse_date_time() also matches year with century (Y format).</li>
<li><strong><code>Y</code></strong> Year with century.</li>
</ul>
<p>Function <code>parse_date_time()</code> is the most lenient of the two with respect to the <strong><em>format string</em></strong>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse_date_time</span>(ts<span class="op">$</span>date_time, <span class="st">&quot;d.m-y H:M&quot;</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="co">##doesn&#39;t care I have a typo in my format string</span></code></pre>
<pre><code>## [1] &quot;2019-12-29 07:44:00 UTC&quot; &quot;2019-12-29 12:06:00 UTC&quot;
## [3] &quot;2019-12-29 17:28:00 UTC&quot; &quot;2019-12-29 22:01:00 UTC&quot;
## [5] &quot;2019-12-30 07:22:00 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span>ts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">date_time =</span> <span class="kw">parse_date_time</span>(ts<span class="op">$</span>date_time, <span class="st">&quot;d/m/y H:M&quot;</span>))
<span class="kw">head</span>(ts, <span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 6
##   subject date       time  date_time           control response
##   &lt;fct&gt;   &lt;date&gt;     &lt;chr&gt; &lt;dttm&gt;              &lt;fct&gt;      &lt;int&gt;
## 1 S001    2019-12-29 07:44 2019-12-29 07:44:00 n              2
## 2 S001    2019-12-29 12:06 2019-12-29 12:06:00 n             68
## 3 S001    2019-12-29 17:28 2019-12-29 17:28:00 n            112</code></pre>
<p>The <code>fast_strptime()</code> is much more picky, but much faster. You specify the date(-time) format using<code>%</code> sign together with one of the symbols listed above:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fast_strptime</span>(<span class="st">&#39;29/12/2019 07:44&#39;</span>, <span class="st">&#39;%d/%m/%Y %H:%M&#39;</span>)</code></pre>
<pre><code>## [1] &quot;2019-12-29 07:44:00 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## When in tibble context, you need to set `lt = F`...</span>
ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date_time =</span> <span class="kw">fast_strptime</span>(date_time, <span class="st">&#39;%d/%m/%Y %H:%M&#39;</span>, <span class="dt">lt =</span> F))</code></pre>
<p>I think sticking to the first will suffice.</p>
<div id="current-time" class="section level2">
<h2><span class="header-section-number">5.1</span> Current time</h2>
<p>The functions <code>today()</code> and <code>now()</code> are your friends.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">##output will vary!</span>
<span class="kw">paste</span>(<span class="st">&quot;the day is &quot;</span>, <span class="kw">today</span>())</code></pre>
<pre><code>## [1] &quot;the day is  2020-01-23&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;and to be really exact: &quot;</span>, <span class="kw">now</span>())</code></pre>
<pre><code>## [1] &quot;and to be really exact:  2020-01-23 12:29:26&quot;</code></pre>
</div>
<div id="getting-elements-from-date-time-objects" class="section level2">
<h2><span class="header-section-number">5.2</span> Getting elements from date-time objects</h2>
<p>Once you have the date-time object processed, you can look at the individual elements.</p>
<p>There are -again- many functions related to this. Have a look at the <a href="graphics/lubridate.pdf">cheat sheet</a> for details. Here are the most-used components:</p>
<ul>
<li><strong><code>date(x)</code></strong> Date component leaving the time out.</li>
<li><strong><code>year(x)</code></strong> The year.</li>
<li><strong><code>month(x, label, abbr)</code></strong> The month. When called without other argument, you get the month number (e.g. 2). With the <code>label = TRUE</code> argument you will get text (e.g. Feb) and <code>abbr = FALSE</code> you get the full name of the month (February).</li>
<li><strong><code>day(x)</code></strong> The day of the month.</li>
<li><strong><code>wday(x,label,abbr)</code></strong> The day of week. Label and abbr behaves the same as with <code>month()</code>.</li>
<li><strong><code>hour(x)</code></strong> The hour</li>
<li><strong><code>minute(x)</code></strong> Minutes.</li>
<li><strong><code>second(x)</code></strong> Seconds.</li>
<li><strong><code>week(x)</code></strong> Week of the year.</li>
</ul>
<p>A use case demonstration: On what days were the samples taken of the times series used so far?</p>
<pre class="sourceCode r"><code class="sourceCode r">ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(<span class="dt">day_of_week =</span> <span class="kw">wday</span>(date_time, <span class="dt">label=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">sample_count =</span> <span class="kw">n</span>())
<span class="co"># or, shorter</span>
<span class="co">#ts %&gt;% group_by(day_of_week = wday(date_time, label=T)) %&gt;% tally()</span></code></pre>
<pre><code>## # A tibble: 2 x 2
##   day_of_week sample_count
##   &lt;ord&gt;              &lt;int&gt;
## 1 Sun                   24
## 2 Mon                   24</code></pre>
<p>What was the mean response on the different times of the day:</p>
<pre class="sourceCode r"><code class="sourceCode r">ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(<span class="dt">hour_of_day =</span> <span class="kw">hour</span>(date_time)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(response))</code></pre>
<pre><code>## # A tibble: 4 x 2
##   hour_of_day  mean
##         &lt;int&gt; &lt;dbl&gt;
## 1           7  19.8
## 2          12  41.5
## 3          17  68.8
## 4          22  52</code></pre>
<p>And when split over the control/treatment group as well:</p>
<pre class="sourceCode r"><code class="sourceCode r">ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(control, <span class="dt">hour_of_day =</span> <span class="kw">hour</span>(date_time)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean =</span> <span class="kw">median</span>(response),
              <span class="dt">n =</span> <span class="kw">n</span>())</code></pre>
<pre><code>## # A tibble: 8 x 4
## # Groups:   control [2]
##   control hour_of_day  mean     n
##   &lt;fct&gt;         &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
## 1 n                 7  31       6
## 2 n                12  60       6
## 3 n                17  97       6
## 4 n                22  65.5     6
## 5 y                 7   6.5     6
## 6 y                12  20.5     6
## 7 y                17  42.5     6
## 8 y                22  34.5     6</code></pre>
<p>Finally, let’s close off with a plot</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> ts, 
       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> date_time, <span class="dt">y =</span> response, <span class="dt">color =</span> subject)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>As practice, you could try to generate a response plot like this where subjects 1 to 3 have corrected values based on the non-treated group.</p>
</div>
<div id="calculations-with-date-time" class="section level2">
<h2><span class="header-section-number">5.3</span> Calculations with date-time</h2>
<p>The example below shows the most basic calculation: the difference between two date-time objects.</p>
<pre class="sourceCode r"><code class="sourceCode r">ts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(subject) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(subject, date_time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lagged =</span> <span class="kw">lag</span>(date_time), 
           <span class="dt">diff =</span> date_time <span class="op">-</span><span class="st"> </span>lagged) </code></pre>
<pre><code>## # A tibble: 48 x 4
## # Groups:   subject [6]
##    subject date_time           lagged              diff      
##    &lt;fct&gt;   &lt;dttm&gt;              &lt;dttm&gt;              &lt;drtn&gt;    
##  1 S001    2019-12-29 07:44:00 NA                    NA hours
##  2 S001    2019-12-29 12:06:00 2019-12-29 07:44:00 4.37 hours
##  3 S001    2019-12-29 17:28:00 2019-12-29 12:06:00 5.37 hours
##  4 S001    2019-12-29 22:01:00 2019-12-29 17:28:00 4.55 hours
##  5 S001    2019-12-30 07:22:00 2019-12-29 22:01:00 9.35 hours
##  6 S001    2019-12-30 12:05:00 2019-12-30 07:22:00 4.72 hours
##  7 S001    2019-12-30 17:55:00 2019-12-30 12:05:00 5.83 hours
##  8 S001    2019-12-30 22:55:00 2019-12-30 17:55:00 5.00 hours
##  9 S002    2019-12-29 07:46:00 NA                    NA hours
## 10 S002    2019-12-29 12:09:00 2019-12-29 07:46:00 4.38 hours
## # … with 38 more rows</code></pre>
<p>You can define periods, durations and work with time intervals. However, this is outside the scope of this course.
For this more advanced time math you should refer to the cheat sheet or the offical docs.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stringr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-date-time.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
