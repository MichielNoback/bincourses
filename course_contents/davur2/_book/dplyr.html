<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data mangling with package dplyr | Data Analysis and Visualization using R (2)</title>
  <meta name="description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data mangling with package dplyr | Data Analysis and Visualization using R (2)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data mangling with package dplyr | Data Analysis and Visualization using R (2)" />
  
  <meta name="twitter:description" content="This is the ebook accompanying the course Data Analysis and Visualization using R 2 (DAVuR2)." />
  

<meta name="author" content="Michiel Noback" />


<meta name="date" content="2020-01-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidyr.html">
<link rel="next" href="date-time.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DAVuR2 gitbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>1</b> The <code>ggplot2</code> package</a><ul>
<li class="chapter" data-level="1.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#keep-the-goal-in-mind"><i class="fa fa-check"></i>Keep the goal in mind</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ggplot2.html"><a href="ggplot2.html#getting-started"><i class="fa fa-check"></i><b>1.2</b> Getting started</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#a-first-plot"><i class="fa fa-check"></i>A first plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#adding-a-dimension-using-color"><i class="fa fa-check"></i>Adding a dimension using color</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#inspecting-and-tuning-the-figure"><i class="fa fa-check"></i>Inspecting and tuning the figure</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-and-the-theory-of-graphics"><i class="fa fa-check"></i><b>1.3</b> ggplot2 and the theory of graphics</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#phylosophy-of-ggplot2"><i class="fa fa-check"></i>Phylosophy of ggplot2</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-grammar-of-graphics"><i class="fa fa-check"></i>The grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ggplot2.html"><a href="ggplot2.html#building-plots-with-ggplot2"><i class="fa fa-check"></i><b>1.4</b> Building plots with ggplot2</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#the-layered-plot-architecture"><i class="fa fa-check"></i>The layered plot architecture</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#tidy-the-data"><i class="fa fa-check"></i>“Tidy” the data</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="ggplot2.html"><a href="ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>1.5</b> Aesthetics</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#colors"><i class="fa fa-check"></i>Colors</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#shapes"><i class="fa fa-check"></i>Shapes</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#lines"><i class="fa fa-check"></i>Lines</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#size"><i class="fa fa-check"></i>Size</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="ggplot2.html"><a href="ggplot2.html#geometries"><i class="fa fa-check"></i><b>1.6</b> Geometries</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#what-are-geometries"><i class="fa fa-check"></i>What are geometries</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#jitter"><i class="fa fa-check"></i>Jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#plot-overlays-boxplot-jitter"><i class="fa fa-check"></i>Plot overlays: boxplot + jitter</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scatterplot-points"><i class="fa fa-check"></i>Scatterplot: Points</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#line-plots"><i class="fa fa-check"></i>Line plots</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#histograms"><i class="fa fa-check"></i>Histograms</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#violin-plot"><i class="fa fa-check"></i>Violin plot</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#overview-of-the-main-geoms"><i class="fa fa-check"></i>Overview of the main geoms</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="ggplot2.html"><a href="ggplot2.html#inheritance-of-aesthetics"><i class="fa fa-check"></i><b>1.7</b> Inheritance of aesthetics</a></li>
<li class="chapter" data-level="1.8" data-path="ggplot2.html"><a href="ggplot2.html#facetting"><i class="fa fa-check"></i><b>1.8</b> Facetting</a></li>
<li class="chapter" data-level="1.9" data-path="ggplot2.html"><a href="ggplot2.html#experimenting-with-geoms-and-aesthetics"><i class="fa fa-check"></i><b>1.9</b> Experimenting with geoms and aesthetics</a></li>
<li class="chapter" data-level="1.10" data-path="ggplot2.html"><a href="ggplot2.html#final-tweeks"><i class="fa fa-check"></i><b>1.10</b> Final tweeks</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#scales-and-coordinates"><i class="fa fa-check"></i>Scales and Coordinates</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#themes"><i class="fa fa-check"></i>Themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html"><i class="fa fa-check"></i><b>2</b> Developing a custom visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#an-experimental-ptsd-treatment"><i class="fa fa-check"></i><b>2.1</b> An experimental PTSD treatment</a><ul>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-data"><i class="fa fa-check"></i>The data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#choose-a-visualization"><i class="fa fa-check"></i>Choose a visualization</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#tidy-the-data-1"><i class="fa fa-check"></i>Tidy the data</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#a-first-version"><i class="fa fa-check"></i>A first version</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#add-mean-and-sd"><i class="fa fa-check"></i>Add mean and SD</a></li>
<li class="chapter" data-level="" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#emphasise-worst-cases"><i class="fa fa-check"></i>Emphasise worst cases</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#last-tweaks-fonts-and-legend"><i class="fa fa-check"></i><b>2.2</b> Last tweaks: fonts and legend</a></li>
<li class="chapter" data-level="2.3" data-path="developing-a-custom-visualization.html"><a href="developing-a-custom-visualization.html#the-code"><i class="fa fa-check"></i><b>2.3</b> The code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>3</b> Package tidyr</a><ul>
<li class="chapter" data-level="3.1" data-path="tidyr.html"><a href="tidyr.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="tidyr.html"><a href="tidyr.html#the-gather-function"><i class="fa fa-check"></i><b>3.2</b> The <code>gather()</code> function</a></li>
<li class="chapter" data-level="3.3" data-path="tidyr.html"><a href="tidyr.html#a-more-complex-problem-two-sets-of-columns"><i class="fa fa-check"></i><b>3.3</b> A more complex problem: two sets of columns</a></li>
<li class="chapter" data-level="3.4" data-path="tidyr.html"><a href="tidyr.html#widening-with-spread-and-pivot_wider"><i class="fa fa-check"></i><b>3.4</b> Widening with <code>spread()</code> and <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="3.5" data-path="tidyr.html"><a href="tidyr.html#separate-columns"><i class="fa fa-check"></i><b>3.5</b> <code>separate()</code> columns</a></li>
<li class="chapter" data-level="3.6" data-path="tidyr.html"><a href="tidyr.html#combine-columns"><i class="fa fa-check"></i><b>3.6</b> combine columns</a></li>
<li class="chapter" data-level="3.7" data-path="tidyr.html"><a href="tidyr.html#drop-rows-with-missing-values-drop_na"><i class="fa fa-check"></i><b>3.7</b> Drop rows with missing values: <code>drop_na()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Data mangling with package <code>dplyr</code></a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>4.1</b> Tibbles</a><ul>
<li class="chapter" data-level="4.1.1" data-path="dplyr.html"><a href="dplyr.html#by-row-constructor"><i class="fa fa-check"></i><b>4.1.1</b> By-row constructor</a></li>
<li class="chapter" data-level="4.1.2" data-path="dplyr.html"><a href="dplyr.html#tibbles-vs-data-frames"><i class="fa fa-check"></i><b>4.1.2</b> Tibbles vs data frames</a></li>
<li class="chapter" data-level="4.1.3" data-path="dplyr.html"><a href="dplyr.html#the-str-equivalent-glimpse"><i class="fa fa-check"></i><b>4.1.3</b> The <code>str()</code> equivalent: <code>glimpse()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#the-chaining-operator"><i class="fa fa-check"></i><b>4.2</b> The chaining operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#selecting"><i class="fa fa-check"></i><b>4.3</b> Selecting</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#selecting-rows-by-index-slice"><i class="fa fa-check"></i><b>4.3.1</b> Selecting rows by index: <code>slice()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#get-unique-cases-with-distinct"><i class="fa fa-check"></i><b>4.3.2</b> Get unique cases with <code>distinct()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="dplyr.html"><a href="dplyr.html#filter-cases"><i class="fa fa-check"></i><b>4.3.3</b> <code>filter()</code> cases</a></li>
<li class="chapter" data-level="4.3.4" data-path="dplyr.html"><a href="dplyr.html#selecting-variables-select"><i class="fa fa-check"></i><b>4.3.4</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="dplyr.html"><a href="dplyr.html#renaming-variables-rename"><i class="fa fa-check"></i><b>4.3.5</b> Renaming variables: <code>rename()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="dplyr.html"><a href="dplyr.html#selecting-from-ranked-data"><i class="fa fa-check"></i><b>4.3.6</b> Selecting from ranked data</a></li>
<li class="chapter" data-level="4.3.7" data-path="dplyr.html"><a href="dplyr.html#extract-a-colum-as-vector"><i class="fa fa-check"></i><b>4.3.7</b> Extract a colum as vector</a></li>
<li class="chapter" data-level="4.3.8" data-path="dplyr.html"><a href="dplyr.html#sorting-with-arrange"><i class="fa fa-check"></i><b>4.3.8</b> Sorting with <code>arrange()</code></a></li>
<li class="chapter" data-level="4.3.9" data-path="dplyr.html"><a href="dplyr.html#random-sampling"><i class="fa fa-check"></i><b>4.3.9</b> Random sampling</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#adding-and-changing-variables"><i class="fa fa-check"></i><b>4.4</b> Adding and changing variables</a><ul>
<li class="chapter" data-level="4.4.1" data-path="dplyr.html"><a href="dplyr.html#window-functions"><i class="fa fa-check"></i><b>4.4.1</b> Window functions</a></li>
<li class="chapter" data-level="4.4.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>4.4.2</b> Add one or more variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="dplyr.html"><a href="dplyr.html#create-new-variables-based-on-more-columns"><i class="fa fa-check"></i><b>4.4.3</b> Create new variables based on more columns</a></li>
<li class="chapter" data-level="4.4.4" data-path="dplyr.html"><a href="dplyr.html#change-a-variable-recode-and-recode_factor"><i class="fa fa-check"></i><b>4.4.4</b> Change a variable: <code>recode()</code> and <code>recode_factor()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#operations-on-groups"><i class="fa fa-check"></i><b>4.5</b> Operations on groups</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#group_by-and-ungroup"><i class="fa fa-check"></i><b>4.5.1</b> <code>group_by()</code> and <code>ungroup()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#group_split-and-group_keys"><i class="fa fa-check"></i><b>4.5.2</b> <code>group_split()</code> and <code>group_keys()</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#apply-a-function-to-each-group"><i class="fa fa-check"></i><b>4.5.3</b> Apply a function to each group</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#summarizing-and-counting"><i class="fa fa-check"></i><b>4.6</b> Summarizing and counting</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#combining-data"><i class="fa fa-check"></i><b>4.7</b> Combining data</a><ul>
<li class="chapter" data-level="4.7.1" data-path="dplyr.html"><a href="dplyr.html#merging"><i class="fa fa-check"></i><b>4.7.1</b> Merging</a></li>
<li class="chapter" data-level="4.7.2" data-path="dplyr.html"><a href="dplyr.html#adding-rows-and-columns"><i class="fa fa-check"></i><b>4.7.2</b> Adding rows and columns</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="date-time.html"><a href="date-time.html"><i class="fa fa-check"></i><b>5</b> Working with date-time data: <code>lubridate</code></a><ul>
<li class="chapter" data-level="5.1" data-path="date-time.html"><a href="date-time.html#current-time"><i class="fa fa-check"></i><b>5.1</b> Current time</a></li>
<li class="chapter" data-level="5.2" data-path="date-time.html"><a href="date-time.html#getting-elements-from-date-time-objects"><i class="fa fa-check"></i><b>5.2</b> Getting elements from date-time objects</a></li>
<li class="chapter" data-level="5.3" data-path="date-time.html"><a href="date-time.html#calculations-with-date-time"><i class="fa fa-check"></i><b>5.3</b> Calculations with date-time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stringr.html"><a href="stringr.html"><i class="fa fa-check"></i><b>6</b> Processing text with: <code>stringr</code> and regex</a><ul>
<li class="chapter" data-level="6.1" data-path="stringr.html"><a href="stringr.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="6.1.1" data-path="stringr.html"><a href="stringr.html#a-few-remarks-on-locale"><i class="fa fa-check"></i><b>6.1.1</b> A few remarks on “locale”</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stringr.html"><a href="stringr.html#review-of-regular-expressions"><i class="fa fa-check"></i><b>6.2</b> Review of regular expressions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="stringr.html"><a href="stringr.html#regex-syntax-elements"><i class="fa fa-check"></i><b>6.2.1</b> Regex syntax elements</a></li>
<li class="chapter" data-level="6.2.2" data-path="stringr.html"><a href="stringr.html#character-classes-and-negation"><i class="fa fa-check"></i><b>6.2.2</b> Character classes and negation</a></li>
<li class="chapter" data-level="6.2.3" data-path="stringr.html"><a href="stringr.html#quantifiers"><i class="fa fa-check"></i><b>6.2.3</b> Quantifiers</a></li>
<li class="chapter" data-level="6.2.4" data-path="stringr.html"><a href="stringr.html#anchoring"><i class="fa fa-check"></i><b>6.2.4</b> Anchoring</a></li>
<li class="chapter" data-level="6.2.5" data-path="stringr.html"><a href="stringr.html#alternatives"><i class="fa fa-check"></i><b>6.2.5</b> Alternatives</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stringr.html"><a href="stringr.html#the-stringr-essentials"><i class="fa fa-check"></i><b>6.3</b> The <code>stringr</code> essentials</a><ul>
<li class="chapter" data-level="6.3.1" data-path="stringr.html"><a href="stringr.html#case-conversion"><i class="fa fa-check"></i><b>6.3.1</b> Case conversion</a></li>
<li class="chapter" data-level="6.3.2" data-path="stringr.html"><a href="stringr.html#split-join-and-substring"><i class="fa fa-check"></i><b>6.3.2</b> Split, join and substring</a></li>
<li class="chapter" data-level="6.3.3" data-path="stringr.html"><a href="stringr.html#matching"><i class="fa fa-check"></i><b>6.3.3</b> Matching</a></li>
<li class="chapter" data-level="6.3.4" data-path="stringr.html"><a href="stringr.html#extracting-and-replacing"><i class="fa fa-check"></i><b>6.3.4</b> Extracting and replacing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="eda.html"><a href="eda.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="eda.html"><a href="eda.html#getting-to-know-the-dataset"><i class="fa fa-check"></i><b>7.2</b> Getting to know the dataset</a><ul>
<li class="chapter" data-level="7.2.1" data-path="eda.html"><a href="eda.html#the-codebook"><i class="fa fa-check"></i><b>7.2.1</b> The codebook</a></li>
<li class="chapter" data-level="7.2.2" data-path="eda.html"><a href="eda.html#load-and-inspect-the-data"><i class="fa fa-check"></i><b>7.2.2</b> Load and inspect the data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="eda.html"><a href="eda.html#exploring-variables"><i class="fa fa-check"></i><b>7.3</b> Exploring variables</a><ul>
<li class="chapter" data-level="7.3.1" data-path="eda.html"><a href="eda.html#first-steps"><i class="fa fa-check"></i><b>7.3.1</b> First steps</a></li>
<li class="chapter" data-level="7.3.2" data-path="eda.html"><a href="eda.html#smoking-data-corrupted"><i class="fa fa-check"></i><b>7.3.2</b> Smoking data corrupted?</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="eda.html"><a href="eda.html#variable-engineering"><i class="fa fa-check"></i><b>7.4</b> Variable engineering</a><ul>
<li class="chapter" data-level="7.4.1" data-path="eda.html"><a href="eda.html#recoding-strategies"><i class="fa fa-check"></i><b>7.4.1</b> Recoding strategies</a></li>
<li class="chapter" data-level="7.4.2" data-path="eda.html"><a href="eda.html#factorization"><i class="fa fa-check"></i><b>7.4.2</b> “factorization”</a></li>
<li class="chapter" data-level="7.4.3" data-path="eda.html"><a href="eda.html#data-redundancy-in-std-variables"><i class="fa fa-check"></i><b>7.4.3</b> Data redundancy in STD variables</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="eda.html"><a href="eda.html#the-dependent-variable"><i class="fa fa-check"></i><b>7.5</b> The dependent variable</a></li>
<li class="chapter" data-level="7.6" data-path="eda.html"><a href="eda.html#exploring-relationships-between-variables"><i class="fa fa-check"></i><b>7.6</b> Exploring relationships between variables</a><ul>
<li class="chapter" data-level="7.6.1" data-path="eda.html"><a href="eda.html#the-scatterplot"><i class="fa fa-check"></i><b>7.6.1</b> The scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="eda.html"><a href="eda.html#look-for-patterns-with-the-dependent-variable"><i class="fa fa-check"></i><b>7.7</b> Look for patterns with the dependent variable</a></li>
<li class="chapter" data-level="7.8" data-path="eda.html"><a href="eda.html#density-plots-show-class-distinction"><i class="fa fa-check"></i><b>7.8</b> Density plots show class distinction</a><ul>
<li class="chapter" data-level="7.8.1" data-path="eda.html"><a href="eda.html#the-xor-problem"><i class="fa fa-check"></i><b>7.8.1</b> The ‘xor’ problem</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="eda.html"><a href="eda.html#advanced-explorations"><i class="fa fa-check"></i><b>7.9</b> Advanced Explorations</a><ul>
<li class="chapter" data-level="7.9.1" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>7.9.1</b> PCA</a></li>
<li class="chapter" data-level="7.9.2" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>7.9.2</b> Clustering</a></li>
<li class="chapter" data-level="7.9.3" data-path="eda.html"><a href="eda.html#k-means-clustering"><i class="fa fa-check"></i><b>7.9.3</b> k-Means clustering</a></li>
<li class="chapter" data-level="7.9.4" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>7.9.4</b> hierarchical clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>8</b> Exercises</a><ul>
<li class="chapter" data-level="8.1" data-path="exercises.html"><a href="exercises.html#introduction-4"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis and Visualization using R (2)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data mangling with package <code>dplyr</code></h1>
<p>This package, which is also in the tidyverse, is quite versatile. You can use it for a wide range of activities.
Some examples are</p>
<ul>
<li>summarizing data; e.g. counting, ranking,</li>
<li>selecting, filtering and sampling cases</li>
<li>manipulating data; creatng new or changing existing variables</li>
<li>combining tables</li>
</ul>
<p>In this chapter only a small selection of this package will be discussed.</p>
<p>There is an excellent cheat sheet for this package. You can find it <a href="https://rstudio.com/resources/cheatsheets/">here</a>. For convenience, primarily because this gitbook is also used in offline mode during examinations, I included it here as well: <a href="graphics/dplyr-data-transformation.pdf">dplyr-data-transformation.pdf</a></p>
<p>Before embarking on an overview of the most important functions, let’s first look at the <code>tibble</code> and the <code>%&gt;%</code> chaining operator.</p>
<p>The sections below are copied (and adapted) for in part from the <code>dplyr</code> and <code>tibble</code> vignettes which can be found <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">here</a> and <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html">here</a></p>
<p>In this chapter I will often use the term <strong><em>case</em></strong> instead of row and <strong><em>variable</em></strong> instead of column since they more precisely describe the essence. Also, these terms are used more in the tidyverse packages.</p>
<div id="tibbles" class="section level2">
<h2><span class="header-section-number">4.1</span> Tibbles</h2>
<p>Tibbles are a modern take on data frames. They keep the features that have stood the test of time, and drop the features that used to be convenient but are now frustrating (i.e. converting character vectors to factors). There is an entire package dedicated to tibbles, not surprisingle called <code>tibble</code> you usually do not have to load the ackage because dplyr and tidyr do that already (they depend on it themselves).</p>
<p>Use the <code>tibble()</code> constructor to create them as literals. There are several advantages over the old <code>data.frame</code> constructor:</p>
<ul>
<li>It never changes an input’s type (i.e., no more <code>stringsAsFactors = FALSE</code>!).</li>
<li>It never adjusts the names of variables: <code>name with space</code> does not become <code>name.with.space</code>.</li>
<li><p>It evaluates its arguments lazily and sequentially:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</code></pre>
<pre><code>## # A tibble: 5 x 2
##       x     y
##   &lt;int&gt; &lt;dbl&gt;
## 1     1     1
## 2     2     4
## 3     3     9
## 4     4    16
## 5     5    25</code></pre></li>
<li>It never uses <code>row.names()</code>. The whole point of tidy data is to store variables in a consistent way. So it never stores a variable as special attribute.</li>
<li><p>It only recycles vectors of length 1. This is because recycling vectors of greater lengths is a frequent source of bugs.</p></li>
</ul>
<p><strong>Coersion</strong>
To complement <code>tibble()</code>, tibble provides <code>as_tibble()</code> to coerce objects into tibbles.</p>
<div id="by-row-constructor" class="section level3">
<h3><span class="header-section-number">4.1.1</span> By-row constructor</h3>
<p>There is a third function, <code>tribble()</code> that you can use to define a table in an alternative way: row-wise.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tribble</span>(
  <span class="op">~</span>colA, <span class="op">~</span>colB,
  <span class="st">&quot;a&quot;</span>,   <span class="dv">1</span>,
  <span class="st">&quot;b&quot;</span>,   <span class="dv">2</span>,
  <span class="st">&quot;c&quot;</span>,   <span class="dv">3</span>
)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   colA   colB
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         1
## 2 b         2
## 3 c         3</code></pre>
</div>
<div id="tibbles-vs-data-frames" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Tibbles vs data frames</h3>
<p>There are three key differences between tibbles and data frames: printing, subsetting, and recycling rules.</p>
<p><strong>Printing</strong><br />
- When you print a tibble, it only shows the first ten rows and all the columns that fit on one screen. It also prints an abbreviated description of the column type, and uses font styles and color for highlighting.
- You can control the default appearance with options:
- <code>options(tibble.print_max = n, tibble.print_min = m)</code>: if there are more than <code>n</code> rows, print only the first <code>m</code> rows. Use <code>options(tibble.print_max = Inf)</code> to always show all rows.
- <code>options(tibble.width = Inf)</code> will always print all columns, regardless of the width of the screen.</p>
<p><strong>Subsetting</strong><br />
Tibbles are quite strict about subsetting. <code>[</code> always returns another tibble. Contrast this with a data frame: sometimes <code>[</code> returns a data frame and sometimes it just returns a vector.</p>
<p><strong>Recycling</strong><br />
When constructing a tibble, only values of length 1 are recycled. The first column with length different to one determines the number of rows in the tibble, conflicts lead to an error. This also extends to tibbles with zero rows, which is sometimes important for programming:</p>
</div>
<div id="the-str-equivalent-glimpse" class="section level3">
<h3><span class="header-section-number">4.1.3</span> The <code>str()</code> equivalent: <code>glimpse()</code></h3>
<p>The <code>glimpse()</code> function is the dplyr equivalent of <code>str()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(dose_response_long)</code></pre>
<pre><code>## Observations: 52
## Variables: 4
## $ patient  &lt;chr&gt; &quot;001&quot;, &quot;002&quot;, &quot;003&quot;, &quot;004&quot;, &quot;005&quot;, &quot;006&quot;, &quot;007&quot;, &quot;008&quot;,…
## $ sex      &lt;fct&gt; f, f, m, m, f, f, f, m, f, m, m, m, m, f, m, f, f, m, m…
## $ Dose     &lt;chr&gt; &quot;dose10mg&quot;, &quot;dose10mg&quot;, &quot;dose10mg&quot;, &quot;dose10mg&quot;, &quot;dose10…
## $ Response &lt;int&gt; 12, 11, 54, 71, 19, 22, 23, 68, 30, 83, 72, 48, 67, 13,…</code></pre>
</div>
</div>
<div id="the-chaining-operator" class="section level2">
<h2><span class="header-section-number">4.2</span> The chaining operator <code>%&gt;%</code></h2>
<p>In any workflow, it happens all the time that you apply some function to a dataframe, store the result in a new variable (or overwrite the first) and apply a second function to this dataframe. And so on.
There are two undesirable results with this. The first is cluttered code: many variables; how are you going to name them? Just have a look at the previous chapter and you’ll understand. The second -and much worse if you are working with big dataframes- is cluttering of the environment and memory footprint.</p>
<p>This is where the chaining operator comes in. It helps you create clean workflows where intermediate results are only stored when opportune.</p>
<p>It comes down to this simple notion: <code>x %&gt;% f(y))</code> is equivalent to f(x, y) where <code>f</code> is any function.</p>
<p>Here is the good old dose-response example again, converted to a tibble.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long</code></pre>
<pre><code>## # A tibble: 52 x 4
##    patient sex   Dose     Response
##    &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt;
##  1 001     f     dose10mg       12
##  2 002     f     dose10mg       11
##  3 003     m     dose10mg       54
##  4 004     m     dose10mg       71
##  5 005     f     dose10mg       19
##  6 006     f     dose10mg       22
##  7 007     f     dose10mg       23
##  8 008     m     dose10mg       68
##  9 009     f     dose10mg       30
## 10 010     m     dose10mg       83
## # … with 42 more rows</code></pre>
<p>Suppose I want to remove cases with missing values (there aren’t any - this is for the sake of argument), select the female subjects and then calculate the mean response for the two doses.
In base R, you could do something like this.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long_no_na &lt;-<span class="st"> </span><span class="kw">na.omit</span>(dose_response_long)
dose_response_long_no_na_only_female &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="dt">x =</span> dose_response_long_no_na, <span class="dt">subset =</span> sex <span class="op">==</span><span class="st"> &quot;f&quot;</span>)
<span class="kw">aggregate</span>(Response <span class="op">~</span><span class="st"> </span>Dose, <span class="dt">data =</span> dose_response_long_no_na_only_female, <span class="dt">FUN =</span> mean)</code></pre>
<pre><code>##        Dose Response
## 1 dose100mg     80.9
## 2  dose10mg     19.6</code></pre>
<p>I know, I exaggerated a bit with the variable names.</p>
<p>Here is the same workflow, using <code>dplyr</code>, but with the intermediate variables. It even has an explicit operation extra (<code>group_by()</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long_no_na &lt;-<span class="st"> </span><span class="kw">drop_na</span>(dose_response_long)
dose_response_long_no_na_only_female &lt;-<span class="st"> </span><span class="kw">filter</span>(dose_response_long_no_na, sex <span class="op">==</span><span class="st"> &quot;f&quot;</span>)
dose_response_long_no_na_only_female_grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(dose_response_long_no_na_only_female,
                                                         Dose)
<span class="kw">summarize</span>(dose_response_long_no_na_only_female_grouped, <span class="dt">mean_response =</span> <span class="kw">mean</span>(Response))</code></pre>
<pre><code>## # A tibble: 2 x 2
##   Dose      mean_response
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 dose100mg          80.9
## 2 dose10mg           19.6</code></pre>
<p>And, finally, how dplyr is supposed to be used.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(sex <span class="op">==</span><span class="st"> &quot;f&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_response =</span> <span class="kw">mean</span>(Response))</code></pre>
<pre><code>## # A tibble: 2 x 2
##   Dose      mean_response
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 dose100mg          80.9
## 2 dose10mg           19.6</code></pre>
<p>Isn’t that a treat for your eyes? A highly readable, minimal piece of code, and what’s more - no environment clogged with data you forget to clean up.
Note that <code>drop_na</code> is actually from the tidyr package. However, it works seamlessly in the chaining context of dplyr functions.</p>
<p>This is the power of dplyr and the chaining operator!
If you do actually want the result stored, you only need to assign to a single variable at the beginning of the chain.</p>
<p>Does it work with <code>ggplot2</code> as well?</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">y =</span> Response)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">        </span><span class="kw">facet_wrap</span>(Dose <span class="op">~</span><span class="st"> </span>.)</code></pre>
<p><img src="bookdown-demo_files/figure-html/chain-to-ggplot-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>I don’t know about you, but this kind of thing makes me happy!
The only thing that bothers me slightly is the <code>+</code> instead of <code>%&gt;%</code> in ggplot2 context.
On the other hand it is layering, not chaining what ggplot2 does, so there is clear distinction.</p>
<p>You have seen the essence of the tidyverse: <strong><em>clean chained workflows</em></strong>.</p>
<p>The sections below are copied (and adapted) for a large part from the <code>dplyr</code> vignette which can be found <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">here</a></p>
<p>Dplyr aims to provide a function for each basic verb of data manipulation:</p>
<p><code>filter()</code> and <code>unique()</code> to select cases based on (the uniqueness of) their values.
<code>arrange()</code> to reorder the cases.
<code>select()</code> and <code>rename()</code> to select variables based on their names.
<code>mutate()</code> and <code>transmute()</code> to add new variables that are functions of existing variables.
<code>summarise()</code> to condense multiple values to a single value.
<code>sample_n()</code> and <code>sample_frac()</code> to take random samples.</p>
</div>
<div id="selecting" class="section level2">
<h2><span class="header-section-number">4.3</span> Selecting</h2>
<div id="selecting-rows-by-index-slice" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Selecting rows by index: <code>slice()</code></h3>
<p>If you simply want to select rows by index, use <code>slice()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slice</span>(dose_response_long, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   patient sex   Dose     Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt;
## 1 002     f     dose10mg       11
## 2 003     m     dose10mg       54
## 3 004     m     dose10mg       71</code></pre>
<p>The functions <code>head()</code> and <code>tail()</code> work as expected; they work with tibbles as well (by overloading) and in the context of chained actions.</p>
</div>
<div id="get-unique-cases-with-distinct" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Get unique cases with <code>distinct()</code></h3>
<p>The <code>distinct()</code> function retains only unique/distinct cases from an input <code>tbl</code> or <code>data.frame</code>. You provide variables to use when determining uniqueness. If there are multiple cases for a given combination of inputs, only the first case will be preserved. If omitted, will use all variables. The <code>.keep_all</code> argument specifies whether all variables in the tbl should be kept.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(sex, Dose, <span class="dt">.keep_all =</span> T)</code></pre>
<pre><code>## # A tibble: 4 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 001     f     dose10mg        12
## 2 003     m     dose10mg        54
## 3 001     f     dose100mg       88
## 4 003     m     dose100mg       14</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(Dose)</code></pre>
<pre><code>## # A tibble: 2 x 1
##   Dose     
##   &lt;chr&gt;    
## 1 dose10mg 
## 2 dose100mg</code></pre>
</div>
<div id="filter-cases" class="section level3">
<h3><span class="header-section-number">4.3.3</span> <code>filter()</code> cases</h3>
<p>This function is similar to the <code>subset</code> argument of the <code>subset()</code> function.</p>
<p>The filter function <code>filter()</code> allows you to select a subset of cases in a data frame. The first argument is the tibble or data frame. The second and subsequent arguments refer to variables within that data frame, selecting cases where the expression is TRUE.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Dose <span class="op">==</span><span class="st"> &quot;dose10mg&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Response <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>)</code></pre>
<pre><code>## # A tibble: 7 x 4
##   patient sex   Dose     Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt;
## 1 004     m     dose10mg       71
## 2 008     m     dose10mg       68
## 3 010     m     dose10mg       83
## 4 011     m     dose10mg       72
## 5 013     m     dose10mg       67
## 6 015     m     dose10mg       73
## 7 024     m     dose10mg       61</code></pre>
<p>When you want to filter rows based on a regular expression pattern matching a character value you can do something like the chunk below, because the only thing select needs is a logical vector.</p>
<pre class="sourceCode r"><code class="sourceCode r">(t &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;abb&quot;</span>, <span class="st">&quot;bbc&quot;</span>, <span class="st">&quot;dbbd&quot;</span>, <span class="st">&quot;aacc&quot;</span>), <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>))</code></pre>
<pre><code>## # A tibble: 4 x 2
##   x         y
##   &lt;chr&gt; &lt;int&gt;
## 1 abb       1
## 2 bbc       2
## 3 dbbd      3
## 4 aacc      4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;bb&quot;</span>, x))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   x         y
##   &lt;chr&gt; &lt;int&gt;
## 1 abb       1
## 2 bbc       2
## 3 dbbd      3</code></pre>
<p>Using <code>str_detect()</code> from the <code>stringr</code> tidyverse package this is also possible:</p>
<pre class="sourceCode r"><code class="sourceCode r">t <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(x, <span class="st">&quot;bb&quot;</span>))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   x         y
##   &lt;chr&gt; &lt;int&gt;
## 1 abb       1
## 2 bbc       2
## 3 dbbd      3</code></pre>
</div>
<div id="selecting-variables-select" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Selecting variables: <code>select()</code></h3>
<p>This function is similar to the <code>select</code> argument of the <code>subset()</code> function.</p>
<p>Choose variables from a table. Closely related to <code>rename()</code> discussed below; <code>select()</code> keeps only the listed variables and <code>rename()</code> keeps all variables.</p>
<p>When you use the <code>key = value</code> format this will result in a rename of the variable.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dose_response_long, patient, <span class="dt">gender =</span> sex)</code></pre>
<pre><code>## # A tibble: 52 x 2
##    patient gender
##    &lt;chr&gt;   &lt;fct&gt; 
##  1 001     f     
##  2 002     f     
##  3 003     m     
##  4 004     m     
##  5 005     f     
##  6 006     f     
##  7 007     f     
##  8 008     m     
##  9 009     f     
## 10 010     m     
## # … with 42 more rows</code></pre>
<p>Use the minus sign when you want to select everything <em>but</em> a variable:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dose_response_long, <span class="op">-</span>patient, <span class="op">-</span>sex)</code></pre>
<pre><code>## # A tibble: 52 x 2
##    Dose     Response
##    &lt;chr&gt;       &lt;int&gt;
##  1 dose10mg       12
##  2 dose10mg       11
##  3 dose10mg       54
##  4 dose10mg       71
##  5 dose10mg       19
##  6 dose10mg       22
##  7 dose10mg       23
##  8 dose10mg       68
##  9 dose10mg       30
## 10 dose10mg       83
## # … with 42 more rows</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## same as </span>
<span class="co">#select(dose_response_long, -c(patient, sex))</span></code></pre>
<p>You can use the colon operator to indicate a range of variables:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dose_response_long, patient<span class="op">:</span>Dose)</code></pre>
<pre><code>## # A tibble: 52 x 3
##    patient sex   Dose    
##    &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;   
##  1 001     f     dose10mg
##  2 002     f     dose10mg
##  3 003     m     dose10mg
##  4 004     m     dose10mg
##  5 005     f     dose10mg
##  6 006     f     dose10mg
##  7 007     f     dose10mg
##  8 008     m     dose10mg
##  9 009     f     dose10mg
## 10 010     m     dose10mg
## # … with 42 more rows</code></pre>
<div id="tidyselect-helpers" class="section level4">
<h4><span class="header-section-number">4.3.4.1</span> Tidyselect helpers</h4>
<p>Both with <code>select()</code> and <code>rename()</code> and also with <code>mutate_at()</code> you can use the special helper functions of the tidyselect package:</p>
<ul>
<li><code>starts_with()</code>: Starts with a prefix.</li>
<li><code>ends_with()</code>: Ends with a suffix.</li>
<li><code>contains()</code>: Contains a literal string.</li>
<li><code>matches()</code>: Matches a regular expression.</li>
<li><code>num_range()</code>: Matches a numerical range like x01, x02, x03.</li>
<li><code>one_of()</code>: Matches variable names in a character vector.</li>
<li><code>everything()</code>: Matches all variables.</li>
<li><code>last_col()</code>: Select last variable, possibly with an offset.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dose_response_long, <span class="kw">contains</span>(<span class="st">&quot;o&quot;</span>))</code></pre>
<pre><code>## # A tibble: 52 x 2
##    Dose     Response
##    &lt;chr&gt;       &lt;int&gt;
##  1 dose10mg       12
##  2 dose10mg       11
##  3 dose10mg       54
##  4 dose10mg       71
##  5 dose10mg       19
##  6 dose10mg       22
##  7 dose10mg       23
##  8 dose10mg       68
##  9 dose10mg       30
## 10 dose10mg       83
## # … with 42 more rows</code></pre>
</div>
</div>
<div id="renaming-variables-rename" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Renaming variables: <code>rename()</code></h3>
<p>Rename variables from a table.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">Patient =</span> patient, <span class="dt">Gender =</span> sex)</code></pre>
<pre><code>## # A tibble: 52 x 4
##    Patient Gender Dose     Response
##    &lt;chr&gt;   &lt;fct&gt;  &lt;chr&gt;       &lt;int&gt;
##  1 001     f      dose10mg       12
##  2 002     f      dose10mg       11
##  3 003     m      dose10mg       54
##  4 004     m      dose10mg       71
##  5 005     f      dose10mg       19
##  6 006     f      dose10mg       22
##  7 007     f      dose10mg       23
##  8 008     m      dose10mg       68
##  9 009     f      dose10mg       30
## 10 010     m      dose10mg       83
## # … with 42 more rows</code></pre>
</div>
<div id="selecting-from-ranked-data" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Selecting from ranked data</h3>
<p>The <code>top_n()</code> function makes it easy to select a few cases that based on the ranking of a value:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">3</span>, Response)</code></pre>
<pre><code>## # A tibble: 4 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 005     f     dose100mg       89
## 2 006     f     dose100mg       99
## 3 017     f     dose100mg       96
## 4 021     f     dose100mg       89</code></pre>
<p>We see 4 cases returned because the third rank is the same for two cases.</p>
<p>This is especially interesting with grouped data:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Dose) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">3</span>, Response)</code></pre>
<pre><code>## # A tibble: 7 x 4
## # Groups:   Dose [2]
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 010     m     dose10mg        83
## 2 011     m     dose10mg        72
## 3 015     m     dose10mg        73
## 4 005     f     dose100mg       89
## 5 006     f     dose100mg       99
## 6 017     f     dose100mg       96
## 7 021     f     dose100mg       89</code></pre>
</div>
<div id="extract-a-colum-as-vector" class="section level3">
<h3><span class="header-section-number">4.3.7</span> Extract a colum as vector</h3>
<p>Using <code>pull()</code> you can obtain atomic vectors.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pull</span>(dose_response_long, Response)</code></pre>
<pre><code>##  [1] 12 11 54 71 19 22 23 68 30 83 72 48 67 13 73 20 22 40 57 26 17 29 54
## [24] 61 57 11 88 54 14 21 89 99 69 31 85 18 37 28 16 79 22 84 96 14 12 63
## [47] 89 77 21 10 36 80</code></pre>
<p>This is of course the same as <code>dose_response_long[[4]]</code> or <code>dose_response_long$Response</code> but the difference is that <code>pull()</code> can be applied in a <code>%&gt;%</code> pipeline.<br />
With <code>dose_response_long[, 4]</code> it matters whether you are working with a tibble or a dataframe; a tibble returns a tibble and a dataframe returns a vector.</p>
</div>
<div id="sorting-with-arrange" class="section level3">
<h3><span class="header-section-number">4.3.8</span> Sorting with <code>arrange()</code></h3>
<p>If you want to sort the rows of a dataframe/tibble by the values of one or more columns, use <code>arrange()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Response) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 024     m     dose100mg       10
## 2 002     f     dose10mg        11
## 3 026     f     dose10mg        11</code></pre>
<p>Use the function <code>desc()</code> to reverse the ordering</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Response)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>)</code></pre>
<pre><code>## # A tibble: 1 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 006     f     dose100mg       99</code></pre>
<p>Note that the previous chunk is equivalent to this</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">1</span>, Response)</code></pre>
<pre><code>## # A tibble: 1 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 006     f     dose100mg       99</code></pre>
<p>So natural oredering is from low to high, but the <code>top_n()</code> function always orders from high to low. You can reverse this as well using the <code>desc()</code> function.</p>
</div>
<div id="random-sampling" class="section level3">
<h3><span class="header-section-number">4.3.9</span> Random sampling</h3>
<p>There are two functions available for random sampling: <code>sample_n()</code> and <code>sample_frac()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sample_frac</span>(dose_response_long, <span class="fl">0.05</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   patient sex   Dose      Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;        &lt;int&gt;
## 1 014     f     dose100mg       79
## 2 020     f     dose10mg        26
## 3 022     f     dose100mg       77</code></pre>
<p>The workings of <code>sample_n()</code> are obvious I guess.</p>
</div>
</div>
<div id="adding-and-changing-variables" class="section level2">
<h2><span class="header-section-number">4.4</span> Adding and changing variables</h2>
<div id="window-functions" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Window functions</h3>
<p>A new variable is usually the result of some operation on one or more previous variables. The data in an original variables is processed such that for each old value a new value is generated. Functions that carry out this kind of operation are called <strong><em>window</em></strong> functions. Thus, window functions are functions that take a vector and return another vector of the same length.</p>
<p>For instance, the <code>cumsum()</code> function returns the cumulatieve sum of a numeric vector:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</code></pre>
<pre><code>## [1]  1  3  6 10 15</code></pre>
<p>Here are the main window functions. Note that some of them come from base R. Later you will see the use of several of them in contcert with the <code>mutate()</code> function.</p>
<ul>
<li><p><strong><em><code>dplyr::lead</code></em></strong><br />
Copy with values shifted by 1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lead</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>))</code></pre>
<pre><code>## [1]  4  2  8 NA</code></pre></li>
<li><p><strong><em><code>dplyr::lag</code></em></strong><br />
Copy with values lagged by 1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lag</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>))</code></pre>
<pre><code>## [1] NA  1  4  2</code></pre></li>
<li><p><strong><em><code>dplyr::min_rank</code></em></strong><br />
Ranks on values, from low to high. Use <code>desc()</code> to reverse.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">min_rank</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>))</code></pre>
<pre><code>## [1] 3 2 1 4</code></pre></li>
<li><p><strong><em><code>dplyr::ntile</code></em></strong><br />
Bin vector into n buckets.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ntile</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>), <span class="dv">3</span>)</code></pre>
<pre><code>## [1] 2 2 1 3 1</code></pre></li>
<li><p><strong><em><code>dplyr::between</code></em></strong><br />
Are values between a and b?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">between</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">5</span>)</code></pre>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE FALSE</code></pre></li>
<li><p><strong><em><code>dplyr::cummean</code></em></strong><br />
Cumulative mean</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cummean</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>))</code></pre>
<pre><code>## [1] 5.00 4.50 3.67 4.75 4.00</code></pre></li>
<li><p><strong><em><code>cumsum</code></em></strong><br />
Cumulative sum</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>))</code></pre>
<pre><code>## [1]  5  9 11 19 20</code></pre></li>
<li><p><strong><em><code>cummax</code></em></strong><br />
Cumulative maximum</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cummax</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>))</code></pre>
<pre><code>## [1] 5 5 5 8 8</code></pre></li>
<li><p><strong><em><code>cummin</code></em></strong><br />
Cumulative minimum</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cummin</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>))</code></pre>
<pre><code>## [1] 5 4 2 2 1</code></pre></li>
<li><p><strong><em><code>cumprod</code></em></strong><br />
Cumulative product</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumprod</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>))</code></pre>
<pre><code>## [1]   5  20  40 320 320</code></pre></li>
<li><p><strong><em><code>pmax</code></em></strong><br />
Element-wise maximum</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pmax</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>))</code></pre>
<pre><code>## [1] 5 4 3 8 3</code></pre></li>
<li><p><strong><em><code>pmin</code></em></strong><br />
Element-wise minimum</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pmin</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>))</code></pre>
<pre><code>## [1] 2 2 2 4 1</code></pre></li>
</ul>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Add one or more variables: <code>mutate()</code></h3>
<p>The function <code>mutate()</code> can be used to calculate and append one or more columns.The window functions from the previous section are often-used helpers.</p>
<p>For instance, given the <code>ChickWeight</code> dataset which shows weight gain for 50 chicks:</p>
<pre class="sourceCode r"><code class="sourceCode r">chicks &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(ChickWeight) 
chicks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>## # A tibble: 5 x 4
##   weight  Time Chick Diet 
##    &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;
## 1     42     0 1     1    
## 2     51     2 1     1    
## 3     59     4 1     1    
## 4     64     6 1     1    
## 5     76     8 1     1</code></pre>
<p>Suppose we want to know the daily weight gain of these chicks (as a challenge, you could try to do this in base R).</p>
<p>Using <code>lag()</code> and <code>mutate()</code> this is a breeze (or so it seems):</p>
<pre class="sourceCode r"><code class="sourceCode r">(chicks &lt;-<span class="st"> </span>chicks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">weight_gain =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(weight)))</code></pre>
<pre><code>## # A tibble: 578 x 5
##    weight  Time Chick Diet  weight_gain
##     &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;       &lt;dbl&gt;
##  1     42     0 1     1              NA
##  2     51     2 1     1               9
##  3     59     4 1     1               8
##  4     64     6 1     1               5
##  5     76     8 1     1              12
##  6     93    10 1     1              17
##  7    106    12 1     1              13
##  8    125    14 1     1              19
##  9    149    16 1     1              24
## 10    171    18 1     1              22
## # … with 568 more rows</code></pre>
<p>…but the devil is in the details:</p>
<pre class="sourceCode r"><code class="sourceCode r">chicks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">10</span><span class="op">:</span><span class="dv">15</span>)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   weight  Time Chick Diet  weight_gain
##    &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;       &lt;dbl&gt;
## 1    171    18 1     1              22
## 2    199    20 1     1              28
## 3    205    21 1     1               6
## 4     40     0 2     1            -165
## 5     49     2 2     1               9
## 6     58     4 2     1               9</code></pre>
<p>The transition from chick 1 to chick 2 is not taken into account!
So to get the weight gain for each cick, we need to split the data first. This is dealt with in a later section but here is a preview:</p>
<pre class="sourceCode r"><code class="sourceCode r">chicks &lt;-<span class="st"> </span>chicks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(Chick) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#split on chicks</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">weight_gain =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(weight)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="co">#put together again</span>
<span class="kw">slice</span>(chicks, <span class="dv">10</span><span class="op">:</span><span class="dv">15</span>)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   weight  Time Chick Diet  weight_gain
##    &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;fct&gt;       &lt;dbl&gt;
## 1    171    18 1     1              22
## 2    199    20 1     1              28
## 3    205    21 1     1               6
## 4     40     0 2     1              NA
## 5     49     2 2     1               9
## 6     58     4 2     1               9</code></pre>
<p>Can you use a custom function in a <code>mutate</code> context? Of course you can!</p>
<pre class="sourceCode r"><code class="sourceCode r">my_z &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
    <span class="kw">abs</span>((<span class="kw">abs</span>(x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(x)))
}
women <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">z_score =</span> <span class="kw">my_z</span>(weight)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">head</span>()</code></pre>
<pre><code>##   height weight z_score
## 1     58    115   1.402
## 2     59    117   1.273
## 3     60    120   1.080
## 4     61    123   0.886
## 5     62    126   0.693
## 6     63    129   0.499</code></pre>
<p>And what’s more, you can make multiple columns in one operation where the calculations for the subsequent columns are interdependent.</p>
<pre class="sourceCode r"><code class="sourceCode r">women <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">z_score =</span> <span class="kw">my_z</span>(weight),
           <span class="dt">z_bin =</span> <span class="kw">ntile</span>(z_score, <span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">head</span>()</code></pre>
<pre><code>##   height weight z_score z_bin
## 1     58    115   1.402     3
## 2     59    117   1.273     3
## 3     60    120   1.080     2
## 4     61    123   0.886     2
## 5     62    126   0.693     2
## 6     63    129   0.499     1</code></pre>
</div>
<div id="create-new-variables-based-on-more-columns" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Create new variables based on more columns</h3>
<div id="mutate_all" class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> <code>mutate_all()</code></h4>
<p>The <code>mutate_all()</code> function is similar to the baser R <code>apply()</code> function.</p>
<p>Its syntax is a bit puzzling at first, and this has not been made easier by the introduction of new ways to code it.</p>
<p>Suppose you want to calculate the log2 of all numeric values in the <code>iris</code> dataset.
In base R you would probably do it like this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">apply</span>(iris[, <span class="dv">-5</span>], <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> log2))</code></pre>
<pre><code>##      Sepal.Length Sepal.Width Petal.Length Petal.Width
## [1,]         2.35        1.81        0.485       -2.32
## [2,]         2.29        1.58        0.485       -2.32
## [3,]         2.23        1.68        0.379       -2.32
## [4,]         2.20        1.63        0.585       -2.32
## [5,]         2.32        1.85        0.485       -2.32
## [6,]         2.43        1.96        0.766       -1.32</code></pre>
<p>When you do it with <code>mutate_all()</code> this is the solution you will encounter most in a Google search:</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(<span class="kw">log2</span>(.))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1         2.35        1.81        0.485       -2.32
## 2         2.29        1.58        0.485       -2.32
## 3         2.23        1.68        0.379       -2.32</code></pre>
<p>It gives a deprecation warning, so apparently there are new and improved ways to specify the function(s) to be applied. Let’s review these.</p>
<p><strong><em>A simple named list</em></strong>. This is actually much like the <code>apply()</code> approach.</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate_all</span>(<span class="kw">list</span>(<span class="dt">mean =</span> mean)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Sepal.Length_mean
## 1          5.1         3.5          1.4         0.2              5.84
## 2          4.9         3.0          1.4         0.2              5.84
##   Sepal.Width_mean Petal.Length_mean Petal.Width_mean
## 1             3.06              3.76              1.2
## 2             3.06              3.76              1.2</code></pre>
<p>So this adds 4 additional rows to the selection without Species and generates variable names by appending <code>_mean</code>. This is different from the first approach in that the old variables are kept beside the new ones.</p>
<p>When you supply two functions, e.g. <code>list(mean = mean, sd = sd)</code>, a variable is added for another four columns (8 in total).</p>
<p>Personally I do not like this. I like it when a method is called directly, with parentheses.</p>
<p><strong><em>Auto named with</em> <code>tibble::lst()</code></strong>. This is similar to the previous one; you supply a list of function names. The names of these functions define the postfix of the variable name.</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate_all</span>(<span class="kw">lst</span>(mean, sd)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Sepal.Length_mean
## 1          5.1         3.5          1.4         0.2              5.84
## 2          4.9         3.0          1.4         0.2              5.84
##   Sepal.Width_mean Petal.Length_mean Petal.Width_mean Sepal.Length_sd
## 1             3.06              3.76              1.2           0.828
## 2             3.06              3.76              1.2           0.828
##   Sepal.Width_sd Petal.Length_sd Petal.Width_sd
## 1          0.436            1.77          0.762
## 2          0.436            1.77          0.762</code></pre>
<p><strong><em>Using lambdas</em></strong>. Lambda’s are anonymous function-like expressions. Although this form is harder to grasp, it does make it easier to pass arguments to the function you want executed by <code>mutate_all</code> (in this case <code>trim = .2</code> to <code>mean</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate_all</span>(<span class="kw">list</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(., <span class="dt">trim =</span> <span class="fl">0.2</span>), <span class="op">~</span><span class="st"> </span><span class="kw">sd</span>(.))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Sepal.Length_mean
## 1          5.1         3.5          1.4         0.2               5.8
## 2          4.9         3.0          1.4         0.2               5.8
##   Sepal.Width_mean Petal.Length_mean Petal.Width_mean Sepal.Length_sd
## 1             3.04              3.84              1.2           0.828
## 2             3.04              3.84              1.2           0.828
##   Sepal.Width_sd Petal.Length_sd Petal.Width_sd
## 1          0.436            1.77          0.762
## 2          0.436            1.77          0.762</code></pre>
<p>The expression <code>~ mean(., trim = 0.2)</code> is therefore equivalent to something like
<code>function (.) mean(., trim = 0.2)</code> so the tilde is shorthand for <code>function (.)</code></p>
<p>Strangely enough, when experimenting further, I find that this simple solution also works for a single function to be applied:</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate_all</span>(my_z) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># or mutate_all(function(x){abs((abs(x - mean(x)) / sd(x)))})</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1        0.898       1.016         1.34        1.31
## 2        1.139       0.132         1.34        1.31</code></pre>
<p>Again, this gives only the new variables, not the preexisting ones.</p>
<p>It can be concluded that, whatever the approach, a list of executables of some form needs to be provided. Choose the one of your liking.</p>
</div>
<div id="mutate_at" class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> <code>mutate_at()</code></h4>
<p>In the previous examples, a selection of the numeric columns was required befor <code>mutate_all()</code> could be executed. An alternative approach is to use <code>mutate_at()</code> which has an additional argument for the column selection.</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">contains</span>(<span class="st">&quot;.&quot;</span>)), my_z) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1        0.898       1.016         1.34        1.31  setosa
## 2        1.139       0.132         1.34        1.31  setosa</code></pre>
<p>The selection can be specified in several ways:</p>
<ul>
<li><code>mutate_at(vars(-Species), my_z)</code></li>
<li><code>mutate_at(1:4, my_z)</code></li>
<li><code>mutate_at(vars(-Species), my_z)</code></li>
<li><code>mutate_at(vars(matches(&quot;Width|Length&quot;)), my_z)</code></li>
<li><code>mutate_at(vars(contains(&quot;.&quot;)), my_z)</code></li>
</ul>
<p>and there are probably more ways to maka a column selection.</p>
<p>You can see that the original variables are replaced with the original variables - that is, in the modified copy of the tibble. As you know it is customary in R to return a modified copy, not to overwrite original data unless you are explicitly saying so.</p>
</div>
<div id="mutate_if" class="section level4">
<h4><span class="header-section-number">4.4.3.3</span> <code>mutate_if()</code></h4>
<p>Even simpler in the case of the iris data is the <code>mutate_if()</code> function. After all, the entire point was to modify the numeric variables:</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate_if</span>(is.numeric, my_z) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1        0.898       1.016         1.34        1.31  setosa
## 2        1.139       0.132         1.34        1.31  setosa</code></pre>
</div>
</div>
<div id="change-a-variable-recode-and-recode_factor" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Change a variable: <code>recode()</code> and <code>recode_factor()</code></h3>
<p>These two functions help you to quickly change the values of a variable. Here, the Dose variable is overwritten with new -numeric- values. Note that the original <code>dose_response_long</code> tibble has <strong><em>not</em></strong> been modified!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dose_response_long, <span class="dv">2</span>)</code></pre>
<pre><code>## # A tibble: 2 x 4
##   patient sex   Dose     Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt;
## 1 001     f     dose10mg       12
## 2 002     f     dose10mg       11</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Dose =</span> <span class="kw">recode</span>(Dose, <span class="dt">dose10mg =</span> <span class="dv">10</span>, <span class="dt">dose100mg =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">2</span>)</code></pre>
<pre><code>## # A tibble: 2 x 4
##   patient sex    Dose Response
##   &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt;    &lt;int&gt;
## 1 001     f        10       12
## 2 002     f        10       11</code></pre>
<p>Similarly, the <code>sex</code> variable can be recoded with the <code>recode_factor()</code> function. In the example below,<br />
- the Response variable is created based on the <code>sex</code> variable,
- the <code>sex</code> variable is deleted and
- the variables are reordered to the original format</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Gender =</span> <span class="kw">recode_factor</span>(sex, <span class="dt">f =</span> <span class="st">&quot;female&quot;</span>, <span class="dt">m =</span> <span class="st">&quot;male&quot;</span>), 
           <span class="dt">sex =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(patient, Gender, Dose, Response) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   patient Gender Dose     Response
##   &lt;chr&gt;   &lt;fct&gt;  &lt;chr&gt;       &lt;int&gt;
## 1 001     female dose10mg       12
## 2 002     female dose10mg       11
## 3 003     male   dose10mg       54</code></pre>
</div>
</div>
<div id="operations-on-groups" class="section level2">
<h2><span class="header-section-number">4.5</span> Operations on groups</h2>
<p>Often you want to know something about groups in your data. For instance, in the previous examples with the chickens, it is interesting to know the average weight gain of the chickens for each diet. This is where the <code>group_by()</code> function comes in, and its couterpart <code>ungroup()</code>.</p>
<p>One important thing to realize is the <code>group_by()</code> does not <strong><em>split</em></strong> your data. instead, it adds metadata to a tibble (or data.frame) that marks how rows should be grouped. As long as that metadata is there -i.e. you have not called <code>ungroup()</code>- you won’t be able to change the factors of the columns involved in the grouping.</p>
<p>If you really want to split, like the base R <code>split()</code> function, you should use the <code>group_split()</code> function.</p>
<div id="group_by-and-ungroup" class="section level3">
<h3><span class="header-section-number">4.5.1</span> <code>group_by()</code> and <code>ungroup()</code></h3>
<p>This is the most used set of grouping functions. It is usually followed by some summary function -discussed below- but sometimes, as in the case of the weight gain outlined in section <a href="dplyr.html#mutate">4.4.2</a>, you want to progress with all datacombined. In that case you need to ungroup again.</p>
<p>Here is the summary use case. No need for ungrouping.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Response))</code></pre>
<pre><code>## # A tibble: 2 x 2
##   sex    mean
##   &lt;fct&gt; &lt;dbl&gt;
## 1 f      50.3
## 2 m      41.7</code></pre>
<p>Of course you can group by multiple variables.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(Dose, sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Response))</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   Dose [2]
##   Dose      sex    mean
##   &lt;chr&gt;     &lt;fct&gt; &lt;dbl&gt;
## 1 dose100mg f      80.9
## 2 dose100mg m      21.5
## 3 dose10mg  f      19.6
## 4 dose10mg  m      61.9</code></pre>
<p>Here is rather lengthy use case for ungrouping: the z-score is calculated per <code>sex</code> group, and then there is some Dose-specific calculation before summarizing. This requiresd an ungroup in between.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Response_Z =</span> <span class="kw">my_z</span>(Response)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co">##ungroup for other grouping</span>
<span class="st">    </span><span class="kw">group_by</span>(Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Response_scaled =</span> <span class="kw">scale</span>(Response)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Z =</span> <span class="kw">mean</span>(Response_Z), <span class="dt">Scaled_Mean_sd =</span> <span class="kw">sd</span>(Response_scaled))</code></pre>
<pre><code>## # A tibble: 2 x 3
##   Dose          Z Scaled_Mean_sd
##   &lt;chr&gt;     &lt;dbl&gt;          &lt;dbl&gt;
## 1 dose100mg 0.906          1.000
## 2 dose10mg  0.912          1.000</code></pre>
</div>
<div id="group_split-and-group_keys" class="section level3">
<h3><span class="header-section-number">4.5.2</span> <code>group_split()</code> and <code>group_keys()</code></h3>
<p>The <code>group_split()</code> function is equivalent to the base R <code>split()</code> function. But it uses the grouping structure from group_by() and therefore is subject to the data mask. Also, it does not name the elements of the list based on the grouping. So in the example below (unevaluated), <code>split()</code> will return a list with two named elements (<code>$m</code> and <code>$f</code>), but the list returned by <code>group_split()</code> will only be accessible with <code>[[1]]</code> and <code>[[2]]</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_split</span>(sex)
<span class="co">##same as</span>
<span class="kw">split</span>(<span class="kw">as.data.frame</span>(dose_response_long), dose_response_long<span class="op">$</span>sex)</code></pre>
<p>The last grouping-related function, <code>group_keys()</code>, only returns a tibble explaining the grouping structure:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_keys</span>(sex, Dose)</code></pre>
<pre><code>## # A tibble: 4 x 2
##   sex   Dose     
##   &lt;fct&gt; &lt;chr&gt;    
## 1 f     dose100mg
## 2 f     dose10mg 
## 3 m     dose100mg
## 4 m     dose10mg</code></pre>
</div>
<div id="apply-a-function-to-each-group" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Apply a function to each group</h3>
<p><code>group_map()</code>, <code>group_modify()</code> and <code>group_walk()</code> are functions that can be used to iterate on grouped tibbles.</p>
<ul>
<li><code>group_modify()</code> returns a grouped tibble. In that case <code>.f</code> must return a data frame.</li>
<li><code>group_map()</code> returns a list of results from calling <code>.f</code> on each group</li>
<li><code>group_walk()</code> calls .f for side effects and returns the input <code>.tbl</code>, invisibly</li>
</ul>
<p>Here is an example of <code>group_walk()</code>. As you can see it takes a lambda expression as seen before:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">quantile</span>(.x<span class="op">$</span>Response, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)))</code></pre>
<pre><code>## [[1]]
##   0%  20%  40%  60%  80% 100% 
##   10   18   31   69   85   99 
## 
## [[2]]
##   0%  20%  40%  60%  80% 100% 
##   11   19   26   54   67   83</code></pre>
<p>Use <code>group_walk()</code> when you only want to have a peek at each groupbefore processing further.</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_walk</span>(<span class="op">~</span><span class="st"> </span><span class="kw">print</span>(<span class="kw">head</span>(.x, <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(Response))</code></pre>
<pre><code>## # A tibble: 2 x 3
##   patient sex   Response
##   &lt;chr&gt;   &lt;fct&gt;    &lt;int&gt;
## 1 001     f           88
## 2 002     f           54
## # A tibble: 2 x 3
##   patient sex   Response
##   &lt;chr&gt;   &lt;fct&gt;    &lt;int&gt;
## 1 001     f           12
## 2 002     f           11</code></pre>
<pre><code>## # A tibble: 2 x 2
##   Dose        avg
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 dose100mg  51.2
## 2 dose10mg   40.8</code></pre>
</div>
</div>
<div id="summarizing-and-counting" class="section level2">
<h2><span class="header-section-number">4.6</span> Summarizing and counting</h2>
<p>You have seen the <code>summarize()</code> function at work a few times. In essence, it creates one or more summary statistics, for each group, if existing.</p>
<p>For instance, to calculate the mean and sd of relative weight gain for different diets, this is the workflow for it:</p>
<pre class="sourceCode r"><code class="sourceCode r">chicks <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(Chick) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#split on chicks</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">rel_weight_gain =</span> (weight <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(weight))<span class="op">/</span>weight) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Diet) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_rel_gain =</span> <span class="kw">mean</span>(rel_weight_gain, <span class="dt">na.rm =</span> T), 
              <span class="dt">sd =</span> <span class="kw">sd</span>(rel_weight_gain, <span class="dt">na.rm =</span> T))</code></pre>
<pre><code>## # A tibble: 4 x 3
##   Diet  mean_rel_gain     sd
##   &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;
## 1 1             0.111 0.0743
## 2 2             0.131 0.0742
## 3 3             0.153 0.0657
## 4 4             0.142 0.0748</code></pre>
<p>There is an equivalend that creates a summary for a group of variables: <code>summarize_all()</code>, <code>summarize_at()</code> and <code>summareize_if()</code> which are analogous to the <code>mutate_xxx()</code> methods. Here is one example.</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize_if</span>(is.numeric, <span class="kw">list</span>(<span class="dt">mean =</span> mean, <span class="dt">sd =</span> sd))</code></pre>
<pre><code>##   Sepal.Length_mean Sepal.Width_mean Petal.Length_mean Petal.Width_mean
## 1              5.84             3.06              3.76              1.2
##   Sepal.Length_sd Sepal.Width_sd Petal.Length_sd Petal.Width_sd
## 1           0.828          0.436            1.77          0.762</code></pre>
<p>You should be able to figure out the rest of them by now.</p>
<div id="simple-counting-of-occurrences" class="section level4">
<h4><span class="header-section-number">4.6.0.1</span> Simple counting of occurrences</h4>
<p>An often used operation is simple counting of occurrences of course:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(sex, Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   sex [2]
##   sex   Dose      count
##   &lt;fct&gt; &lt;chr&gt;     &lt;int&gt;
## 1 f     dose100mg    13
## 2 f     dose10mg     13
## 3 m     dose100mg    13
## 4 m     dose10mg     13</code></pre>
<p>There is a shorthand for this type of count: <code>tally()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(sex, Dose) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">tally</span>()</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   sex [2]
##   sex   Dose          n
##   &lt;fct&gt; &lt;chr&gt;     &lt;int&gt;
## 1 f     dose100mg    13
## 2 f     dose10mg     13
## 3 m     dose100mg    13
## 4 m     dose10mg     13</code></pre>
<p>And even shorter is this:</p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(sex, Dose)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   sex   Dose          n
##   &lt;fct&gt; &lt;chr&gt;     &lt;int&gt;
## 1 f     dose100mg    13
## 2 f     dose10mg     13
## 3 m     dose100mg    13
## 4 m     dose10mg     13</code></pre>
<p>When you want the counts sorted, use the <code>sort = TRUE</code> argument to count, e.g.<br />
<code>mtcars %&gt;% count(cyl, sort = TRUE)</code></p>
<p>If you want such a count as a column in your dataset, use <code>add_tally()</code> or <code>add_count()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">dose_response_long <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_tally</span>()</code></pre>
<pre><code>## # A tibble: 52 x 5
## # Groups:   sex [2]
##    patient sex   Dose     Response     n
##    &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt; &lt;int&gt;
##  1 001     f     dose10mg       12    26
##  2 002     f     dose10mg       11    26
##  3 003     m     dose10mg       54    26
##  4 004     m     dose10mg       71    26
##  5 005     f     dose10mg       19    26
##  6 006     f     dose10mg       22    26
##  7 007     f     dose10mg       23    26
##  8 008     m     dose10mg       68    26
##  9 009     f     dose10mg       30    26
## 10 010     m     dose10mg       83    26
## # … with 42 more rows</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">##same as below, but slightly more readable:</span>
<span class="co">#add_count(sex)</span></code></pre>
<p><code>add_count()</code> is useful for groupwise filtering, for instance when you want to show details of the group that occurs the least.</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">add_count</span>(cyl) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(n <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(n)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, n)</code></pre>
<pre><code>## # A tibble: 7 x 6
##     mpg   cyl  disp    hp  drat     n
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  21       6  160    110  3.9      7
## 2  21       6  160    110  3.9      7
## 3  21.4     6  258    110  3.08     7
## 4  18.1     6  225    105  2.76     7
## 5  19.2     6  168.   123  3.92     7
## 6  17.8     6  168.   123  3.92     7
## 7  19.7     6  145    175  3.62     7</code></pre>
</div>
</div>
<div id="combining-data" class="section level2">
<h2><span class="header-section-number">4.7</span> Combining data</h2>
<div id="merging" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Merging</h3>
<p>There are a few functions, <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join()</code>; only <code>full_join()</code> is discussed here; the others are variations behaving differently with missing data in one or the other data frames to combine. In base R you have <code>merge()</code> that is responsible for this kind of operations.</p>
<p>Suppose you have two tribbles:</p>
<pre class="sourceCode r"><code class="sourceCode r">(trA &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>ID, <span class="op">~</span>var1,
  <span class="st">&quot;a&quot;</span>,   <span class="dv">4</span>,
  <span class="st">&quot;b&quot;</span>,   <span class="dv">6</span>,
  <span class="st">&quot;c&quot;</span>,   <span class="dv">1</span>,
))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   ID     var1
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         4
## 2 b         6
## 3 c         1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">(trB &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>ID, <span class="op">~</span>var2,
  <span class="st">&quot;a&quot;</span>,   <span class="dv">7</span>,
  <span class="st">&quot;b&quot;</span>,   <span class="dv">3</span>,
  <span class="st">&quot;d&quot;</span>,   <span class="dv">5</span>
))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   ID     var2
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         7
## 2 b         3
## 3 d         5</code></pre>
<p>Since there is a common variable “ID” we can simply combine these two into a single tribble:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">full_join</span>(trA, trB, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   ID     var1  var2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a         4     7
## 2 b         6     3
## 3 c         1    NA
## 4 d        NA     5</code></pre>
<p>When the column names differ you can specify it as <code>full_join(x, y, by = c(&quot;a&quot; = &quot;b&quot;))</code> which will match variable <code>a</code> on tibble <code>x</code> to variable <code>b</code> on tibble <code>y</code>.<br />
You can of course also do this in a workflow setting:</p>
<pre class="sourceCode r"><code class="sourceCode r">trA <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(trB, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   ID     var1  var2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a         4     7
## 2 b         6     3
## 3 c         1    NA
## 4 d        NA     5</code></pre>
</div>
<div id="adding-rows-and-columns" class="section level3">
<h3><span class="header-section-number">4.7.2</span> Adding rows and columns</h3>
<p>To add rows, use <code>bind_rows()</code> and to add colums, use <code>bind_cols()</code> have a look at the docs for the details. They are pretty much self-explanatory, and analogous to the base R <code>cbind()</code> and <code>rbind()</code> functions.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="date-time.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
